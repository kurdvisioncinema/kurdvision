<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>کورد ڤیژن Pro</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Aref+Ruqaa:wght@400;700&family=IBM+Plex+Sans+Arabic:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg-primary: #0f0f1e;
            --bg-secondary: #1a1a2e;
            --bg-card: #16213e;
            --accent-primary: #e94560;
            --text-primary: #f1f1f1;
            --text-secondary: #a0a0a0;
            --success: #00ff88;
        }
        
        body {
            font-family: 'Aref Ruqaa', 'IBM Plex Sans Arabic', serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.8;
            overflow-x: hidden;
        }

        h1, h2, h3, h4, h5, h6 { font-family: 'Aref Ruqaa', serif; font-weight: 700; }

        header {
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(233, 69, 96, 0.1);
        }

        nav {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-search {
            flex: 1;
            max-width: 500px;
            position: relative;
        }

        .nav-search input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            background: var(--bg-card);
            border: 1px solid transparent;
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .nav-search button {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .nav-links {
            display: flex;
            gap: 5px;
            list-style: none;
            align-items: center;
        }

        .mobile-menu-btn {
            display: none;
            background: none;
            border: none;
            color: var(--text-primary);
            font-size: 24px;
            cursor: pointer;
            padding: 8px;
        }

        .nav-links a {
            padding: 8px 15px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .nav-links a:hover, .nav-links a.active {
            color: var(--accent-primary);
            background: rgba(233, 69, 96, 0.1);
        }

        .user-menu {
            position: relative;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid var(--accent-primary);
        }

        .user-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--bg-card);
            border-radius: 8px;
            min-width: 180px;
            margin-top: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 100;
        }

        .user-dropdown.show { display: block; }

        .user-dropdown a {
            display: block;
            padding: 12px 16px;
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.3s;
        }

        .user-dropdown a:hover {
            background: rgba(233, 69, 96, 0.1);
        }

        .dropdown-menu {
            position: relative;
        }

        .dropdown-content {
            display: none;
            position: absolute;
            top: 100%;
            right: 0;
            background: var(--bg-card);
            min-width: 180px;
            box-shadow: 0 8px 16px rgba(0,0,0,0.3);
            border-radius: 8px;
            z-index: 1000;
            margin-top: 5px;
        }

        .dropdown-menu:hover .dropdown-content {
            display: block;
        }

        .dropdown-content a {
            padding: 12px 16px !important;
            display: block;
        }

        .dropdown-content a:hover {
            background: rgba(233, 69, 96, 0.1) !important;
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--accent-primary);
            color: white;
        }

        .btn-primary:hover { background: #d63850; }

        .btn-secondary {
            background: var(--success);
            color: #000;
        }

        .btn-danger { background: #ff4444; color: white; }

        .hero {
            position: relative;
            height: 85vh;
            min-height: 600px;
            overflow: hidden;
            margin-bottom: 40px;
        }

        .hero-slide {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.8s ease;
        }

        .hero-slide.active { opacity: 1; }

        .hero-bg {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(0.4);
        }

        .hero-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 80px 60px;
            background: linear-gradient(transparent, rgba(15, 15, 30, 0.98));
        }

        .hero-title {
            font-size: 56px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.8);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 40px 0 25px;
        }

        .section-title { font-size: 24px; }

        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            overflow-x: auto;
        }

        .filter-btn {
            padding: 8px 20px;
            background: var(--bg-card);
            border: 1px solid transparent;
            border-radius: 20px;
            color: var(--text-secondary);
            font-size: 13px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s;
        }

        .filter-btn:hover, .filter-btn.active {
            background: var(--accent-primary);
            color: white;
        }

        .movies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 60px;
        }

        .movie-card {
            background: var(--bg-card);
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s;
            position: relative;
        }

        .movie-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(233, 69, 96, 0.2);
        }

        .movie-poster {
            position: relative;
            width: 100%;
            aspect-ratio: 2/3;
            overflow: hidden;
        }

        .movie-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .play-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            background: rgba(233, 69, 96, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.3s;
        }

        .movie-card:hover .play-icon { opacity: 1; }

        .movie-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 10px;
            background: rgba(233, 69, 96, 0.95);
            border-radius: 4px;
            font-size: 11px;
        }

        .movie-info {
            padding: 12px;
        }

        .movie-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .movie-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 16px;
            max-width: 900px;
            width: 100%;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            left: 15px;
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.8);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            z-index: 10;
        }

        .modal-header {
            padding: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .modal-title {
            font-size: 24px;
            color: var(--accent-primary);
        }

        .modal-body { padding: 25px; }

        .form-group { margin-bottom: 20px; }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            background: var(--bg-card);
            border: 1px solid transparent;
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .social-login {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .social-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .social-btn.google {
            background: #fff;
            color: #333;
        }

        .social-btn.facebook {
            background: #1877f2;
            color: white;
        }

        .detail-page {
            display: none;
            padding: 40px 0;
            background: var(--bg-primary);
        }

        .detail-page.active { display: block; }

        .detail-header {
            position: relative;
            margin-bottom: 40px;
            background: var(--bg-secondary);
            border-radius: 16px;
            overflow: hidden;
            padding: 40px;
        }

        .detail-layout {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 40px;
            align-items: start;
        }

        .detail-poster-main {
            position: relative;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }

        .detail-poster-main img {
            width: 100%;
            aspect-ratio: 2/3;
            object-fit: cover;
        }

        .detail-play-overlay {
            position: absolute;
            inset: 0;
            background: rgba(0,0,0,0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s;
            cursor: pointer;
        }

        .detail-poster-main:hover .detail-play-overlay {
            opacity: 1;
        }

        .detail-play-btn {
            width: 80px;
            height: 80px;
            background: var(--accent-primary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            color: white;
        }

        .detail-info {
            padding: 20px 0;
        }

        .detail-title {
            font-size: 42px;
            margin-bottom: 15px;
            line-height: 1.2;
        }

        .detail-badges {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .detail-badge {
            padding: 6px 12px;
            background: rgba(255,255,255,0.1);
            border-radius: 6px;
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .detail-rating {
            background: var(--accent-primary);
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 700;
            font-size: 16px;
        }

        .detail-description {
            line-height: 1.8;
            color: var(--text-secondary);
            margin: 20px 0;
            font-size: 15px;
        }

        .detail-meta-grid {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
            margin: 30px 0;
        }

        .detail-meta-item {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
        }

        .detail-meta-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 5px;
        }

        .detail-meta-value {
            font-weight: 600;
            color: var(--text-primary);
        }

        .detail-tabs {
            display: flex;
            gap: 10px;
            margin: 30px 0;
            border-bottom: 2px solid rgba(255,255,255,0.1);
        }

        .detail-tab {
            padding: 12px 24px;
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 15px;
            font-weight: 600;
            border-bottom: 3px solid transparent;
            margin-bottom: -2px;
            transition: all 0.3s;
        }

        .detail-tab.active {
            color: var(--accent-primary);
            border-bottom-color: var(--accent-primary);
        }

        .detail-tab-content {
            display: none;
            padding: 30px 0;
        }

        .detail-tab-content.active {
            display: block;
        }

        .cast-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }

        .cast-item {
            text-align: center;
        }

        .cast-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: var(--accent-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            font-weight: 700;
            color: white;
            margin: 0 auto 10px;
        }

        .cast-name {
            font-size: 14px;
            font-weight: 600;
        }

        @media (max-width: 968px) {
            .detail-layout {
                grid-template-columns: 1fr;
            }
            
            .detail-poster-main {
                max-width: 300px;
                margin: 0 auto;
            }
        }

        .video-container {
            position: relative;
            width: 100%;
            padding-top: 56.25%;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .video-player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .server-tabs {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .server-tab {
            padding: 12px 24px;
            background: var(--bg-card);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            white-space: nowrap;
            font-weight: 600;
            transition: all 0.3s;
        }

        .server-tab:hover {
            background: var(--accent-primary);
        }

        .server-tab.active {
            background: var(--accent-primary);
        }

        .episodes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .episode-card {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .episode-card:hover {
            border-color: var(--accent-primary);
            transform: translateY(-4px);
        }

        .episode-card.active {
            border-color: var(--accent-primary);
            background: rgba(233, 69, 96, 0.1);
        }

        .comments-section {
            margin-top: 50px;
            padding: 30px;
            background: var(--bg-card);
            border-radius: 12px;
        }

        .comment-form {
            margin-bottom: 30px;
        }

        .comment-form textarea {
            width: 100%;
            padding: 15px;
            background: var(--bg-secondary);
            border: 1px solid transparent;
            border-radius: 8px;
            color: var(--text-primary);
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .comment-form textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .comment {
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .comment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--accent-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .comment-author {
            font-weight: 600;
            color: var(--accent-primary);
        }

        .comment-date {
            font-size: 12px;
            color: var(--text-secondary);
            margin-right: auto;
        }

        .comment-text {
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .admin-controls {
            display: none;
            gap: 8px;
        }

        .admin-controls.show { display: flex; }

        .admin-panel {
            display: none;
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .admin-panel.show { display: block; }

        .admin-section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .list-item {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--bg-card);
            padding: 15px 20px;
            border-radius: 8px;
            border-left: 4px solid var(--accent-primary);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 3000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(400px); }
            to { transform: translateX(0); }
        }

        .staff-card {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 25px;
            text-align: center;
            transition: all 0.3s;
        }

        .staff-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(233, 69, 96, 0.2);
        }

        .staff-image {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            object-fit: cover;
            margin: 0 auto 20px;
            border: 4px solid var(--accent-primary);
        }

        .staff-name {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--accent-primary);
        }

        .staff-role {
            color: var(--text-secondary);
            margin-bottom: 15px;
        }

        .staff-social {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin-top: 15px;
        }

        .staff-social a {
            width: 36px;
            height: 36px;
            background: rgba(255,255,255,0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--text-primary);
            transition: all 0.3s;
        }

        .staff-social a:hover {
            background: var(--accent-primary);
            transform: scale(1.1);
        }
        
        .mobile-only-auth {
            display: none;
        }

        @media (max-width: 768px) {
            .hero { 
                height: 65vh; 
                min-height: 450px; 
            }
            
            .hero-title {
                font-size: 32px;
            }
            
            .hero-content {
                padding: 40px 20px;
            }
            
            .movies-grid { 
                grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
                gap: 12px;
            }
            
            .nav-search { 
                display: none; 
            }
            
            .nav-links {
                display: none;
                position: fixed;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(15, 15, 30, 0.98);
                backdrop-filter: blur(10px);
                flex-direction: column;
                padding: 80px 20px 20px;
                box-shadow: 0 10px 30px rgba(0,0,0,0.5);
                z-index: 999;
                overflow-y: auto;
                align-items: stretch;
                gap: 0;
            }
            
            .nav-links.show {
                display: flex;
            }
            
            .nav-links li {
                width: 100%;
                border-bottom: 1px solid rgba(255,255,255,0.05);
            }
            
            .nav-links a {
                width: 100%;
                text-align: right;
                padding: 16px 20px;
                font-size: 16px;
                display: block;
            }
            
            .dropdown-menu {
                width: 100%;
            }
            
            .dropdown-content {
                position: static;
                display: none;
                box-shadow: none;
                background: rgba(255,255,255,0.03);
                margin: 0;
                padding-right: 20px;
            }
            
            .dropdown-menu.open .dropdown-content {
                display: block;
            }
            
            .mobile-menu-btn {
                display: block;
            }
            
            .logo {
                font-size: 20px;
            }
            
            nav {
                padding: 12px 15px;
            }
            
            .detail-layout {
                grid-template-columns: 1fr;
                gap: 20px;
            }
            
            .detail-poster-main {
                max-width: 250px;
                margin: 0 auto;
            }
            
            .detail-title {
                font-size: 28px;
                text-align: center;
            }
            
            .detail-badges {
                justify-content: center;
            }
            
            .detail-meta-grid {
                grid-template-columns: 1fr;
            }
            
            .detail-tabs {
                overflow-x: auto;
                gap: 5px;
            }
            
            .detail-tab {
                padding: 10px 16px;
                font-size: 13px;
                white-space: nowrap;
            }
            
            .cast-grid {
                grid-template-columns: repeat(auto-fill, minmax(80px, 1fr));
            }
            
            .cast-avatar {
                width: 80px;
                height: 80px;
                font-size: 24px;
            }
            
            .episodes-grid,
            .season-episodes {
                grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)) !important;
                gap: 10px;
            }
            
            .server-tabs {
                gap: 8px;
            }
            
            .server-tab {
                padding: 10px 16px;
                font-size: 13px;
            }
            
            .modal-content {
                max-height: 95vh;
                margin: 10px;
            }
            
            .admin-section {
                padding: 15px;
            }
            
            .list-item {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
            
            .list-item > div:last-child {
                width: 100%;
                display: flex;
                gap: 8px;
            }
            
            .list-item .btn {
                flex: 1;
                justify-content: center;
            }
            
            .filters {
                gap: 8px;
                padding-bottom: 10px;
            }
            
            .filter-btn {
                padding: 6px 16px;
                font-size: 12px;
            }
            
            #authButtons {
                display: none !important;
            }
            
            .user-menu {
                order: -1;
            }
            
            .mobile-only-auth {
                display: block;
            }
            
            #authButtons {
                display: none !important;
            }
            
            .user-menu #userMenu {
                display: block !important;
            }
        }

        .season-tab {
            padding: 12px 24px;
            background: var(--bg-card);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            white-space: nowrap;
            font-weight: 600;
            transition: all 0.3s;
        }

        .season-tab:hover, .season-tab.active {
            background: var(--accent-primary);
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                <i class="fas fa-bars" id="menuIcon"></i>
            </button>
            
            <div class="logo">
                <i class="fas fa-film"></i>
                <span>کورد ڤیژن</span>
            </div>
            
            <div class="nav-search">
                <input type="text" placeholder="گەڕان..." id="searchInput">
                <button onclick="performSearch()"><i class="fas fa-search"></i></button>
            </div>

            <ul class="nav-links" id="navLinks">
                <li><a href="#" onclick="showSection('home'); setFilter('all'); closeMobileMenu(); return false;" class="active">سەرەکی</a></li>
                <li><a href="#" onclick="setFilter('movies'); closeMobileMenu(); return false;">فیلم</a></li>
                <li><a href="#" onclick="setFilter('series'); closeMobileMenu(); return false;">زنجیرە</a></li>
                <li><a href="#" onclick="setFilter('subtitled'); closeMobileMenu(); return false;">ژێرنووسکراو</a></li>
                <li><a href="#" onclick="setFilter('dubbed'); closeMobileMenu(); return false;">دۆبلاژکراو</a></li>
                
                <li class="dropdown-menu">
                    <a href="#" onclick="toggleGenreDropdown(event); return false;">
                        ژانەر <i class="fas fa-chevron-down" style="font-size: 10px; margin-right: 5px;"></i>
                    </a>
                    <div class="dropdown-content" id="genreDropdown">
                        <a href="#" onclick="setFilter('drama'); closeMobileMenu(); return false;">درامی</a>
                        <a href="#" onclick="setFilter('action'); closeMobileMenu(); return false;">ئاکشن</a>
                        <a href="#" onclick="setFilter('fantasy'); closeMobileMenu(); return false;">خەیاڵی</a>
                        <a href="#" onclick="setFilter('history'); closeMobileMenu(); return false;">مێژووی</a>
                        <a href="#" onclick="setFilter('anime'); closeMobileMenu(); return false;">ئەنیمی</a>
                        <a href="#" onclick="setFilter('horror'); closeMobileMenu(); return false;">تۆقێنەر</a>
                        <a href="#" onclick="setFilter('comedy'); closeMobileMenu(); return false;">کۆمیدی</a>
                        <a href="#" onclick="setFilter('romance'); closeMobileMenu(); return false;">ڕۆمانسی</a>
                    </div>
                </li>
                
                <li><a href="#" onclick="showStaffSection(); closeMobileMenu(); return false;">ستاف</a></li>
                
                <li style="border: none; margin-top: 20px;" class="mobile-only-auth">
                    <button class="btn btn-primary" onclick="openAuthModal(); closeMobileMenu();" style="width: 100%; justify-content: center;">
                        <i class="fas fa-user"></i> چوونەژوورەوە
                    </button>
                </li>
            </ul>

            <div id="authButtons">
                <button class="btn btn-primary" onclick="openAuthModal()">
                    <i class="fas fa-user"></i> چوونەژوورەوە
                </button>
            </div>

            <div class="user-menu" id="userMenu" style="display: none;">
                <img src="" alt="User" class="user-avatar" id="userAvatar" onclick="toggleUserDropdown()">
                <div class="user-dropdown" id="userDropdown">
                    <a href="#" onclick="showSection('admin'); return false;" id="adminMenuLink">
                        <i class="fas fa-cog"></i> پانێڵی ئەدمین
                    </a>
                    <a href="#" onclick="logout(); return false;">
                        <i class="fas fa-sign-out-alt"></i> چوونەدەرەوە
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <div id="homeSection">
        <section class="hero" id="heroSection"></section>

        <div class="container">
            <div class="filters" id="filterTabs">
                <button class="filter-btn active" onclick="setFilter('all')">هەموو</button>
                <button class="filter-btn" onclick="setFilter('movies')">فیلمەکان</button>
                <button class="filter-btn" onclick="setFilter('series')">زنجیرەکان</button>
                <button class="filter-btn" onclick="setFilter('latest')">نوێترین</button>
            </div>

            <div class="section-header">
                <h2 class="section-title">پێشنیارکراو</h2>
            </div>
            <div class="movies-grid" id="moviesGrid">
                <div style="padding: 60px; text-align: center; color: var(--text-secondary);">
                    چاوەڕێ بکە...
                </div>
            </div>
        </div>
    </div>

    <div id="detailPage" class="detail-page"></div>

    <!-- STAFF SECTION -->
    <div id="staffSection" style="display: none; padding: 60px 0;">
        <div class="container">
            <button class="btn btn-secondary" onclick="showSection('home')" style="margin-bottom: 30px;">
                <i class="fas fa-arrow-right"></i> گەڕانەوە
            </button>
            
            <h1 style="font-size: 48px; margin-bottom: 20px; text-align: center;">
                <i class="fas fa-users"></i> ستافی کورد ڤیژن
            </h1>
            <p style="text-align: center; color: var(--text-secondary); margin-bottom: 50px; font-size: 18px;">
                تیمی پیشەییمان بۆ پێشکەشکردنی باشترین خزمەتگوزاری
            </p>
            
            <div id="staffGrid" style="display: grid; grid-template-columns: repeat(auto-fill, minmax(250px, 1fr)); gap: 30px;">
                <div style="padding: 60px; text-align: center; color: var(--text-secondary);">
                    چاوەڕێ بکە...
                </div>
            </div>
        </div>
    </div>

    <div class="admin-panel" id="adminPanel">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 15px;">
                <h2 style="font-size: 28px; margin: 0;">
                    <i class="fas fa-cog"></i> پانێڵی بەڕێوەبردن
                </h2>
                <button class="btn btn-secondary" onclick="showSection('home')">
                    <i class="fas fa-home"></i> گەڕانەوە بۆ سەرەکی
                </button>
            </div>

            <div class="admin-section">
                <h3><i class="fas fa-chart-bar"></i> ئامار</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700; color: var(--accent-primary);" id="totalContent">0</div>
                        <div style="color: var(--text-secondary); margin-top: 8px;">کۆی ناوەڕۆک</div>
                    </div>
                    <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700; color: var(--success);" id="totalMovies">0</div>
                        <div style="color: var(--text-secondary); margin-top: 8px;">فیلمەکان</div>
                    </div>
                    <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700; color: #2196F3;" id="totalSeries">0</div>
                        <div style="color: var(--text-secondary); margin-top: 8px;">زنجیرەکان</div>
                    </div>
                    <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700; color: #ff9800;" id="totalComments">0</div>
                        <div style="color: var(--text-secondary); margin-top: 8px;">کۆمێنتەکان</div>
                    </div>
                </div>
            </div>

            <div class="admin-section">
                <h3><i class="fas fa-video"></i> بەڕێوەبردنی ناوەڕۆک (فیلم و زنجیرە)</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; margin: 20px 0;">
                    <button class="btn btn-primary" onclick="openContentModal('movie')">
                        <i class="fas fa-plus"></i> زیادکردنی فیلم
                    </button>
                    <button class="btn btn-primary" onclick="openContentModal('series')">
                        <i class="fas fa-plus"></i> زیادکردنی زنجیرە
                    </button>
                </div>
                <div id="contentManager"></div>
            </div>

            <!-- بەشی Hero Slides -->
            <div class="admin-section">
                <h3><i class="fas fa-images"></i> بەڕێوەبردنی Hero Slider (سەرپەڕە)</h3>
                <button class="btn btn-primary" onclick="openSlideModal()" style="margin: 15px 0;">
                    <i class="fas fa-plus"></i> زیادکردنی Slide نوێ
                </button>
                <div id="slidesManager"></div>
            </div>

            <!-- بەشی ژانەرەکان -->
            <div class="admin-section">
                <h3><i class="fas fa-tags"></i> بەڕێوەبردنی ژانەرەکان</h3>
                <button class="btn btn-primary" onclick="openGenreModal()" style="margin: 15px 0;">
                    <i class="fas fa-plus"></i> زیادکردنی ژانەری نوێ
                </button>
                <div id="genresManager"></div>
            </div>

            <!-- بەشی ستاف -->
            <div class="admin-section">
                <h3><i class="fas fa-users"></i> بەڕێوەبردنی ستاف</h3>
                <button class="btn btn-primary" onclick="openStaffModal()" style="margin: 15px 0;">
                    <i class="fas fa-plus"></i> زیادکردنی ئەندامی ستاف
                </button>
                <div id="staffManager"></div>
            </div>
        </div>
    </div>

    <div class="modal" id="authModal">
        <div class="modal-content" style="max-width: 420px;">
            <button class="modal-close" onclick="closeModal('authModal')">×</button>
            <div class="modal-header">
                <h2 class="modal-title">چوونەژوورەوە</h2>
            </div>
            <div class="modal-body">
                <form onsubmit="handleAuth(event, 'login')" id="loginForm">
                    <div class="form-group">
                        <label>ئیمەیڵ</label>
                        <input type="email" id="authEmail" required>
                    </div>
                    <div class="form-group">
                        <label>پاسوۆرد</label>
                        <input type="password" id="authPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;">
                        چوونەژوورەوە
                    </button>
                </form>

                <div style="text-align: center; margin: 20px 0; color: var(--text-secondary);">
                    یان
                </div>

                <div class="social-login">
                    <button class="social-btn google" onclick="socialLogin('google')">
                        <i class="fab fa-google"></i> Google
                    </button>
                    <button class="social-btn facebook" onclick="socialLogin('facebook')">
                        <i class="fab fa-facebook-f"></i> Facebook
                    </button>
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <a href="#" onclick="toggleAuthMode(); return false;" style="color: var(--accent-primary); text-decoration: none;">
                        هەژمارت نییە؟ دروستی بکە
                    </a>
                </div>

                <div style="margin-top: 30px; padding: 15px; background: var(--bg-card); border-radius: 8px; text-align: center;">
                    <p style="font-size: 13px; color: var(--text-secondary); margin-bottom: 10px;">
                        بۆ دەستگەیشتن بە پانێڵی ئەدمین:
                    </p>
                    <p style="font-size: 12px; color: var(--accent-primary); font-family: monospace;">
                        ?admin=true زیاد بکە بە URL
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="contentModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('contentModal')">×</button>
            <div class="modal-header">
                <h2 class="modal-title" id="contentModalTitle">زیادکردنی ناوەڕۆک</h2>
            </div>
            <div class="modal-body">
                <form onsubmit="saveContent(event)">
                    <input type="hidden" id="contentType">
                    <input type="hidden" id="contentEditId">
                    
                    <div class="form-group">
                        <label>ناونیشان *</label>
                        <input type="text" id="contentTitle" required>
                    </div>

                    <div class="form-group">
                        <label>لینکی پۆستەر *</label>
                        <input type="url" id="contentPoster" required>
                    </div>

                    <div class="form-group">
                        <label>ساڵ</label>
                        <input type="text" id="contentYear">
                    </div>

                    <div class="form-group">
                        <label>ڕەیتینگ (لە 10)</label>
                        <input type="number" id="contentRating" min="0" max="10" step="0.1">
                    </div>

                    <div class="form-group">
                        <label>وەسف</label>
                        <textarea id="contentDescription"></textarea>
                    </div>

                    <div class="form-group">
                        <label>جۆری وەرگێڕان</label>
                        <select id="contentSubType">
                            <option value="">هەڵبژێرە</option>
                            <option value="subtitled">ژێرنووسکراو</option>
                            <option value="dubbed">دۆبلاژکراو</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label>ژانەر</label>
                        <select id="contentGenre">
                            <option value="">هەڵبژێرە</option>
                            <option value="drama">درامی</option>
                            <option value="action">ئاکشن</option>
                            <option value="fantasy">خەیاڵی</option>
                            <option value="history">مێژووی</option>
                            <option value="anime">ئەنیمی</option>
                            <option value="horror">تۆقێنەر</option>
                            <option value="comedy">کۆمیدی</option>
                            <option value="romance">ڕۆمانسی</option>
                        </select>
                    </div>

                    <h3 style="margin: 20px 0; color: var(--accent-primary);">زانیاری وردەکاری</h3>

                    <div class="form-group">
                        <label>بەرهەمهێنەر</label>
                        <input type="text" id="contentProducer" placeholder="Star Studios">
                    </div>

                    <div class="form-group">
                        <label>دەرهێنەر</label>
                        <input type="text" id="contentDirector" placeholder="ناوی دەرهێنەر">
                    </div>

                    <div class="form-group">
                        <label>نووسەر</label>
                        <input type="text" id="contentWriter" placeholder="ناوی نووسەر">
                    </div>

                    <div class="form-group">
                        <label>ئەکتەرەکان (جیا بکەرەوە بە کۆما)</label>
                        <input type="text" id="contentActors" placeholder="ئەکتەر 1, ئەکتەر 2, ئەکتەر 3">
                    </div>

                    <div class="form-group">
                        <label>لینکی ترەیلەر (YouTube Embed)</label>
                        <input type="url" id="contentTrailer" placeholder="https://www.youtube.com/embed/VIDEO_ID">
                    </div>

                    <!-- بەشی زنجیرە - تەنها بۆ زنجیرەکان -->
                    <div id="seriesSection" style="display: none;">
                        <h3 style="margin: 20px 0; color: var(--accent-primary);">وەرزەکان</h3>
                        <div id="seasonsContainer"></div>
                        <button type="button" class="btn btn-secondary" onclick="addSeason()">
                            <i class="fas fa-plus"></i> زیادکردنی وەرزی نوێ
                        </button>
                    </div>

                    <!-- بەشی فیلم - تەنها بۆ فیلمەکان -->
                    <div id="movieSection" style="display: none;">
                        <h3 style="margin: 20px 0; color: var(--accent-primary);">سێرڤەرەکان</h3>
                        
                        <div class="form-group">
                            <label>🎥 سێرڤەر 1 (Upstream) *</label>
                            <input type="url" id="movieServer1" required>
                        </div>

                        <div class="form-group">
                            <label>🎥 سێرڤەر 2 (Filemoon)</label>
                            <input type="url" id="movieServer2">
                        </div>

                        <div class="form-group">
                            <label>🎥 سێرڤەر 3 (MixDrop)</label>
                            <input type="url" id="movieServer3">
                        </div>

                        <div class="form-group">
                            <label>🎥 سێرڤەر 4 (VidMoly)</label>
                            <input type="url" id="movieServer4">
                        </div>

                        <h3 style="margin: 20px 0; color: var(--accent-primary);">ژێرنووسەکان</h3>
                        
                        <div class="form-group">
                            <label>📄 ژێرنووس 1 (SRT)</label>
                            <input type="url" id="movieSubtitle1" placeholder="https://...subtitle.srt">
                        </div>

                        <div class="form-group">
                            <label>📄 ژێرنووس 2 (SRT)</label>
                            <input type="url" id="movieSubtitle2" placeholder="https://...subtitle.srt">
                        </div>
                    </div>

                    <div style="margin-top: 30px; display: flex; gap: 10px;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('contentModal')">
                            هەڵوەشاندنەوە
                        </button>
                        <button type="submit" class="btn btn-primary">
                            پاشەکەوتکردن
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- SLIDE MODAL -->
    <div class="modal" id="slideModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('slideModal')">×</button>
            <div class="modal-header">
                <h2 class="modal-title">زیادکردنی Slide</h2>
            </div>
            <div class="modal-body">
                <form onsubmit="saveSlide(event)">
                    <input type="hidden" id="slideEditId">
                    
                    <div class="form-group">
                        <label>ناونیشان *</label>
                        <input type="text" id="slideTitle" required>
                    </div>

                    <div class="form-group">
                        <label>لینکی وێنە *</label>
                        <input type="url" id="slideImage" required>
                    </div>

                    <div class="form-group">
                        <label>وەسف</label>
                        <textarea id="slideDescription"></textarea>
                    </div>

                    <div class="form-group">
                        <label>ID ی ناوەڕۆک (بۆ دوگمەی بینین)</label>
                        <input type="text" id="slideContentId">
                    </div>

                    <div style="margin-top: 20px; display: flex; gap: 10px;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('slideModal')">
                            هەڵوەشاندنەوە
                        </button>
                        <button type="submit" class="btn btn-primary">
                            پاشەکەوتکردن
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- GENRE MODAL -->
    <div class="modal" id="genreModal">
        <div class="modal-content" style="max-width: 500px;">
            <button class="modal-close" onclick="closeModal('genreModal')">×</button>
            <div class="modal-header">
                <h2 class="modal-title">زیادکردنی ژانەر</h2>
            </div>
            <div class="modal-body">
                <form onsubmit="saveGenre(event)">
                    <input type="hidden" id="genreEditId">
                    
                    <div class="form-group">
                        <label>ناوی ژانەر (کوردی) *</label>
                        <input type="text" id="genreName" required>
                    </div>

                    <div class="form-group">
                        <label>کۆدی ژانەر (English) *</label>
                        <input type="text" id="genreValue" required placeholder="drama">
                    </div>

                    <div class="form-group">
                        <label>ئایکۆن (Font Awesome)</label>
                        <input type="text" id="genreIcon" placeholder="fa-film">
                    </div>

                    <div style="margin-top: 20px; display: flex; gap: 10px;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('genreModal')">
                            هەڵوەشاندنەوە
                        </button>
                        <button type="submit" class="btn btn-primary">
                            پاشەکەوتکردن
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- STAFF MODAL -->
    <div class="modal" id="staffModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('staffModal')">×</button>
            <div class="modal-header">
                <h2 class="modal-title">زیادکردنی ئەندامی ستاف</h2>
            </div>
            <div class="modal-body">
                <form onsubmit="saveStaff(event)">
                    <input type="hidden" id="staffEditId">
                    
                    <div class="form-group">
                        <label>ناو *</label>
                        <input type="text" id="staffName" required>
                    </div>

                    <div class="form-group">
                        <label>پۆست *</label>
                        <input type="text" id="staffRole" required placeholder="بەڕێوەبەر، بەرنامەنووس، دیزاینەر...">
                    </div>

                    <div class="form-group">
                        <label>لینکی وێنە *</label>
                        <input type="url" id="staffImage" required>
                    </div>

                    <div class="form-group">
                        <label>وەسف</label>
                        <textarea id="staffBio" rows="3"></textarea>
                    </div>

                    <div class="form-group">
                        <label>لینکی فەیسبووک</label>
                        <input type="url" id="staffFacebook">
                    </div>

                    <div class="form-group">
                        <label>لینکی ئینستاگرام</label>
                        <input type="url" id="staffInstagram">
                    </div>

                    <div class="form-group">
                        <label>لینکی تێلیگرام</label>
                        <input type="url" id="staffTelegram">
                    </div>

                    <div style="margin-top: 20px; display: flex; gap: 10px;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('staffModal')">
                            هەڵوەشاندنەوە
                        </button>
                        <button type="submit" class="btn btn-primary">
                            پاشەکەوتکردن
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, push, set, onValue, remove, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, GoogleAuthProvider, FacebookAuthProvider, signInWithPopup } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAaE1v9PcHGsSgF1IlnDrygX5TT2-zii8o",
            authDomain: "kurdvision-f9d3e.firebaseapp.com",
            databaseURL: "https://kurdvision-f9d3e-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "kurdvision-f9d3e"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        let allContent = [];
        let allSlides = [];
        let allGenres = [];
        let allStaff = [];
        let currentUser = null;
        let isAdmin = false;
        let currentFilter = 'all';
        let authMode = 'login';

        window.toggleMobileMenu = function() {
            const navLinks = document.getElementById('navLinks');
            const menuIcon = document.getElementById('menuIcon');
            const isOpen = navLinks.classList.contains('show');
            
            if (isOpen) {
                navLinks.classList.remove('show');
                menuIcon.classList.remove('fa-times');
                menuIcon.classList.add('fa-bars');
                document.body.style.overflow = 'auto';
            } else {
                navLinks.classList.add('show');
                menuIcon.classList.remove('fa-bars');
                menuIcon.classList.add('fa-times');
                document.body.style.overflow = 'hidden';
            }
        };

        window.closeMobileMenu = function() {
            const navLinks = document.getElementById('navLinks');
            const menuIcon = document.getElementById('menuIcon');
            navLinks.classList.remove('show');
            menuIcon.classList.remove('fa-times');
            menuIcon.classList.add('fa-bars');
            document.body.style.overflow = 'auto';
        };

        window.toggleGenreDropdown = function(event) {
            event.preventDefault();
            const dropdown = event.currentTarget.parentElement;
            dropdown.classList.toggle('open');
        };

        window.openAuthModal = function() {
            openModal('authModal');
        };

        window.openModal = function(id) {
            const modal = document.getElementById(id);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        };

        window.closeModal = function(id) {
            const modal = document.getElementById(id);
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        };

        window.toggleUserDropdown = function() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        };

        window.showSection = function(section) {
            if (section === 'admin') {
                if (!currentUser) {
                    showToast('⚠️ تکایە یەکەم چوونەژوورەوە بکە');
                    openAuthModal();
                    return;
                }
                
                if (!isAdmin) {
                    showToast('⚠️ تەنها ئەدمینەکانی دیاریکراو دەتوانن بچنە پانێڵ');
                    showToast('💡 پێویستە لە Firebase Database وەک Admin زیاد بکرێیت');
                    return;
                }
                
                document.getElementById('homeSection').style.display = 'none';
                document.getElementById('detailPage').classList.remove('active');
                document.getElementById('staffSection').style.display = 'none';
                document.getElementById('adminPanel').classList.add('show');
                
                displayContentManager();
                displaySlidesManager();
                displayGenresManager();
                displayStaffManager();
                updateStats();
            } else {
                document.getElementById('homeSection').style.display = 'block';
                document.getElementById('detailPage').classList.remove('active');
                document.getElementById('staffSection').style.display = 'none';
                document.getElementById('adminPanel').classList.remove('show');
            }
        };

        window.showStaffSection = function() {
            document.getElementById('homeSection').style.display = 'none';
            document.getElementById('detailPage').classList.remove('active');
            document.getElementById('adminPanel').classList.remove('show');
            document.getElementById('staffSection').style.display = 'block';
            displayStaffPage();
        };

        window.showToast = function(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        };

        const urlParams = new URLSearchParams(window.location.search);
        const showAdminPanel = urlParams.get('admin') === 'true';

        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            updateUIForAuth(user);
            
            if (user) {
                checkAdminStatus(user.uid);
            } else {
                isAdmin = false;
                document.getElementById('adminMenuLink').style.display = 'none';
            }
        });

        function updateUIForAuth(user) {
            if (user) {
                document.getElementById('authButtons').style.display = 'none';
                document.getElementById('userMenu').style.display = 'block';
                
                // شاردنەوەی دوگمەی Login لە مۆبایل مێنیو
                const mobileAuthBtn = document.querySelector('.mobile-only-auth');
                if (mobileAuthBtn) mobileAuthBtn.style.display = 'none';
                
                const avatar = document.getElementById('userAvatar');
                if (user.photoURL) {
                    avatar.src = user.photoURL;
                    avatar.innerHTML = '';
                } else {
                    avatar.src = '';
                    avatar.style.background = 'var(--accent-primary)';
                    avatar.style.display = 'flex';
                    avatar.style.alignItems = 'center';
                    avatar.style.justifyContent = 'center';
                    avatar.style.color = 'white';
                    avatar.style.fontSize = '16px';
                    avatar.innerHTML = user.email[0].toUpperCase();
                }
            } else {
                document.getElementById('authButtons').style.display = 'block';
                document.getElementById('userMenu').style.display = 'none';
                
                // پیشاندانی دوگمەی Login لە مۆبایل مێنیو
                const mobileAuthBtn = document.querySelector('.mobile-only-auth');
                if (mobileAuthBtn) mobileAuthBtn.style.display = 'block';
                
                isAdmin = false;
            }
        }

        function checkAdminStatus(uid) {
            onValue(ref(db, `admins/${uid}`), (snapshot) => {
                isAdmin = snapshot.exists();
                
                const adminLink = document.getElementById('adminMenuLink');
                if (adminLink) {
                    adminLink.style.display = isAdmin ? 'block' : 'none';
                }
                
                if (isAdmin && showAdminPanel) {
                    setTimeout(() => {
                        showToast('👋 بەخێربێیت ئەدمین!');
                    }, 1000);
                }
            });
        }

        function loadData() {
            onValue(ref(db, 'content'), (snapshot) => {
                allContent = [];
                snapshot.forEach((child) => {
                    allContent.push({ id: child.key, ...child.val() });
                });
                displayContent();
                displayContentManager();
                updateStats();
            });

            onValue(ref(db, 'slides'), (snapshot) => {
                allSlides = [];
                snapshot.forEach((child) => {
                    allSlides.push({ id: child.key, ...child.val() });
                });
                loadHero();
                displaySlidesManager();
            });

            onValue(ref(db, 'genres'), (snapshot) => {
                allGenres = [];
                snapshot.forEach((child) => {
                    allGenres.push({ id: child.key, ...child.val() });
                });
                updateGenreDropdown();
                displayGenresManager();
            });

            onValue(ref(db, 'staff'), (snapshot) => {
                allStaff = [];
                snapshot.forEach((child) => {
                    allStaff.push({ id: child.key, ...child.val() });
                });
                displayStaffManager();
                displayStaffPage();
            });
        }
        loadData();

        function updateStats() {
            const totalMovies = allContent.filter(c => c.type === 'movie').length;
            const totalSeries = allContent.filter(c => c.type === 'series').length;
            const totalComments = allContent.reduce((sum, c) => sum + (c.commentsCount || 0), 0);

            document.getElementById('totalContent').textContent = allContent.length;
            document.getElementById('totalMovies').textContent = totalMovies;
            document.getElementById('totalSeries').textContent = totalSeries;
            document.getElementById('totalComments').textContent = totalComments;
        }

        function displayContent() {
            const grid = document.getElementById('moviesGrid');
            let filtered = [...allContent];

            if (currentFilter === 'movies') {
                filtered = filtered.filter(c => c.type === 'movie');
            } else if (currentFilter === 'series') {
                filtered = filtered.filter(c => c.type === 'series');
            } else if (currentFilter === 'subtitled') {
                filtered = filtered.filter(c => c.subType === 'subtitled');
            } else if (currentFilter === 'dubbed') {
                filtered = filtered.filter(c => c.subType === 'dubbed');
            } else if (currentFilter === 'latest') {
                filtered = filtered.sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 20);
            } else if (currentFilter !== 'all') {
                filtered = filtered.filter(c => c.genre === currentFilter);
            }

            if (filtered.length === 0) {
                grid.innerHTML = '<div style="padding: 60px; text-align: center; color: var(--text-secondary);">هیچ ناوەڕۆکێک نەدۆزرایەوە</div>';
                return;
            }

            grid.innerHTML = filtered.map(item => `
                <div class="movie-card" onclick="openDetail('${item.id}')">
                    <div class="movie-poster">
                        <img src="${item.poster}" alt="${item.title}">
                        <div class="play-icon"><i class="fas fa-play"></i></div>
                        ${item.rating ? `<div class="movie-badge">⭐ ${item.rating}</div>` : ''}
                    </div>
                    <div class="movie-info">
                        <div class="movie-title">${item.title}</div>
                        <div class="movie-meta">
                            <span>${item.year || '2024'}</span>
                            <span>${item.type === 'series' ? 'زنجیرە' : 'فیلم'}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadHero() {
            const hero = document.getElementById('heroSection');
            if (allSlides.length === 0) {
                hero.style.display = 'none';
                return;
            }

            hero.style.display = 'block';
            let currentSlide = 0;
            
            hero.innerHTML = allSlides.slice(0, 5).map((slide, index) => `
                <div class="hero-slide ${index === 0 ? 'active' : ''}">
                    <img src="${slide.image}" class="hero-bg">
                    <div class="hero-content">
                        <h1 class="hero-title">${slide.title}</h1>
                        ${slide.description ? `<p style="margin-bottom: 20px; max-width: 600px;">${slide.description}</p>` : ''}
                        ${slide.contentId ? `<button class="btn btn-primary" onclick="openDetail('${slide.contentId}')"><i class="fas fa-play"></i> بینین</button>` : ''}
                    </div>
                </div>
            `).join('');

            setInterval(() => {
                const slides = document.querySelectorAll('.hero-slide');
                slides[currentSlide].classList.remove('active');
                currentSlide = (currentSlide + 1) % slides.length;
                slides[currentSlide].classList.add('active');
            }, 5000);
        }

        // ✅ چاککردنی displaySlidesManager
        function displaySlidesManager() {
            const manager = document.getElementById('slidesManager');
            if (!manager) return;
            
            if (allSlides.length === 0) {
                manager.innerHTML = '<p style="padding: 20px; text-align: center; color: var(--text-secondary);">هیچ slide ێک نییە</p>';
                return;
            }

            manager.innerHTML = allSlides.map(slide => `
                <div class="list-item">
                    <div style="flex: 1;">
                        <div style="font-weight: 600; margin-bottom: 5px;">${slide.title}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">
                            ${slide.description || 'وەسف نییە'}
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-danger" onclick="deleteSlide('${slide.id}')">
                            <i class="fas fa-trash"></i> سڕینەوە
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ✅ چاککردنی displayGenresManager
        function displayGenresManager() {
            const manager = document.getElementById('genresManager');
            if (!manager) return;
            
            if (allGenres.length === 0) {
                manager.innerHTML = '<p style="padding: 20px; text-align: center; color: var(--text-secondary);">هیچ ژانەرێک نییە</p>';
                return;
            }

            manager.innerHTML = allGenres.map(genre => `
                <div class="list-item">
                    <div style="flex: 1;">
                        <div style="font-weight: 600; margin-bottom: 5px;">
                            ${genre.icon ? `<i class="fas ${genre.icon}"></i>` : ''} ${genre.name}
                        </div>
                        <div style="font-size: 12px; color: var(--text-secondary);">
                            کۆد: ${genre.value}
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-danger" onclick="deleteGenre('${genre.id}')">
                            <i class="fas fa-trash"></i> سڕینەوە
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ✅ چاککردنی displayStaffManager
        function displayStaffManager() {
            const manager = document.getElementById('staffManager');
            if (!manager) return;
            
            if (allStaff.length === 0) {
                manager.innerHTML = '<p style="padding: 20px; text-align: center; color: var(--text-secondary);">هیچ ئەندامێکی ستاف نییە</p>';
                return;
            }

            manager.innerHTML = allStaff.map(staff => `
                <div class="list-item">
                    <div style="flex: 1;">
                        <div style="font-weight: 600; margin-bottom: 5px;">${staff.name}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">
                            ${staff.role}
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn btn-danger" onclick="deleteStaff('${staff.id}')">
                            <i class="fas fa-trash"></i> سڕینەوە
                        </button>
                    </div>
                </div>
            `).join('');
        }

        // ✅ چاککردنی displayStaffPage
        function displayStaffPage() {
            const grid = document.getElementById('staffGrid');
            if (!grid) return;
            
            if (allStaff.length === 0) {
                grid.innerHTML = '<div style="padding: 60px; text-align: center; color: var(--text-secondary); grid-column: 1/-1;">هیچ ئەندامێکی ستاف زیاد نەکراوە</div>';
                return;
            }

            grid.innerHTML = allStaff.map(staff => `
                <div class="staff-card">
                    <img src="${staff.image}" alt="${staff.name}" class="staff-image" onerror="this.src='https://via.placeholder.com/150/e94560/ffffff?text=${staff.name[0]}'">
                    <div class="staff-name">${staff.name}</div>
                    <div class="staff-role">${staff.role}</div>
                    ${staff.bio ? `<p style="font-size: 13px; color: var(--text-secondary); margin-top: 10px;">${staff.bio}</p>` : ''}
                    <div class="staff-social">
                        ${staff.facebook ? `<a href="${staff.facebook}" target="_blank"><i class="fab fa-facebook"></i></a>` : ''}
                        ${staff.instagram ? `<a href="${staff.instagram}" target="_blank"><i class="fab fa-instagram"></i></a>` : ''}
                        ${staff.telegram ? `<a href="${staff.telegram}" target="_blank"><i class="fab fa-telegram"></i></a>` : ''}
                    </div>
                </div>
            `).join('');
        }

        // ✅ چاککردنی updateGenreDropdown بۆ دینامیک بوون
        function updateGenreDropdown() {
            const dropdown = document.getElementById('genreDropdown');
            if (!dropdown) return;
            
            // بەکارهێنانی ژانەرەکانی دیاریکراو لە Database
            if (allGenres.length === 0) {
                // ئەگەر هیچ ژانەرێک لە Database نەبوو، ژانەرە default ەکان بەکاربهێنە
                dropdown.innerHTML = `
                    <a href="#" onclick="setFilter('drama'); closeMobileMenu(); return false;">درامی</a>
                    <a href="#" onclick="setFilter('action'); closeMobileMenu(); return false;">ئاکشن</a>
                    <a href="#" onclick="setFilter('fantasy'); closeMobileMenu(); return false;">خەیاڵی</a>
                    <a href="#" onclick="setFilter('history'); closeMobileMenu(); return false;">مێژووی</a>
                    <a href="#" onclick="setFilter('anime'); closeMobileMenu(); return false;">ئەنیمی</a>
                    <a href="#" onclick="setFilter('horror'); closeMobileMenu(); return false;">تۆقێنەر</a>
                    <a href="#" onclick="setFilter('comedy'); closeMobileMenu(); return false;">کۆمیدی</a>
                    <a href="#" onclick="setFilter('romance'); closeMobileMenu(); return false;">ڕۆمانسی</a>
                `;
                return;
            }
            
            // ژانەرەکان لە Database بەکاربهێنە
            dropdown.innerHTML = allGenres.map(genre => `
                <a href="#" onclick="setFilter('${genre.value}'); closeMobileMenu(); return false;">
                    ${genre.icon ? `<i class="fas ${genre.icon}"></i>` : ''} ${genre.name}
                </a>
            `).join('');
        }

        window.openSlideModal = function() {
            if (!isAdmin) return showToast('⚠️ تەنها ئەدمین');
            document.getElementById('slideEditId').value = '';
            document.getElementById('slideTitle').value = '';
            document.getElementById('slideImage').value = '';
            document.getElementById('slideDescription').value = '';
            document.getElementById('slideContentId').value = '';
            openModal('slideModal');
        };

        window.openGenreModal = function() {
            if (!isAdmin) return showToast('⚠️ تەنها ئەدمین');
            document.getElementById('genreEditId').value = '';
            document.getElementById('genreName').value = '';
            document.getElementById('genreValue').value = '';
            document.getElementById('genreIcon').value = '';
            openModal('genreModal');
        };

        window.openStaffModal = function() {
            if (!isAdmin) return showToast('⚠️ تەنها ئەدمین');
            document.getElementById('staffEditId').value = '';
            document.getElementById('staffName').value = '';
            document.getElementById('staffRole').value = '';
            document.getElementById('staffImage').value = '';
            document.getElementById('staffBio').value = '';
            document.getElementById('staffFacebook').value = '';
            document.getElementById('staffInstagram').value = '';
            document.getElementById('staffTelegram').value = '';
            openModal('staffModal');
        };

        window.saveSlide = async (e) => {
            e.preventDefault();
            if (!isAdmin) return showToast('⚠️ تەنها ئەدمین');

            const data = {
                title: document.getElementById('slideTitle').value.trim(),
                image: document.getElementById('slideImage').value.trim(),
                description: document.getElementById('slideDescription').value.trim(),
                contentId: document.getElementById('slideContentId').value.trim(),
                created: Date.now()
            };

            if (!data.title || !data.image) {
                showToast('⚠️ ناونیشان و وێنە پێویستن');
                return;
            }

            try {
                await push(ref(db, 'slides'), data);
                showToast('✅ Slide زیاد کرا');
                closeModal('slideModal');
            } catch (error) {
                showToast('❌ هەڵە: ' + error.message);
            }
        };

        window.saveGenre = async (e) => {
            e.preventDefault();
            if (!isAdmin) return showToast('⚠️ تەنها ئەدمین');

            const data = {
                name: document.getElementById('genreName').value.trim(),
                value: document.getElementById('genreValue').value.trim(),
                icon: document.getElementById('genreIcon').value.trim()
            };

            if (!data.name || !data.value) {
                showToast('⚠️ ناو و کۆد پێویستن');
                return;
            }

            try {
                await push(ref(db, 'genres'), data);
                showToast('✅ ژانەر زیاد کرا');
                closeModal('genreModal');
            } catch (error) {
                showToast('❌ هەڵە: ' + error.message);
            }
        };

        window.saveStaff = async (e) => {
            e.preventDefault();
            if (!isAdmin) return showToast('⚠️ تەنها ئەدمین');

            const data = {
                name: document.getElementById('staffName').value.trim(),
                role: document.getElementById('staffRole').value.trim(),
                image: document.getElementById('staffImage').value.trim(),
                bio: document.getElementById('staffBio').value.trim(),
                facebook: document.getElementById('staffFacebook').value.trim(),
                instagram: document.getElementById('staffInstagram').value.trim(),
                telegram: document.getElementById('staffTelegram').value.trim()
            };

            if (!data.name || !data.role || !data.image) {
                showToast('⚠️ ناو و پۆست و وێنە پێویستن');
                return;
            }

            try {
                await push(ref(db, 'staff'), data);
                showToast('✅ ئەندامی ستاف زیاد کرا');
                closeModal('staffModal');
            } catch (error) {
                showToast('❌ هەڵە: ' + error.message);
            }
        };

        window.deleteSlide = async (id) => {
            if (!isAdmin) return showToast('⚠️ تەنها ئەدمین');
            if (!confirm('دڵنیایت؟')) return;
            
            try {
                await remove(ref(db, `slides/${id}`));
                showToast('✅ سڕایەوە');
            } catch (error) {
                showToast('❌ هەڵە');
            }
        };

        window.deleteGenre = async (id) => {
            if (!isAdmin) return showToast('⚠️ تەنها ئەدمین');
            if (!confirm('دڵنیایت؟')) return;
            
            try {
                await remove(ref(db, `genres/${id}`));
                showToast('✅ سڕایەوە');
            } catch (error) {
                showToast('❌ هەڵە');
            }
        };

        window.deleteStaff = async (id) => {
            if (!isAdmin) return showToast('⚠️ تەنها ئەدمین');
            if (!confirm('دڵنیایت؟')) return;
            
            try {
                await remove(ref(db, `staff/${id}`));
                showToast('✅ سڕایەوە');
            } catch (error) {
                showToast('❌ هەڵە');
            }
        };

        window.openDetail = (id) => {
            const item = allContent.find(c => c.id === id);
            if (!item) return;

            update(ref(db, `content/${id}`), { views: (item.views || 0) + 1 });

            const detailPage = document.getElementById('detailPage');
            document.getElementById('homeSection').style.display = 'none';
            document.getElementById('staffSection').style.display = 'none';
            document.getElementById('adminPanel').classList.remove('show');
            detailPage.classList.add('active');

            let episodesHTML = '';
            let firstServer = '';
            
            if (item.type === 'series' && item.seasons) {
                firstServer = item.seasons[0]?.episodes[0]?.servers?.server1 || '';
                
                episodesHTML = `
                    <div style="display: flex; gap: 10px; margin: 20px 0; overflow-x: auto; padding: 10px 0;">
                        ${item.seasons.map((season, idx) => `
                            <button class="season-tab ${idx === 0 ? 'active' : ''}" onclick="switchSeason(${idx}, this)">
                                <i class="fas fa-layer-group"></i> ${season.seasonTitle}
                                <span style="opacity: 0.8; font-size: 13px; margin-right: 5px;">(${season.episodes.length} ئەڵقە)</span>
                            </button>
                        `).join('')}
                    </div>
                    
                    ${item.seasons.map((season, seasonIdx) => `
                        <div class="season-episodes" data-season="${seasonIdx}" style="display: ${seasonIdx === 0 ? 'grid' : 'none'}; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                            ${season.episodes.map((ep, epIdx) => `
                                <div class="episode-card ${seasonIdx === 0 && epIdx === 0 ? 'active' : ''}" 
                                     onclick="switchEpisode(${JSON.stringify(ep.servers).replace(/"/g, '&quot;')}, ${JSON.stringify(ep.subtitles || {}).replace(/"/g, '&quot;')}, this)">
                                    <h4>ئەڵقەی ${ep.number}</h4>
                                    <p style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">${ep.title || ''}</p>
                                </div>
                            `).join('')}
                        </div>
                    `).join('')}
                `;
            } else if (item.type === 'series' && item.episodes) {
                firstServer = item.episodes[0]?.servers?.server1 || '';
                episodesHTML = `
                    <div class="episodes-grid">
                        ${item.episodes.map((ep, i) => `
                            <div class="episode-card ${i === 0 ? 'active' : ''}" onclick="switchEpisode(${JSON.stringify(ep.servers).replace(/"/g, '&quot;')}, ${JSON.stringify(ep.subtitles || {}).replace(/"/g, '&quot;')}, this)">
                                <h4>ئەڵقەی ${ep.number}</h4>
                                <p style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">${ep.title || ''}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else {
                firstServer = item.servers?.server1 || '';
            }

            const servers = item.type === 'movie' ? item.servers : 
                           (item.seasons?.[0]?.episodes[0]?.servers || item.episodes?.[0]?.servers || {});
            const subtitles = item.type === 'movie' ? item.subtitles : 
                             (item.seasons?.[0]?.episodes[0]?.subtitles || item.episodes?.[0]?.subtitles || {});
            
            let serverTabsHTML = '';
            if (servers) {
                const serverList = [];
                if (servers.server1) serverList.push({ name: 'سێرڤەر 1', url: servers.server1 });
                if (servers.server2) serverList.push({ name: 'سێرڤەر 2', url: servers.server2 });
                if (servers.server3) serverList.push({ name: 'سێرڤەر 3', url: servers.server3 });
                if (servers.server4) serverList.push({ name: 'سێرڤەر 4', url: servers.server4 });
                
                if (serverList.length > 1) {
                    serverTabsHTML = `
                        <div class="server-tabs">
                            ${serverList.map((s, i) => `
                                <button class="server-tab ${i === 0 ? 'active' : ''}" onclick="switchServer('${s.url}', this)">
                                    ${s.name}
                                </button>
                            `).join('')}
                        </div>
                    `;
                }
            }

            let subtitlesHTML = '';
            if (subtitles && (subtitles.sub1 || subtitles.sub2)) {
                subtitlesHTML = `
                    <div style="margin: 20px 0; padding: 15px; background: var(--bg-card); border-radius: 8px;">
                        <h4 style="margin-bottom: 10px; color: var(--accent-primary);">📄 ژێرنووسەکان:</h4>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            ${subtitles.sub1 ? `<a href="${subtitles.sub1}" download class="btn btn-secondary">⬇️ داگرتنی ژێرنووس 1</a>` : ''}
                            ${subtitles.sub2 ? `<a href="${subtitles.sub2}" download class="btn btn-secondary">⬇️ داگرتنی ژێرنووس 2</a>` : ''}
                        </div>
                    </div>
                `;
            }

            const genreNames = {
                drama: 'درامی', action: 'ئاکشن', fantasy: 'خەیاڵی', history: 'مێژووی',
                anime: 'ئەنیمی', horror: 'تۆقێنەر', comedy: 'کۆمیدی', romance: 'ڕۆمانسی'
            };
            const genreName = genreNames[item.genre] || item.genre || '';

            const subTypeNames = {
                subtitled: 'ژێرنووسکراو',
                dubbed: 'دۆبلاژکراو'
            };
            const subTypeName = subTypeNames[item.subType] || '';

            const actors = item.actors ? item.actors.split(',').map(a => a.trim()) : [];
            const actorsHTML = actors.length > 0 ? `
                <div class="cast-grid">
                    ${actors.map(actor => `
                        <div class="cast-item">
                            <div class="cast-avatar">${actor.charAt(0).toUpperCase()}</div>
                            <div class="cast-name">${actor}</div>
                        </div>
                    `).join('')}
                </div>
            ` : '<p style="color: var(--text-secondary);">زانیاری نییە</p>';

            detailPage.innerHTML = `
                <div class="container">
                    <button class="btn btn-secondary" onclick="closeDetail()" style="margin-bottom: 20px;">
                        <i class="fas fa-arrow-right"></i> گەڕانەوە
                    </button>

                    <div class="detail-header">
                        <div class="detail-layout">
                            <div class="detail-poster-main" onclick="scrollToPlayer()">
                                <img src="${item.poster}" alt="${item.title}">
                                <div class="detail-play-overlay">
                                    <div class="detail-play-btn">
                                        <i class="fas fa-play"></i>
                                    </div>
                                </div>
                            </div>

                            <div class="detail-info">
                                <h1 class="detail-title">${item.title}</h1>
                                
                                <div class="detail-badges">
                                    ${item.rating ? `<div class="detail-rating">⭐ ${item.rating}/10</div>` : ''}
                                    <div class="detail-badge">
                                        <i class="fas fa-calendar"></i> ${item.year || '2024'}
                                    </div>
                                    <div class="detail-badge">
                                        <i class="fas fa-eye"></i> ${(item.views || 0).toLocaleString()}
                                    </div>
                                    ${item.type === 'series' && item.seasons ? `
                                        <div class="detail-badge">
                                            <i class="fas fa-layer-group"></i> ${item.seasons.length} وەرز
                                        </div>
                                        <div class="detail-badge">
                                            <i class="fas fa-film"></i> ${item.totalEpisodes || 0} ئەڵقە
                                        </div>
                                    ` : ''}
                                    ${genreName ? `<div class="detail-badge"><i class="fas fa-tag"></i> ${genreName}</div>` : ''}
                                    ${subTypeName ? `<div class="detail-badge"><i class="fas fa-language"></i> ${subTypeName}</div>` : ''}
                                </div>

                                ${item.description ? `<p class="detail-description">${item.description}</p>` : ''}

                                <div class="detail-meta-grid">
                                    ${item.producer ? `
                                        <div class="detail-meta-item">
                                            <div class="detail-meta-label">بەرهەمهێنەر:</div>
                                            <div class="detail-meta-value">${item.producer}</div>
                                        </div>
                                    ` : ''}
                                    ${item.director ? `
                                        <div class="detail-meta-item">
                                            <div class="detail-meta-label">دەرهێنەر:</div>
                                            <div class="detail-meta-value">${item.director}</div>
                                        </div>
                                    ` : ''}
                                    ${item.writer ? `
                                        <div class="detail-meta-item">
                                            <div class="detail-meta-label">نووسەر:</div>
                                            <div class="detail-meta-value">${item.writer}</div>
                                        </div>
                                    ` : ''}
                                    <div class="detail-meta-item">
                                        <div class="detail-meta-label">جۆر:</div>
                                        <div class="detail-meta-value">${item.type === 'series' ? 'زنجیرە' : 'فیلم'}</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="detail-tabs">
                        <button class="detail-tab active" onclick="switchDetailTab(0, this)">
                            <i class="fas fa-play-circle"></i> بینین
                        </button>
                        ${item.trailer ? `
                            <button class="detail-tab" onclick="switchDetailTab(1, this)">
                                <i class="fas fa-film"></i> ترەیلەر
                            </button>
                        ` : ''}
                        <button class="detail-tab" onclick="switchDetailTab(2, this)">
                            <i class="fas fa-users"></i> ئەکتەرەکان
                        </button>
                        <button class="detail-tab" onclick="switchDetailTab(3, this)">
                            <i class="fas fa-comments"></i> کۆمێنتەکان (${item.commentsCount || 0})
                        </button>
                    </div>

                    <div class="detail-tab-content active" data-tab="0" id="playerSection">
                        ${firstServer ? `
                            <div class="video-container">
                                <iframe id="videoPlayer" class="video-player" src="${firstServer}" allowfullscreen allow="autoplay"></iframe>
                            </div>
                        ` : '<p style="text-align: center; padding: 40px; color: var(--text-secondary);">هیچ سێرڤەرێک زیاد نەکراوە</p>'}

                        ${serverTabsHTML}
                        ${subtitlesHTML}
                        ${episodesHTML}
                    </div>

                    ${item.trailer ? `
                        <div class="detail-tab-content" data-tab="1">
                            <div class="video-container">
                                <iframe class="video-player" src="${item.trailer}" allowfullscreen allow="autoplay"></iframe>
                            </div>
                        </div>
                    ` : ''}

                    <div class="detail-tab-content" data-tab="2">
                        <h3 style="margin-bottom: 20px; font-size: 22px;">
                            <i class="fas fa-users"></i> ئەکتەرەکان
                        </h3>
                        ${actorsHTML}
                    </div>

                    <div class="detail-tab-content" data-tab="3">
                        <div class="comments-section">
                            <h3 style="margin-bottom: 20px; font-size: 22px;">💬 لێدوانەکان (${item.commentsCount || 0})</h3>
                            
                            ${currentUser ? `
                                <div class="comment-form">
                                    <textarea id="commentText" placeholder="لێدوانەکەت بنووسە..."></textarea>
                                    <button class="btn btn-primary" onclick="postComment('${id}')" style="margin-top: 10px;">
                                        <i class="fas fa-paper-plane"></i> ناردن
                                    </button>
                                </div>
                            ` : `
                                <div style="text-align: center; padding: 20px; background: var(--bg-secondary); border-radius: 8px;">
                                    <p style="margin-bottom: 15px;">تکایە چوونەژوورەوە بکە بۆ نووسینی لێدوان</p>
                                    <button class="btn btn-primary" onclick="openAuthModal()">
                                        چوونەژوورەوە
                                    </button>
                                </div>
                            `}

                            <div id="commentsList" style="margin-top: 30px;"></div>
                        </div>
                    </div>
                </div>
            `;

            loadComments(id);
        };

        window.switchDetailTab = (tabIndex, button) => {
            document.querySelectorAll('.detail-tab').forEach(tab => tab.classList.remove('active'));
            button.classList.add('active');
            
            document.querySelectorAll('.detail-tab-content').forEach(content => {
                content.classList.remove('active');
            });
            document.querySelector(`.detail-tab-content[data-tab="${tabIndex}"]`).classList.add('active');
        };

        window.scrollToPlayer = () => {
            const playerSection = document.getElementById('playerSection');
            if (playerSection) {
                playerSection.scrollIntoView({ behavior: 'smooth' });
            }
        };

        window.closeDetail = () => {
            document.getElementById('detailPage').classList.remove('active');
            document.getElementById('homeSection').style.display = 'block';
            document.getElementById('staffSection').style.display = 'none';
        };

        window.switchSeason = (seasonIndex, btn) => {
            document.querySelectorAll('.season-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            btn.classList.add('active');
            
            document.querySelectorAll('.season-episodes').forEach(seasonDiv => {
                seasonDiv.style.display = 'none';
            });
            document.querySelector(`.season-episodes[data-season="${seasonIndex}"]`).style.display = 'grid';
            
            const firstEpisode = document.querySelector(`.season-episodes[data-season="${seasonIndex}"] .episode-card`);
            if (firstEpisode) {
                firstEpisode.click();
            }
        };

        window.switchEpisode = (servers, subtitles, card) => {
            document.querySelectorAll('.episode-card').forEach(c => c.classList.remove('active'));
            card.classList.add('active');
            
            if (servers.server1) {
                document.getElementById('videoPlayer').src = servers.server1;
            }
            
            const serverList = [];
            if (servers.server1) serverList.push({ name: 'سێرڤەر 1', url: servers.server1 });
            if (servers.server2) serverList.push({ name: 'سێرڤەر 2', url: servers.server2 });
            if (servers.server3) serverList.push({ name: 'سێرڤەر 3', url: servers.server3 });
            if (servers.server4) serverList.push({ name: 'سێرڤەر 4', url: servers.server4 });
            
            const serverTabsContainer = document.querySelector('.server-tabs');
            if (serverTabsContainer && serverList.length > 1) {
                serverTabsContainer.innerHTML = serverList.map((s, i) => `
                    <button class="server-tab ${i === 0 ? 'active' : ''}" onclick="switchServer('${s.url}', this)">
                        ${s.name}
                    </button>
                `).join('');
            }
        };

        window.switchServer = (url, btn) => {
            document.querySelectorAll('.server-tab').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('videoPlayer').src = url;
        };

        function loadComments(contentId) {
            onValue(ref(db, `comments/${contentId}`), (snapshot) => {
                const comments = [];
                snapshot.forEach((child) => {
                    comments.push({ id: child.key, ...child.val() });
                });
                
                comments.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                const list = document.getElementById('commentsList');
                if (comments.length === 0) {
                    list.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">هیچ لێدوانێک نییە</p>';
                    return;
                }

                list.innerHTML = comments.map(comment => `
                    <div class="comment">
                        <div class="comment-header">
                            <div class="comment-avatar">${comment.userName[0].toUpperCase()}</div>
                            <div>
                                <div class="comment-author">${comment.userName}</div>
                                <div class="comment-date">${formatDate(comment.date)}</div>
                            </div>
                            ${(currentUser && currentUser.uid === comment.userId) || isAdmin ? `
                                <button class="btn btn-danger" onclick="deleteComment('${contentId}', '${comment.id}')" style="margin-right: auto; padding: 6px 12px;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </div>
                        <div class="comment-text">${comment.text}</div>
                    </div>
                `).join('');
            });
        }

        window.postComment = async (contentId) => {
            if (!currentUser) {
                showToast('⚠️ تکایە چوونەژوورەوە بکە');
                return;
            }

            const text = document.getElementById('commentText').value.trim();
            if (!text) {
                showToast('⚠️ لێدوانەکەت بنووسە');
                return;
            }

            try {
                await push(ref(db, `comments/${contentId}`), {
                    text: text,
                    userId: currentUser.uid,
                    userName: currentUser.displayName || currentUser.email.split('@')[0],
                    date: new Date().toISOString()
                });

                const item = allContent.find(c => c.id === contentId);
                await update(ref(db, `content/${contentId}`), {
                    commentsCount: (item.commentsCount || 0) + 1
                });

                document.getElementById('commentText').value = '';
                showToast('✅ لێدوانەکەت نێردرا');
            } catch (error) {
                showToast('❌ هەڵە ڕوویدا');
            }
        };

        window.deleteComment = async (contentId, commentId) => {
            if (!confirm('دڵنیایت؟')) return;
            
            try {
                await remove(ref(db, `comments/${contentId}/${commentId}`));
                
                const item = allContent.find(c => c.id === contentId);
                await update(ref(db, `content/${contentId}`), {
                    commentsCount: Math.max(0, (item.commentsCount || 0) - 1)
                });
                
                showToast('✅ سڕایەوە');
            } catch (error) {
                showToast('❌ هەڵە');
            }
        };

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const now = new Date();
            const diff = Math.floor((now - date) / 1000);

            if (diff < 60) return 'ئێستا';
            if (diff < 3600) return Math.floor(diff / 60) + ' خولەک پێش ئێستا';
            if (diff < 86400) return Math.floor(diff / 3600) + ' کاتژمێر پێش ئێستا';
            return Math.floor(diff / 86400) + ' ڕۆژ پێش ئێستا';
        }

        window.handleAuth = async (e, mode) => {
            e.preventDefault();
            
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;

            try {
                if (mode === 'login') {
                    await signInWithEmailAndPassword(auth, email, password);
                    showToast('✅ بەسەرکەوتوویی چوویتەژوورەوە');
                } else {
                    await createUserWithEmailAndPassword(auth, email, password);
                    showToast('✅ هەژمار دروست کرا');
                }
                closeModal('authModal');
                
                if (showAdminPanel) {
                    setTimeout(() => {
                        checkAdminStatus(currentUser.uid);
                    }, 500);
                }
            } catch (error) {
                let errorMsg = '❌ هەڵە ڕوویدا';
                if (error.code === 'auth/email-already-in-use') {
                    errorMsg = '❌ ئەم ئیمەیڵە پێشتر بەکارهێنراوە';
                } else if (error.code === 'auth/wrong-password' || error.code === 'auth/user-not-found') {
                    errorMsg = '❌ ئیمەیڵ یان پاسوۆرد هەڵەیە';
                } else if (error.code === 'auth/weak-password') {
                    errorMsg = '❌ پاسوۆرد لایەنی کەم 6 پیت بێت';
                } else if (error.code === 'auth/invalid-email') {
                    errorMsg = '❌ ئیمەیڵ دروست نییە';
                }
                showToast(errorMsg);
            }
        };

        window.socialLogin = async (provider) => {
            try {
                let authProvider;
                if (provider === 'google') {
                    authProvider = new GoogleAuthProvider();
                } else if (provider === 'facebook') {
                    authProvider = new FacebookAuthProvider();
                }

                await signInWithPopup(auth, authProvider);
                closeModal('authModal');
                showToast('✅ بەسەرکەوتوویی چوویتەژوورەوە');
                
                if (showAdminPanel) {
                    setTimeout(() => {
                        checkAdminStatus(currentUser.uid);
                    }, 500);
                }
            } catch (error) {
                showToast('❌ هەڵە: ' + error.message);
            }
        };

        window.logout = async () => {
            await signOut(auth);
            showToast('✅ چوویتە دەرەوە');
            isAdmin = false;
            showSection('home');
        };

        window.toggleAuthMode = () => {
            authMode = authMode === 'login' ? 'signup' : 'login';
            const form = document.getElementById('loginForm');
            const title = document.querySelector('#authModal .modal-title');
            const btn = form.querySelector('button[type="submit"]');
            const link = document.querySelector('#authModal a');
            
            if (authMode === 'signup') {
                title.textContent = 'دروستکردنی هەژمار';
                btn.innerHTML = '<i class="fas fa-user-plus"></i> دروستکردن';
                link.textContent = 'هەژمارت هەیە؟ چوونەژوورەوە';
                form.onsubmit = (e) => handleAuth(e, 'signup');
            } else {
                title.textContent = 'چوونەژوورەوە';
                btn.innerHTML = '<i class="fas fa-sign-in-alt"></i> چوونەژوورەوە';
                link.textContent = 'هەژمارت نییە؟ دروستی بکە';
                form.onsubmit = (e) => handleAuth(e, 'login');
            }
        };

        window.openContentModal = (type) => {
            if (!isAdmin) {
                showToast('⚠️ تەنها ئەدمین دەتوانێت');
                return;
            }
            
            document.getElementById('contentType').value = type;
            document.getElementById('contentEditId').value = '';
            document.getElementById('contentModalTitle').textContent = type === 'movie' ? 'زیادکردنی فیلم' : 'زیادکردنی زنجیرە';
            
            document.getElementById('movieSection').style.display = type === 'movie' ? 'block' : 'none';
            document.getElementById('seriesSection').style.display = type === 'series' ? 'block' : 'none';
            
            document.getElementById('contentModal').querySelectorAll('input, textarea').forEach(el => {
                if (el.type !== 'hidden') el.value = '';
            });
            
            document.getElementById('seasonsContainer').innerHTML = '';
            
            if (type === 'series') {
                addSeason();
            }
            
            openModal('contentModal');
        };

        window.addSeason = () => {
            const container = document.getElementById('seasonsContainer');
            const seasonNum = container.children.length + 1;
            
            const seasonDiv = document.createElement('div');
            seasonDiv.style.cssText = 'background: var(--bg-card); padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 2px solid var(--accent-primary);';
            seasonDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h4 style="color: var(--accent-primary); font-size: 18px;">
                        <i class="fas fa-layer-group"></i> وەرزی ${seasonNum}
                    </h4>
                    <button type="button" class="btn btn-danger" onclick="this.parentElement.parentElement.remove()">
                        <i class="fas fa-trash"></i> سڕینەوەی وەرز
                    </button>
                </div>
                <div class="form-group">
                    <label>ژمارەی وەرز *</label>
                    <input type="number" class="season-number" value="${seasonNum}" required style="max-width: 150px;">
                </div>
                <div class="form-group">
                    <label>ناوی وەرز (ئیختیاری)</label>
                    <input type="text" class="season-title" placeholder="بۆ نموونە: وەرزی یەکەم">
                </div>
                <h5 style="margin: 15px 0; color: var(--text-secondary);">ئەڵقەکانی ئەم وەرزە:</h5>
                <div class="episodes-container-season"></div>
                <button type="button" class="btn btn-secondary" onclick="addEpisodeToSeason(this)" style="margin-top: 10px;">
                    <i class="fas fa-plus"></i> زیادکردنی ئەڵقە بۆ ئەم وەرزە
                </button>
            `;
            container.appendChild(seasonDiv);
            
            const addBtn = seasonDiv.querySelector('.btn-secondary');
            addEpisodeToSeason(addBtn);
        };

        window.addEpisodeToSeason = (button) => {
            const seasonDiv = button.closest('[style*="background: var(--bg-card)"]');
            const episodesContainer = seasonDiv.querySelector('.episodes-container-season');
            const episodeNum = episodesContainer.children.length + 1;
            
            const episodeDiv = document.createElement('div');
            episodeDiv.style.cssText = 'background: var(--bg-secondary); padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 3px solid var(--accent-primary);';
            episodeDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h5 style="color: var(--text-primary); margin: 0;">ئەڵقەی ${episodeNum}</h5>
                    <button type="button" class="btn btn-danger" onclick="this.parentElement.parentElement.remove()" style="padding: 5px 10px; font-size: 12px;">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <div class="form-group">
                    <label>ژمارەی ئەڵقە *</label>
                    <input type="number" class="ep-number" value="${episodeNum}" required style="max-width: 120px;">
                </div>
                <div class="form-group">
                    <label>ناونیشانی ئەڵقە</label>
                    <input type="text" class="ep-title" placeholder="ناونیشان (ئیختیاری)">
                </div>
                <div class="form-group">
                    <label>🎥 سێرڤەر 1 (Upstream) *</label>
                    <input type="url" class="ep-server1" placeholder="https://..." required>
                </div>
                <div class="form-group">
                    <label>🎥 سێرڤەر 2 (Filemoon)</label>
                    <input type="url" class="ep-server2" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label>🎥 سێرڤەر 3 (MixDrop)</label>
                    <input type="url" class="ep-server3" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label>🎥 سێرڤەر 4 (بێ ڕیکلام)</label>
                    <input type="url" class="ep-server4" placeholder="https://...">
                </div>
                <div class="form-group">
                    <label>📄 ژێرنووس 1 (SRT)</label>
                    <input type="url" class="ep-subtitle1" placeholder="https://...subtitle.srt">
                </div>
                <div class="form-group">
                    <label>📄 ژێرنووس 2 (SRT)</label>
                    <input type="url" class="ep-subtitle2" placeholder="https://...subtitle.srt">
                </div>
            `;
            episodesContainer.appendChild(episodeDiv);
        };

        window.saveContent = async (e) => {
            e.preventDefault();
            
            if (!isAdmin) {
                showToast('⚠️ تەنها ئەدمین دەتوانێت');
                return;
            }
            
            const type = document.getElementById('contentType').value;
            const id = document.getElementById('contentEditId').value;

            const data = {
                type: type,
                title: document.getElementById('contentTitle').value.trim(),
                poster: document.getElementById('contentPoster').value.trim(),
                year: document.getElementById('contentYear').value.trim() || '2024',
                rating: parseFloat(document.getElementById('contentRating').value) || 0,
                description: document.getElementById('contentDescription').value.trim(),
                subType: document.getElementById('contentSubType').value,
                genre: document.getElementById('contentGenre').value,
                producer: document.getElementById('contentProducer').value.trim(),
                director: document.getElementById('contentDirector').value.trim(),
                writer: document.getElementById('contentWriter').value.trim(),
                actors: document.getElementById('contentActors').value.trim(),
                trailer: document.getElementById('contentTrailer').value.trim(),
                date: new Date().toISOString(),
                views: 0,
                commentsCount: 0
            };

            if (type === 'movie') {
                const servers = {};
                const server1 = document.getElementById('movieServer1').value.trim();
                if (!server1) {
                    showToast('⚠️ لایەنی کەم سێرڤەر 1 پڕ بکەرەوە');
                    return;
                }
                servers.server1 = server1;
                if (document.getElementById('movieServer2').value.trim()) servers.server2 = document.getElementById('movieServer2').value.trim();
                if (document.getElementById('movieServer3').value.trim()) servers.server3 = document.getElementById('movieServer3').value.trim();
                if (document.getElementById('movieServer4').value.trim()) servers.server4 = document.getElementById('movieServer4').value.trim();
                
                data.servers = servers;
                
                const subtitles = {};
                if (document.getElementById('movieSubtitle1').value.trim()) subtitles.sub1 = document.getElementById('movieSubtitle1').value.trim();
                if (document.getElementById('movieSubtitle2').value.trim()) subtitles.sub2 = document.getElementById('movieSubtitle2').value.trim();
                data.subtitles = subtitles;
            } else {
                const seasons = [];
                document.querySelectorAll('#seasonsContainer > div').forEach(seasonDiv => {
                    const seasonNumber = parseInt(seasonDiv.querySelector('.season-number').value);
                    const seasonTitle = seasonDiv.querySelector('.season-title').value.trim();
                    
                    const episodes = [];
                    seasonDiv.querySelectorAll('.episodes-container-season > div').forEach(ep => {
                        const server1 = ep.querySelector('.ep-server1').value.trim();
                        if (server1) {
                            const epData = {
                                number: parseInt(ep.querySelector('.ep-number').value),
                                title: ep.querySelector('.ep-title').value.trim(),
                                servers: { server1: server1 }
                            };
                            
                            if (ep.querySelector('.ep-server2')?.value.trim()) epData.servers.server2 = ep.querySelector('.ep-server2').value.trim();
                            if (ep.querySelector('.ep-server3')?.value.trim()) epData.servers.server3 = ep.querySelector('.ep-server3').value.trim();
                            if (ep.querySelector('.ep-server4')?.value.trim()) epData.servers.server4 = ep.querySelector('.ep-server4').value.trim();
                            
                            const subs = {};
                            if (ep.querySelector('.ep-subtitle1')?.value.trim()) subs.sub1 = ep.querySelector('.ep-subtitle1').value.trim();
                            if (ep.querySelector('.ep-subtitle2')?.value.trim()) subs.sub2 = ep.querySelector('.ep-subtitle2').value.trim();
                            if (Object.keys(subs).length > 0) epData.subtitles = subs;
                            
                            episodes.push(epData);
                        }
                    });
                    
                    if (episodes.length > 0) {
                        seasons.push({
                            seasonNumber: seasonNumber,
                            seasonTitle: seasonTitle || `وەرزی ${seasonNumber}`,
                            episodes: episodes.sort((a, b) => a.number - b.number)
                        });
                    }
                });
                
                if (seasons.length === 0) {
                    showToast('⚠️ لایەنی کەم یەک وەرز و ئەڵقە زیاد بکە');
                    return;
                }
                
                data.seasons = seasons.sort((a, b) => a.seasonNumber - b.seasonNumber);
                data.totalEpisodes = seasons.reduce((sum, s) => sum + s.episodes.length, 0);
            }

            try {
                if (id) {
                    const existing = allContent.find(c => c.id === id);
                    data.views = existing?.views || 0;
                    data.commentsCount = existing?.commentsCount || 0;
                    await update(ref(db, `content/${id}`), data);
                    showToast('✅ دەستکاری کرا');
                } else {
                    await push(ref(db, 'content'), data);
                    showToast('✅ زیاد کرا');
                }
                closeModal('contentModal');
            } catch (error) {
                showToast('❌ هەڵە: ' + error.message);
            }
        };

        function displayContentManager() {
            const manager = document.getElementById('contentManager');
            if (allContent.length === 0) {
                manager.innerHTML = '<p style="padding: 20px; text-align: center; color: var(--text-secondary);">هیچ ناوەڕۆکێک نییە</p>';
                return;
            }

            manager.innerHTML = allContent.map(item => `
                <div class="list-item">
                    <div style="flex: 1;">
                        <div style="font-weight: 600; margin-bottom: 5px;">${item.title}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">
                            <span style="background: var(--bg-primary); padding: 3px 8px; border-radius: 4px; margin-left: 8px;">
                                ${item.type === 'series' ? '📺 زنجیرە' : '🎬 فیلم'}
                            </span>
                            <span>${item.year || ''}</span>
                            ${item.type === 'series' && item.seasons ? ` • ${item.seasons.length} وەرز • ${item.totalEpisodes || 0} ئەڵقە` : 
                              item.type === 'series' && item.episodes ? ` • ${item.episodes?.length || 0} ئەڵقە` : ''}
                            • 👁️ ${item.views || 0}
                            • 💬 ${item.commentsCount || 0}
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <button class="btn" style="background: #2196F3; color: white;" onclick="editContent('${item.id}')">
                            <i class="fas fa-edit"></i> دەستکاری
                        </button>
                        <button class="btn btn-danger" onclick="deleteContent('${item.id}')">
                            <i class="fas fa-trash"></i> سڕینەوە
                        </button>
                    </div>
                </div>
            `).join('');
        }

        window.editContent = (id) => {
            const item = allContent.find(c => c.id === id);
            if (!item) return;
            
            document.getElementById('contentType').value = item.type;
            document.getElementById('contentEditId').value = id;
            document.getElementById('contentModalTitle').textContent = item.type === 'movie' ? 'دەستکاریکردنی فیلم' : 'دەستکاریکردنی زنجیرە';
            document.getElementById('contentTitle').value = item.title;
            document.getElementById('contentPoster').value = item.poster;
            document.getElementById('contentYear').value = item.year || '';
            document.getElementById('contentRating').value = item.rating || '';
            document.getElementById('contentDescription').value = item.description || '';
            document.getElementById('contentSubType').value = item.subType || '';
            document.getElementById('contentGenre').value = item.genre || '';
            document.getElementById('contentProducer').value = item.producer || '';
            document.getElementById('contentDirector').value = item.director || '';
            document.getElementById('contentWriter').value = item.writer || '';
            document.getElementById('contentActors').value = item.actors || '';
            document.getElementById('contentTrailer').value = item.trailer || '';
            
            document.getElementById('movieSection').style.display = item.type === 'movie' ? 'block' : 'none';
            document.getElementById('seriesSection').style.display = item.type === 'series' ? 'block' : 'none';
            
            if (item.type === 'movie') {
                document.getElementById('movieServer1').value = item.servers?.server1 || '';
                document.getElementById('movieServer2').value = item.servers?.server2 || '';
                document.getElementById('movieServer3').value = item.servers?.server3 || '';
                document.getElementById('movieServer4').value = item.servers?.server4 || '';
                document.getElementById('movieSubtitle1').value = item.subtitles?.sub1 || '';
                document.getElementById('movieSubtitle2').value = item.subtitles?.sub2 || '';
            } else if (item.seasons) {
                const container = document.getElementById('seasonsContainer');
                container.innerHTML = '';
                
                item.seasons.forEach(season => {
                    const seasonDiv = document.createElement('div');
                    seasonDiv.style.cssText = 'background: var(--bg-card); padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 2px solid var(--accent-primary);';
                    seasonDiv.innerHTML = `
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                            <h4 style="color: var(--accent-primary); font-size: 18px;">
                                <i class="fas fa-layer-group"></i> ${season.seasonTitle}
                            </h4>
                            <button type="button" class="btn btn-danger" onclick="this.parentElement.parentElement.remove()">
                                <i class="fas fa-trash"></i> سڕینەوەی وەرز
                            </button>
                        </div>
                        <div class="form-group">
                            <label>ژمارەی وەرز *</label>
                            <input type="number" class="season-number" value="${season.seasonNumber}" required style="max-width: 150px;">
                        </div>
                        <div class="form-group">
                            <label>ناوی وەرز (ئیختیاری)</label>
                            <input type="text" class="season-title" value="${season.seasonTitle}" placeholder="بۆ نموونە: وەرزی یەکەم">
                        </div>
                        <h5 style="margin: 15px 0; color: var(--text-secondary);">ئەڵقەکانی ئەم وەرزە:</h5>
                        <div class="episodes-container-season"></div>
                        <button type="button" class="btn btn-secondary" onclick="addEpisodeToSeason(this)" style="margin-top: 10px;">
                            <i class="fas fa-plus"></i> زیادکردنی ئەڵقە بۆ ئەم وەرزە
                        </button>
                    `;
                    container.appendChild(seasonDiv);
                    
                    const episodesContainer = seasonDiv.querySelector('.episodes-container-season');
                    season.episodes.forEach(ep => {
                        const episodeDiv = document.createElement('div');
                        episodeDiv.style.cssText = 'background: var(--bg-secondary); padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 3px solid var(--accent-primary);';
                        episodeDiv.innerHTML = `
                            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <h5 style="color: var(--text-primary); margin: 0;">ئەڵقەی ${ep.number}</h5>
                                <button type="button" class="btn btn-danger" onclick="this.parentElement.parentElement.remove()" style="padding: 5px 10px; font-size: 12px;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                            <div class="form-group">
                                <label>ژمارەی ئەڵقە *</label>
                                <input type="number" class="ep-number" value="${ep.number}" required style="max-width: 120px;">
                            </div>
                            <div class="form-group">
                                <label>ناونیشانی ئەڵقە</label>
                                <input type="text" class="ep-title" value="${ep.title || ''}" placeholder="ناونیشان (ئیختیاری)">
                            </div>
                            <div class="form-group">
                                <label>🎥 سێرڤەر 1 (Upstream) *</label>
                                <input type="url" class="ep-server1" value="${ep.servers?.server1 || ''}" placeholder="https://..." required>
                            </div>
                            <div class="form-group">
                                <label>🎥 سێرڤەر 2 (Filemoon)</label>
                                <input type="url" class="ep-server2" value="${ep.servers?.server2 || ''}" placeholder="https://...">
                            </div>
                            <div class="form-group">
                                <label>🎥 سێرڤەر 3 (MixDrop)</label>
                                <input type="url" class="ep-server3" value="${ep.servers?.server3 || ''}" placeholder="https://...">
                            </div>
                            <div class="form-group">
                                <label>🎥 سێرڤەر 4 (بێ ڕیکلام)</label>
                                <input type="url" class="ep-server4" value="${ep.servers?.server4 || ''}" placeholder="https://...">
                            </div>
                            <div class="form-group">
                                <label>📄 ژێرنووس 1 (SRT)</label>
                                <input type="url" class="ep-subtitle1" value="${ep.subtitles?.sub1 || ''}" placeholder="https://...subtitle.srt">
                            </div>
                            <div class="form-group">
                                <label>📄 ژێرنووس 2 (SRT)</label>
                                <input type="url" class="ep-subtitle2" value="${ep.subtitles?.sub2 || ''}" placeholder="https://...subtitle.srt">
                            </div>
                        `;
                        episodesContainer.appendChild(episodeDiv);
                    });
                });
            }
            
            openModal('contentModal');
        };

        window.deleteContent = async (id) => {
            if (!isAdmin) return showToast('⚠️ تەنها ئەدمین دەتوانێت');
            if (!confirm('دڵنیایت دەتەوێت بسڕیتەوە؟')) return;
            
            try {
                await remove(ref(db, `content/${id}`));
                await remove(ref(db, `comments/${id}`));
                showToast('✅ سڕایەوە');
            } catch (error) {
                console.error('Delete error:', error);
                showToast('❌ هەڵە: ' + error.message);
            }
        };

        window.setFilter = (filter) => {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            if (event?.target) event.target.classList.add('active');
            displayContent();
        };

        window.performSearch = () => {
            const term = document.getElementById('searchInput').value.toLowerCase().trim();
            if (!term) {
                currentFilter = 'all';
                displayContent();
                return;
            }

            const grid = document.getElementById('moviesGrid');
            const filtered = allContent.filter(c => 
                c.title?.toLowerCase().includes(term) ||
                c.description?.toLowerCase().includes(term)
            );

            if (filtered.length === 0) {
                grid.innerHTML = '<div style="padding: 60px; text-align: center;">هیچ ئەنجامێک نەدۆزرایەوە</div>';
                return;
            }

            grid.innerHTML = filtered.map(item => `
                <div class="movie-card" onclick="openDetail('${item.id}')">
                    <div class="movie-poster">
                        <img src="${item.poster}" alt="${item.title}">
                        <div class="play-icon"><i class="fas fa-play"></i></div>
                    </div>
                    <div class="movie-info">
                        <div class="movie-title">${item.title}</div>
                        <div class="movie-meta"><span>${item.year || ''}</span></div>
                    </div>
                </div>
            `).join('');
        };
    </script>
</body>
</html>
