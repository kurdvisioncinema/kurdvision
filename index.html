<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ú©ÙˆØ±Ø¯ Ú¤ÛŒÚ˜Ù† Pro - Ú†Ø§Ú©Ú©Ø±Ø§ÙˆÛ•</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Arabic:wght@300;400;600;700&family=Tajawal:wght@400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg-primary: #0f0f1e;
            --bg-secondary: #1a1a2e;
            --bg-card: #16213e;
            --accent-primary: #e94560;
            --text-primary: #f1f1f1;
            --text-secondary: #a0a0a0;
            --success: #00ff88;
        }
        
        body {
            font-family: 'Tajawal', 'Noto Sans Arabic', sans-serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.8;
            overflow-x: hidden;
            transition: background 0.3s, color 0.3s;
        }

        body.light-mode {
            --bg-primary: #f5f5f5;
            --bg-secondary: #ffffff;
            --bg-card: #ffffff;
            --text-primary: #1a1a1a;
            --text-secondary: #666666;
        }

        body.light-mode header {
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        h1, h2, h3, h4, h5, h6 { font-family: 'Tajawal', 'Noto Sans Arabic', sans-serif; font-weight: 700; }

        header {
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(233, 69, 96, 0.1);
        }

        nav {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-search {
            flex: 1;
            max-width: 500px;
            position: relative;
        }

        .nav-search input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            background: var(--bg-card);
            border: 1px solid transparent;
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            direction: rtl;
            text-align: right;
        }

        .nav-search input:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .nav-search button {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
            font-size: 16px;
        }

        .nav-links {
            display: flex;
            gap: 5px;
            list-style: none;
            align-items: center;
        }

        .nav-links a {
            padding: 8px 15px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .nav-links a:hover, .nav-links a.active {
            color: var(--accent-primary);
            background: rgba(233, 69, 96, 0.1);
        }

        .mobile-menu-btn {
            display: none;
            background: var(--bg-card);
            border: none;
            color: var(--text-primary);
            font-size: 22px;
            cursor: pointer;
            padding: 8px 12px;
            border-radius: 6px;
            transition: all 0.3s;
        }

        .mobile-menu-btn:hover {
            background: var(--accent-primary);
            color: white;
        }

        .theme-toggle {
            background: var(--bg-card);
            border: none;
            color: var(--text-primary);
            padding: 8px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 18px;
            transition: all 0.3s;
        }

        .theme-toggle:hover {
            background: var(--accent-primary);
            color: white;
        }

        .user-menu {
            position: relative;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid var(--accent-primary);
        }

        .user-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--bg-card);
            border-radius: 8px;
            min-width: 180px;
            margin-top: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 100;
        }

        .user-dropdown.show { display: block; }

        .user-dropdown a {
            display: block;
            padding: 12px 16px;
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.3s;
        }

        .user-dropdown a:hover {
            background: rgba(233, 69, 96, 0.1);
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--accent-primary);
            color: white;
        }

        .btn-primary:hover { background: #d63850; }

        .btn-secondary {
            background: var(--success);
            color: #000;
        }

        .btn-danger { background: #ff4444; color: white; }

        .hero {
            position: relative;
            height: 85vh;
            min-height: 600px;
            overflow: hidden;
            margin-bottom: 40px;
        }

        .hero-slide {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.8s ease;
        }

        .hero-slide.active { opacity: 1; }

        .hero-bg {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(0.4);
        }

        .hero-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 80px 60px;
            background: linear-gradient(transparent, rgba(15, 15, 30, 0.98));
        }

        .hero-title {
            font-size: 56px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.8);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 40px 0 25px;
            flex-wrap: wrap;
            gap: 15px;
        }

        .section-title { font-size: 24px; }

        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            overflow-x: auto;
            padding-bottom: 10px;
        }

        .filters::-webkit-scrollbar {
            height: 5px;
        }

        .filters::-webkit-scrollbar-track {
            background: var(--bg-card);
        }

        .filters::-webkit-scrollbar-thumb {
            background: var(--accent-primary);
            border-radius: 5px;
        }

        .filter-btn {
            padding: 8px 20px;
            background: var(--bg-card);
            border: 1px solid transparent;
            border-radius: 20px;
            color: var(--text-secondary);
            font-size: 13px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s;
        }

        .filter-btn:hover, .filter-btn.active {
            background: var(--accent-primary);
            color: white;
        }

        .advanced-filters {
            display: none;
            background: var(--bg-card);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 30px;
            gap: 15px;
            flex-wrap: wrap;
        }

        .advanced-filters.show {
            display: flex;
        }

        .advanced-filters select {
            padding: 8px 15px;
            background: var(--bg-secondary);
            border: 1px solid transparent;
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            direction: rtl;
        }

        .movies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 60px;
        }

        .movie-card {
            background: var(--bg-card);
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s;
            position: relative;
        }

        .movie-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(233, 69, 96, 0.2);
        }

        .movie-poster {
            position: relative;
            width: 100%;
            aspect-ratio: 2/3;
            overflow: hidden;
            background: var(--bg-secondary);
        }

        .movie-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.3s;
        }

        .movie-card:hover .movie-poster img {
            transform: scale(1.1);
        }

        .play-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            background: rgba(233, 69, 96, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.3s;
        }

        .movie-card:hover .play-icon { opacity: 1; }

        .movie-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 10px;
            background: rgba(233, 69, 96, 0.95);
            border-radius: 4px;
            font-size: 11px;
        }

        .movie-info {
            padding: 12px;
        }

        .movie-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .movie-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .pagination {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 10px;
            margin: 40px 0;
            flex-wrap: wrap;
        }

        .pagination button {
            padding: 10px 15px;
            background: var(--bg-card);
            border: none;
            border-radius: 8px;
            color: var(--text-primary);
            cursor: pointer;
            transition: all 0.3s;
            min-width: 40px;
        }

        .pagination button:hover:not(:disabled) {
            background: var(--accent-primary);
        }

        .pagination button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .pagination button.active {
            background: var(--accent-primary);
        }

        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 16px;
            max-width: 900px;
            width: 100%;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            left: 15px;
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.8);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            z-index: 10;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background: var(--accent-primary);
        }

        .modal-header {
            padding: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .modal-title {
            font-size: 24px;
            color: var(--accent-primary);
        }

        .modal-body { padding: 25px; }

        .form-group { margin-bottom: 20px; }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            background: var(--bg-card);
            border: 1px solid transparent;
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
            direction: rtl;
            text-align: right;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .social-login {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .social-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .social-btn.google {
            background: #fff;
            color: #333;
        }

        .social-btn.facebook {
            background: #1877f2;
            color: white;
        }

        .detail-page {
            display: none;
            padding: 40px 0;
        }

        .detail-page.active { display: block; }

        .detail-header {
            position: relative;
            height: 60vh;
            min-height: 500px;
            margin-bottom: 40px;
            border-radius: 16px;
            overflow: hidden;
        }

        .detail-bg {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(0.3);
        }

        .detail-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 40px;
            background: linear-gradient(transparent, var(--bg-primary));
        }

        .detail-title {
            font-size: 42px;
            margin-bottom: 15px;
        }

        .detail-meta {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .video-container {
            position: relative;
            width: 100%;
            padding-top: 56.25%;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .video-player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .server-tabs, .season-tabs {
            display: flex;
            gap: 10px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .server-tab, .season-tab {
            padding: 12px 24px;
            background: var(--bg-card);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            white-space: nowrap;
            font-weight: 600;
            transition: all 0.3s;
        }

        .server-tab:hover, .season-tab:hover {
            background: var(--accent-primary);
        }

        .server-tab.active, .season-tab.active {
            background: var(--accent-primary);
        }

        .episodes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .episode-card {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .episode-card:hover {
            border-color: var(--accent-primary);
            transform: translateY(-4px);
        }

        .episode-card.active {
            border-color: var(--accent-primary);
            background: rgba(233, 69, 96, 0.1);
        }

        .comments-section {
            margin-top: 50px;
            padding: 30px;
            background: var(--bg-card);
            border-radius: 12px;
        }

        .comment-form {
            margin-bottom: 30px;
        }

        .comment-form textarea {
            width: 100%;
            padding: 15px;
            background: var(--bg-secondary);
            border: 1px solid transparent;
            border-radius: 8px;
            color: var(--text-primary);
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
            direction: rtl;
            text-align: right;
        }

        .comment-form textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .comment {
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .comment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--accent-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .comment-author {
            font-weight: 600;
            color: var(--accent-primary);
        }

        .comment-date {
            font-size: 12px;
            color: var(--text-secondary);
            margin-right: auto;
        }

        .comment-text {
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .admin-panel {
            display: none;
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .admin-panel.show { display: block; }

        .admin-section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .list-item {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--bg-card);
            padding: 15px 20px;
            border-radius: 8px;
            border-left: 4px solid var(--accent-primary);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 3000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(400px); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }

        .loading-spinner {
            display: inline-block;
            width: 40px;
            height: 40px;
            border: 4px solid var(--bg-card);
            border-top-color: var(--accent-primary);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        @media (max-width: 768px) {
            .hero { height: 65vh; min-height: 450px; }
            .hero-title { font-size: 36px; }
            .hero-content { padding: 40px 30px; }
            .movies-grid { grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); gap: 15px; }
            
            .mobile-menu-btn {
                display: block;
                order: -1;
            }
            
            .nav-links {
                position: fixed;
                top: 65px;
                right: -100%;
                width: 250px;
                height: calc(100vh - 65px);
                background: var(--bg-secondary);
                flex-direction: column;
                padding: 20px;
                transition: right 0.3s;
                box-shadow: -5px 0 15px rgba(0,0,0,0.3);
                align-items: flex-start;
            }
            
            .nav-links.active {
                right: 0;
            }

            .nav-links a {
                width: 100%;
            }
            
            .nav-search {
                width: 100%;
                max-width: 100%;
                order: -1;
            }

            .detail-title { font-size: 28px; }
            .detail-content { padding: 20px; }
            
            .pagination button {
                padding: 8px 12px;
                font-size: 12px;
            }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <i class="fas fa-film"></i>
                <span>Ú©ÙˆØ±Ø¯ Ú¤ÛŒÚ˜Ù†</span>
            </div>

            <button class="mobile-menu-btn" onclick="toggleMobileMenu()">
                <i class="fas fa-bars"></i>
            </button>
            
            <div class="nav-search">
                <input type="text" placeholder="Ú¯Û•Ú•Ø§Ù†..." id="searchInput" onkeyup="handleSearchInput(event)">
                <button onclick="performSearch()"><i class="fas fa-search"></i></button>
            </div>

            <ul class="nav-links" id="navLinks">
                <li><a href="#" onclick="showSection('home'); return false;" class="active">Ø³Û•Ø±Û•Ú©ÛŒ</a></li>
                <li><a href="#" onclick="setFilter('movies'); return false;">ÙÛŒÙ„Ù…Û•Ú©Ø§Ù†</a></li>
                <li><a href="#" onclick="setFilter('series'); return false;">Ø²Ù†Ø¬ÛŒØ±Û•Ú©Ø§Ù†</a></li>
            </ul>

            <button class="theme-toggle" onclick="toggleTheme()" title="Ú¯Û†Ú•ÛŒÙ†ÛŒ Ú•ÙˆÙˆÚ©Ø§Ø±">
                <i class="fas fa-moon" id="themeIcon"></i>
            </button>

            <div id="authButtons">
                <button class="btn btn-primary" onclick="openAuthModal()">
                    <i class="fas fa-user"></i> Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•
                </button>
            </div>

            <div class="user-menu" id="userMenu" style="display: none;">
                <img src="" alt="User" class="user-avatar" id="userAvatar" onclick="toggleUserDropdown()">
                <div class="user-dropdown" id="userDropdown">
                    <a href="#" onclick="showSection('admin'); return false;" id="adminMenuLink" style="display: none;">
                        <i class="fas fa-cog"></i> Ù¾Ø§Ù†ÛÚµÛŒ Ø¦Û•Ø¯Ù…ÛŒÙ†
                    </a>
                    <a href="#" onclick="logout(); return false;">
                        <i class="fas fa-sign-out-alt"></i> Ú†ÙˆÙˆÙ†Û•Ø¯Û•Ø±Û•ÙˆÛ•
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <div id="homeSection">
        <section class="hero" id="heroSection"></section>

        <div class="container">
            <div class="section-header">
                <h2 class="section-title">Ù¾ÛØ´Ù†ÛŒØ§Ø±Ú©Ø±Ø§Ùˆ</h2>
                <button class="btn btn-secondary" onclick="toggleAdvancedFilters()">
                    <i class="fas fa-filter"></i> ÙÙ„ØªÛ•Ø±ÛŒ Ù¾ÛØ´Ú©Û•ÙˆØªÙˆÙˆ
                </button>
            </div>

            <div class="advanced-filters" id="advancedFilters">
                <select onchange="filterByYear(this.value)" id="yearFilter">
                    <option value="">Ù‡Û•Ù…ÙˆÙˆ Ø³Ø§ÚµÛ•Ú©Ø§Ù†</option>
                    <option value="2024">2024</option>
                    <option value="2023">2023</option>
                    <option value="2022">2022</option>
                    <option value="2021">2021</option>
                    <option value="2020">2020</option>
                </select>
                <select onchange="filterByRating(this.value)" id="ratingFilter">
                    <option value="">Ù‡Û•Ù…ÙˆÙˆ Ú•Û•ÛŒØªÛŒÙ†Ú¯Û•Ú©Ø§Ù†</option>
                    <option value="9">9+ â­</option>
                    <option value="8">8+ â­</option>
                    <option value="7">7+ â­</option>
                    <option value="6">6+ â­</option>
                </select>
                <button class="btn btn-danger" onclick="clearFilters()">
                    <i class="fas fa-times"></i> Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ ÙÙ„ØªÛ•Ø±
                </button>
            </div>

            <div class="filters" id="filterTabs">
                <button class="filter-btn active" onclick="setFilter('all')">Ù‡Û•Ù…ÙˆÙˆ</button>
                <button class="filter-btn" onclick="setFilter('movies')">ÙÛŒÙ„Ù…Û•Ú©Ø§Ù†</button>
                <button class="filter-btn" onclick="setFilter('series')">Ø²Ù†Ø¬ÛŒØ±Û•Ú©Ø§Ù†</button>
                <button class="filter-btn" onclick="setFilter('latest')">Ù†ÙˆÛØªØ±ÛŒÙ†</button>
            </div>

            <div class="movies-grid" id="moviesGrid">
                <div style="padding: 60px; text-align: center; color: var(--text-secondary); grid-column: 1 / -1;">
                    <div class="loading-spinner"></div>
                    <p style="margin-top: 20px;">Ú†Ø§ÙˆÛ•Ú•Û Ø¨Ú©Û•...</p>
                </div>
            </div>

            <div class="pagination" id="pagination"></div>
        </div>
    </div>

    <div id="detailPage" class="detail-page"></div>

    <div class="admin-panel" id="adminPanel">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px; flex-wrap: wrap; gap: 15px;">
                <h2 style="font-size: 28px; margin: 0;">
                    <i class="fas fa-cog"></i> Ù¾Ø§Ù†ÛÚµÛŒ Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†
                </h2>
                <button class="btn btn-secondary" onclick="showSection('home')">
                    <i class="fas fa-home"></i> Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ• Ø¨Û† Ø³Û•Ø±Û•Ú©ÛŒ
                </button>
            </div>

            <div class="admin-section">
                <h3><i class="fas fa-chart-bar"></i> Ø¦Ø§Ù…Ø§Ø±</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700; color: var(--accent-primary);" id="totalContent">0</div>
                        <div style="color: var(--text-secondary); margin-top: 8px;">Ú©Û†ÛŒ Ù†Ø§ÙˆÛ•Ú•Û†Ú©</div>
                    </div>
                    <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700; color: var(--success);" id="totalMovies">0</div>
                        <div style="color: var(--text-secondary); margin-top: 8px;">ÙÛŒÙ„Ù…Û•Ú©Ø§Ù†</div>
                    </div>
                    <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700; color: #2196F3;" id="totalSeries">0</div>
                        <div style="color: var(--text-secondary); margin-top: 8px;">Ø²Ù†Ø¬ÛŒØ±Û•Ú©Ø§Ù†</div>
                    </div>
                    <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700; color: #ff9800;" id="totalComments">0</div>
                        <div style="color: var(--text-secondary); margin-top: 8px;">Ú©Û†Ù…ÛÙ†ØªÛ•Ú©Ø§Ù†</div>
                    </div>
                </div>
            </div>

            <div class="admin-section">
                <h3><i class="fas fa-video"></i> Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Ù†Ø§ÙˆÛ•Ú•Û†Ú©</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; margin: 20px 0;">
                    <button class="btn btn-primary" onclick="openContentModal('movie')">
                        <i class="fas fa-plus"></i> Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ ÙÛŒÙ„Ù…
                    </button>
                    <button class="btn btn-primary" onclick="openContentModal('series')">
                        <i class="fas fa-plus"></i> Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø²Ù†Ø¬ÛŒØ±Û•
                    </button>
                </div>
                <div id="contentManager"></div>
            </div>
        </div>
    </div>

    <div class="modal" id="authModal">
        <div class="modal-content" style="max-width: 420px;">
            <button class="modal-close" onclick="closeModal('authModal')">Ã—</button>
            <div class="modal-header">
                <h2 class="modal-title">Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</h2>
            </div>
            <div class="modal-body">
                <form onsubmit="handleAuth(event, 'login')" id="loginForm">
                    <div class="form-group">
                        <label>Ø¦ÛŒÙ…Û•ÛŒÚµ</label>
                        <input type="email" id="authEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Ù¾Ø§Ø³ÙˆÛ†Ø±Ø¯</label>
                        <input type="password" id="authPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;">
                        Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•
                    </button>
                </form>

                <div style="text-align: center; margin: 20px 0; color: var(--text-secondary);">
                    ÛŒØ§Ù†
                </div>

                <div class="social-login">
                    <button class="social-btn google" onclick="socialLogin('google')">
                        <i class="fab fa-google"></i> Google
                    </button>
                    <button class="social-btn facebook" onclick="socialLogin('facebook')">
                        <i class="fab fa-facebook-f"></i> Facebook
                    </button>
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <a href="#" onclick="toggleAuthMode(); return false;" style="color: var(--accent-primary); text-decoration: none;">
                        Ù‡Û•Ú˜Ù…Ø§Ø±Øª Ù†ÛŒÛŒÛ•ØŸ Ø¯Ø±ÙˆØ³ØªÛŒ Ø¨Ú©Û•
                    </a>
                </div>
            </div>
        </div>
    </div>

    <div class="modal" id="contentModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('contentModal')">Ã—</button>
            <div class="modal-header">
                <h2 class="modal-title" id="contentModalTitle">Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ù†Ø§ÙˆÛ•Ú•Û†Ú©</h2>
            </div>
            <div class="modal-body">
                <form onsubmit="saveContent(event)">
                    <input type="hidden" id="contentType">
                    <input type="hidden" id="contentEditId">
                    
                    <div class="form-group">
                        <label>Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù† *</label>
                        <input type="text" id="contentTitle" required>
                    </div>

                    <div class="form-group">
                        <label>Ù„ÛŒÙ†Ú©ÛŒ Ù¾Û†Ø³ØªÛ•Ø± *</label>
                        <input type="url" id="contentPoster" required>
                    </div>

                    <div class="form-group">
                        <label>Ø³Ø§Úµ</label>
                        <input type="text" id="contentYear" placeholder="2024">
                    </div>

                    <div class="form-group">
                        <label>Ú•Û•ÛŒØªÛŒÙ†Ú¯ (Ù„Û• 10)</label>
                        <input type="number" id="contentRating" min="0" max="10" step="0.1">
                    </div>

                    <div class="form-group">
                        <label>ÙˆÛ•Ø³Ù</label>
                        <textarea id="contentDescription" rows="4"></textarea>
                    </div>

                    <div id="seriesSection" style="display: none;">
                        <h3 style="margin: 20px 0; color: var(--accent-primary);">ÙˆÛ•Ø±Ø²Û•Ú©Ø§Ù†</h3>
                        <div id="seasonsContainer"></div>
                        <button type="button" class="btn btn-secondary" onclick="addSeason()">
                            <i class="fas fa-plus"></i> Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ ÙˆÛ•Ø±Ø²ÛŒ Ù†ÙˆÛ
                        </button>
                    </div>

                    <div id="movieSection" style="display: none;">
                        <h3 style="margin: 20px 0; color: var(--accent-primary);">Ø³ÛØ±Ú¤Û•Ø±Û•Ú©Ø§Ù†</h3>
                        
                        <div class="form-group">
                            <label>ğŸ¥ Ø³ÛØ±Ú¤Û•Ø± 1 (Upstream) *</label>
                            <input type="url" id="movieServer1" required>
                        </div>

                        <div class="form-group">
                            <label>ğŸ¥ Ø³ÛØ±Ú¤Û•Ø± 2 (Filemoon)</label>
                            <input type="url" id="movieServer2">
                        </div>

                        <div class="form-group">
                            <label>ğŸ¥ Ø³ÛØ±Ú¤Û•Ø± 3 (MixDrop)</label>
                            <input type="url" id="movieServer3">
                        </div>

                        <div class="form-group">
                            <label>ğŸ¥ Ø³ÛØ±Ú¤Û•Ø± 4 (VidMoly)</label>
                            <input type="url" id="movieServer4">
                        </div>

                        <h3 style="margin: 20px 0; color: var(--accent-primary);">Ú˜ÛØ±Ù†ÙˆÙˆØ³Û•Ú©Ø§Ù†</h3>
                        
                        <div class="form-group">
                            <label>ğŸ“„ Ú˜ÛØ±Ù†ÙˆÙˆØ³ 1 (SRT)</label>
                            <input type="url" id="movieSubtitle1" placeholder="https://...subtitle.srt">
                        </div>

                        <div class="form-group">
                            <label>ğŸ“„ Ú˜ÛØ±Ù†ÙˆÙˆØ³ 2 (SRT)</label>
                            <input type="url" id="movieSubtitle2" placeholder="https://...subtitle.srt">
                        </div>
                    </div>

                    <div style="margin-top: 30px; display: flex; gap: 10px;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('contentModal')">
                            Ù‡Û•ÚµÙˆÛ•Ø´Ø§Ù†Ø¯Ù†Û•ÙˆÛ•
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-save"></i> Ù¾Ø§Ø´Û•Ú©Û•ÙˆØªÚ©Ø±Ø¯Ù†
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, push, set, onValue, remove, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, GoogleAuthProvider, FacebookAuthProvider, signInWithPopup } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAaE1v9PcHGsSgF1IlnDrygX5TT2-zii8o",
            authDomain: "kurdvision-f9d3e.firebaseapp.com",
            databaseURL: "https://kurdvision-f9d3e-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "kurdvision-f9d3e"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        let allContent = [];
        let filteredContent = [];
        let allSlides = [];
        let currentUser = null;
        let isAdmin = false;
        let currentFilter = 'all';
        let authMode = 'login';
        let currentPage = 1;
        let itemsPerPage = 20;
        let heroInterval = null;
        let advancedFilters = { year: '', rating: '' };

        window.toggleTheme = function() {
            const body = document.body;
            const icon = document.getElementById('themeIcon');
            
            if (body.classList.contains('light-mode')) {
                body.classList.remove('light-mode');
                icon.className = 'fas fa-moon';
                localStorage.setItem('theme', 'dark');
            } else {
                body.classList.add('light-mode');
                icon.className = 'fas fa-sun';
                localStorage.setItem('theme', 'light');
            }
        };

        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'light') {
            document.body.classList.add('light-mode');
            document.getElementById('themeIcon').className = 'fas fa-sun';
        }

        window.toggleMobileMenu = function() {
            const navLinks = document.getElementById('navLinks');
            navLinks.classList.toggle('active');
        };

        document.addEventListener('click', (e) => {
            const navLinks = document.getElementById('navLinks');
            const mobileBtn = document.querySelector('.mobile-menu-btn');
            
            if (navLinks && mobileBtn && !navLinks.contains(e.target) && !mobileBtn.contains(e.target)) {
                navLinks.classList.remove('active');
            }

            const dropdown = document.getElementById('userDropdown');
            const avatar = document.getElementById('userAvatar');
            
            if (dropdown && !dropdown.contains(e.target) && e.target !== avatar) {
                dropdown.classList.remove('show');
            }
        });

        window.handleSearchInput = function(event) {
            if (event.key === 'Enter') {
                performSearch();
            }
        };

        window.toggleAdvancedFilters = function() {
            const filters = document.getElementById('advancedFilters');
            filters.classList.toggle('show');
        };

        window.filterByYear = function(year) {
            advancedFilters.year = year;
            applyFilters();
        };

        window.filterByRating = function(rating) {
            advancedFilters.rating = rating;
            applyFilters();
        };

        window.clearFilters = function() {
            advancedFilters = { year: '', rating: '' };
            document.getElementById('yearFilter').value = '';
            document.getElementById('ratingFilter').value = '';
            currentFilter = 'all';
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelector('.filter-btn').classList.add('active');
            applyFilters();
        };

        function applyFilters() {
            let filtered = [...allContent];

            if (currentFilter === 'movies') {
                filtered = filtered.filter(c => c.type === 'movie');
            } else if (currentFilter === 'series') {
                filtered = filtered.filter(c => c.type === 'series');
            } else if (currentFilter === 'latest') {
                filtered = filtered.sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 50);
            }

            if (advancedFilters.year) {
                filtered = filtered.filter(c => c.year === advancedFilters.year);
            }

            if (advancedFilters.rating) {
                const minRating = parseFloat(advancedFilters.rating);
                filtered = filtered.filter(c => (c.rating || 0) >= minRating);
            }

            filteredContent = filtered;
            currentPage = 1;
            displayContent();
        }

        window.openAuthModal = function() {
            openModal('authModal');
        };

        window.openModal = function(id) {
            const modal = document.getElementById(id);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        };

        window.closeModal = function(id) {
            const modal = document.getElementById(id);
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        };

        window.toggleUserDropdown = function() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        };

        window.showSection = function(section) {
            document.getElementById('navLinks').classList.remove('active');
            
            if (section === 'admin') {
                if (!currentUser) {
                    showToast('âš ï¸ ØªÚ©Ø§ÛŒÛ• ÛŒÛ•Ú©Û•Ù… Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Ú©Û•');
                    openAuthModal();
                    return;
                }
                
                if (!isAdmin) {
                    showToast('âš ï¸ ØªÛ•Ù†Ù‡Ø§ Ø¦Û•Ø¯Ù…ÛŒÙ† Ø¯Û•ØªÙˆØ§Ù†ÛØª Ø¨Ú†ÛØªÛ• Ù¾Ø§Ù†ÛÚµ');
                    return;
                }
                
                document.getElementById('homeSection').style.display = 'none';
                document.getElementById('detailPage').classList.remove('active');
                document.getElementById('adminPanel').classList.add('show');
                
                displayContentManager();
                updateStats();
            } else {
                document.getElementById('homeSection').style.display = 'block';
                document.getElementById('detailPage').classList.remove('active');
                document.getElementById('adminPanel').classList.remove('show');
            }

            document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));
            if (section === 'home') {
                document.querySelector('.nav-links a').classList.add('active');
            }
        };

        window.showToast = function(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        };

        onAuthStateChanged(auth, (user) => {
            currentUser = user;
            updateUIForAuth(user);
            
            if (user) {
                checkAdminStatus(user.uid);
            } else {
                isAdmin = false;
                document.getElementById('adminMenuLink').style.display = 'none';
            }
        });

        function updateUIForAuth(user) {
            if (user) {
                document.getElementById('authButtons').style.display = 'none';
                document.getElementById('userMenu').style.display = 'block';
                
                const avatar = document.getElementById('userAvatar');
                if (user.photoURL) {
                    avatar.src = user.photoURL;
                    avatar.innerHTML = '';
                } else {
                    avatar.src = '';
                    avatar.style.background = 'var(--accent-primary)';
                    avatar.style.display = 'flex';
                    avatar.style.alignItems = 'center';
                    avatar.style.justifyContent = 'center';
                    avatar.style.color = 'white';
                    avatar.style.fontSize = '16px';
                    avatar.innerHTML = user.email[0].toUpperCase();
                }
            } else {
                document.getElementById('authButtons').style.display = 'block';
                document.getElementById('userMenu').style.display = 'none';
                isAdmin = false;
            }
        }

        function checkAdminStatus(uid) {
            onValue(ref(db, `admins/${uid}`), (snapshot) => {
                isAdmin = snapshot.exists();
                
                const adminLink = document.getElementById('adminMenuLink');
                if (adminLink) {
                    adminLink.style.display = isAdmin ? 'block' : 'none';
                }
                
                if (isAdmin) {
                    console.log('Admin user logged in');
                }
            });
        }

        function loadData() {
            onValue(ref(db, 'content'), (snapshot) => {
                allContent = [];
                snapshot.forEach((child) => {
                    allContent.push({ id: child.key, ...child.val() });
                });
                filteredContent = [...allContent];
                displayContent();
                displayContentManager();
                updateStats();
            });

            onValue(ref(db, 'slides'), (snapshot) => {
                allSlides = [];
                snapshot.forEach((child) => {
                    allSlides.push({ id: child.key, ...child.val() });
                });
                loadHero();
            });
        }

        function updateStats() {
            const totalMovies = allContent.filter(c => c.type === 'movie').length;
            const totalSeries = allContent.filter(c => c.type === 'series').length;
            const totalComments = allContent.reduce((sum, c) => sum + (c.commentsCount || 0), 0);

            document.getElementById('totalContent').textContent = allContent.length;
            document.getElementById('totalMovies').textContent = totalMovies;
            document.getElementById('totalSeries').textContent = totalSeries;
            document.getElementById('totalComments').textContent = totalComments;
        }

        function displayContent() {
            const grid = document.getElementById('moviesGrid');
            const startIndex = (currentPage - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const pageItems = filteredContent.slice(startIndex, endIndex);

            if (filteredContent.length === 0) {
                grid.innerHTML = '<div style="padding: 60px; text-align: center; color: var(--text-secondary); grid-column: 1 / -1;"><i class="fas fa-search" style="font-size: 48px; margin-bottom: 20px; opacity: 0.5;"></i><p>Ù‡ÛŒÚ† Ù†Ø§ÙˆÛ•Ú•Û†Ú©ÛÚ© Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•</p></div>';
                document.getElementById('pagination').innerHTML = '';
                return;
            }

            grid.innerHTML = pageItems.map(item => `
                <div class="movie-card" onclick="openDetail('${item.id}')">
                    <div class="movie-poster">
                        <img src="${item.poster}" alt="${item.title}" loading="lazy" onerror="this.src='https://via.placeholder.com/300x450?text=No+Image'">
                        <div class="play-icon"><i class="fas fa-play"></i></div>
                        ${item.rating ? `<div class="movie-badge">â­ ${item.rating}</div>` : ''}
                    </div>
                    <div class="movie-info">
                        <div class="movie-title">${item.title}</div>
                        <div class="movie-meta">
                            <span>${item.year || '2024'}</span>
                            <span>${item.type === 'series' ? 'ğŸ“º' : 'ğŸ¬'}</span>
                        </div>
                    </div>
                </div>
            `).join('');

            displayPagination();
        }

        function displayPagination() {
            const totalPages = Math.ceil(filteredContent.length / itemsPerPage);
            const pagination = document.getElementById('pagination');

            if (totalPages <= 1) {
                pagination.innerHTML = '';
                return;
            }

            let html = `
                <button onclick="changePage(${currentPage - 1})" ${currentPage === 1 ? 'disabled' : ''}>
                    <i class="fas fa-chevron-right"></i>
                </button>
            `;

            const maxButtons = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxButtons / 2));
            let endPage = Math.min(totalPages, startPage + maxButtons - 1);

            if (endPage - startPage < maxButtons - 1) {
                startPage = Math.max(1, endPage - maxButtons + 1);
            }

            if (startPage > 1) {
                html += `<button onclick="changePage(1)">1</button>`;
                if (startPage > 2) {
                    html += `<span style="padding: 10px">...</span>`;
                }
            }

            for (let i = startPage; i <= endPage; i++) {
                html += `<button onclick="changePage(${i})" class="${i === currentPage ? 'active' : ''}">${i}</button>`;
            }

            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    html += `<span style="padding: 10px">...</span>`;
                }
                html += `<button onclick="changePage(${totalPages})">${totalPages}</button>`;
            }

            html += `
                <button onclick="changePage(${currentPage + 1})" ${currentPage === totalPages ? 'disabled' : ''}>
                    <i class="fas fa-chevron-left"></i>
                </button>
            `;

            pagination.innerHTML = html;
        }

        window.changePage = function(page) {
            currentPage = page;
            displayContent();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        function loadHero() {
            const hero = document.getElementById('heroSection');
            if (allSlides.length === 0) {
                hero.style.display = 'none';
                return;
            }

            hero.style.display = 'block';
            let currentSlide = 0;
            
            hero.innerHTML = allSlides.slice(0, 5).map((slide, index) => `
                <div class="hero-slide ${index === 0 ? 'active' : ''}">
                    <img src="${slide.image}" class="hero-bg" loading="lazy">
                    <div class="hero-content">
                        <h1 class="hero-title">${slide.title}</h1>
                        ${slide.description ? `<p style="margin-bottom: 20px; max-width: 600px;">${slide.description}</p>` : ''}
                        ${slide.contentId ? `<button class="btn btn-primary" onclick="openDetail('${slide.contentId}')"><i class="fas fa-play"></i> Ø¨ÛŒÙ†ÛŒÙ†</button>` : ''}
                    </div>
                </div>
            `).join('');

            if (heroInterval) {
                clearInterval(heroInterval);
            }

            function changeSlide() {
                const slides = document.querySelectorAll('.hero-slide');
                if (slides.length === 0) return;
                
                slides[currentSlide].classList.remove('active');
                currentSlide = (currentSlide + 1) % slides.length;
                slides[currentSlide].classList.add('active');
            }

            heroInterval = setInterval(changeSlide, 5000);

            document.addEventListener('visibilitychange', () => {
                if (document.hidden) {
                    if (heroInterval) clearInterval(heroInterval);
                } else {
                    heroInterval = setInterval(changeSlide, 5000);
                }
            });
        }

        window.openDetail = (id) => {
            const item = allContent.find(c => c.id === id);
            if (!item) return;

            update(ref(db, `content/${id}`), { views: (item.views || 0) + 1 });

            const detailPage = document.getElementById('detailPage');
            document.getElementById('homeSection').style.display = 'none';
            document.getElementById('adminPanel').classList.remove('show');
            detailPage.classList.add('active');

            let episodesHTML = '';
            let firstServer = '';
            
            if (item.type === 'series' && item.seasons) {
                firstServer = item.seasons[0]?.episodes[0]?.servers?.server1 || '';
                
                episodesHTML = `
                    <div class="season-tabs">
                        ${item.seasons.map((season, idx) => `
                            <button class="season-tab ${idx === 0 ? 'active' : ''}" onclick="switchSeason(${idx}, this)">
                                <i class="fas fa-layer-group"></i> ${season.seasonTitle}
                                <span style="opacity: 0.8; font-size: 13px; margin-right: 5px;">(${season.episodes.length})</span>
                            </button>
                        `).join('')}
                    </div>
                    
                    ${item.seasons.map((season, seasonIdx) => `
                        <div class="season-episodes" data-season="${seasonIdx}" style="display: ${seasonIdx === 0 ? 'grid' : 'none'}; grid-template-columns: repeat(auto-fill, minmax(200px, 1fr)); gap: 15px; margin: 20px 0;">
                            ${season.episodes.map((ep, epIdx) => `
                                <div class="episode-card ${seasonIdx === 0 && epIdx === 0 ? 'active' : ''}" 
                                     onclick='switchEpisode(${JSON.stringify(ep.servers)}, ${JSON.stringify(ep.subtitles || {})}, this)'>
                                    <h4>Ø¦Û•ÚµÙ‚Û•ÛŒ ${ep.number}</h4>
                                    <p style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">${ep.title || ''}</p>
                                </div>
                            `).join('')}
                        </div>
                    `).join('')}
                `;
            } else if (item.type === 'series' && item.episodes) {
                firstServer = item.episodes[0]?.servers?.server1 || '';
                episodesHTML = `
                    <div class="episodes-grid">
                        ${item.episodes.map((ep, i) => `
                            <div class="episode-card ${i === 0 ? 'active' : ''}" onclick='switchEpisode(${JSON.stringify(ep.servers)}, ${JSON.stringify(ep.subtitles || {})}, this)'>
                                <h4>Ø¦Û•ÚµÙ‚Û•ÛŒ ${ep.number}</h4>
                                <p style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">${ep.title || ''}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
            } else {
                firstServer = item.servers?.server1 || '';
            }

            const servers = item.type === 'movie' ? item.servers : 
                           (item.seasons?.[0]?.episodes[0]?.servers || item.episodes?.[0]?.servers || {});
            const subtitles = item.type === 'movie' ? item.subtitles : 
                             (item.seasons?.[0]?.episodes[0]?.subtitles || item.episodes?.[0]?.subtitles || {});
            
            let serverTabsHTML = '';
            if (servers) {
                const serverList = [];
                if (servers.server1) serverList.push({ name: 'Ø³ÛØ±Ú¤Û•Ø± 1', url: servers.server1 });
                if (servers.server2) serverList.push({ name: 'Ø³ÛØ±Ú¤Û•Ø± 2', url: servers.server2 });
                if (servers.server3) serverList.push({ name: 'Ø³ÛØ±Ú¤Û•Ø± 3', url: servers.server3 });
                if (servers.server4) serverList.push({ name: 'Ø³ÛØ±Ú¤Û•Ø± 4', url: servers.server4 });
                
                if (serverList.length > 1) {
                    serverTabsHTML = `
                        <div class="server-tabs">
                            ${serverList.map((s, i) => `
                                <button class="server-tab ${i === 0 ? 'active' : ''}" onclick="switchServer('${s.url}', this)">
                                    ${s.name}
                                </button>
                            `).join('')}
                        </div>
                    `;
                }
            }

            let subtitlesHTML = '';
            if (subtitles && (subtitles.sub1 || subtitles.sub2)) {
                subtitlesHTML = `
                    <div style="margin: 20px 0; padding: 15px; background: var(--bg-card); border-radius: 8px;">
                        <h4 style="margin-bottom: 10px; color: var(--accent-primary);">ğŸ“„ Ú˜ÛØ±Ù†ÙˆÙˆØ³Û•Ú©Ø§Ù†:</h4>
                        <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                            ${subtitles.sub1 ? `<a href="${subtitles.sub1}" download class="btn btn-secondary">â¬‡ï¸ Ú˜ÛØ±Ù†ÙˆÙˆØ³ 1</a>` : ''}
                            ${subtitles.sub2 ? `<a href="${subtitles.sub2}" download class="btn btn-secondary">â¬‡ï¸ Ú˜ÛØ±Ù†ÙˆÙˆØ³ 2</a>` : ''}
                        </div>
                    </div>
                `;
            }

            detailPage.innerHTML = `
                <div class="container">
                    <button class="btn btn-secondary" onclick="closeDetail()" style="margin-bottom: 20px;">
                        <i class="fas fa-arrow-right"></i> Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ•
                    </button>

                    <div class="detail-header">
                        <img src="${item.poster}" class="detail-bg">
                        <div class="detail-content">
                            <h1 class="detail-title">${item.title}</h1>
                            <div class="detail-meta">
                                <span>ğŸ“… ${item.year || '2024'}</span>
                                ${item.rating ? `<span>â­ ${item.rating}/10</span>` : ''}
                                <span>ğŸ‘ï¸ ${(item.views || 0).toLocaleString()}</span>
                                <span>${item.type === 'series' ? 'ğŸ“º Ø²Ù†Ø¬ÛŒØ±Û•' : 'ğŸ¬ ÙÛŒÙ„Ù…'}</span>
                            </div>
                            ${item.description ? `<p style="max-width: 700px; margin-top: 15px; line-height: 1.8;">${item.description}</p>` : ''}
                        </div>
                    </div>

                    ${firstServer ? `
                        <div class="video-container">
                            <iframe id="videoPlayer" class="video-player" src="${firstServer}" allowfullscreen allow="autoplay"></iframe>
                        </div>
                    ` : ''}

                    ${serverTabsHTML}
                    ${subtitlesHTML}
                    ${episodesHTML}

                    <div class="comments-section">
                        <h3 style="margin-bottom: 20px; font-size: 22px;">ğŸ’¬ Ù„ÛØ¯ÙˆØ§Ù†Û•Ú©Ø§Ù† (${item.commentsCount || 0})</h3>
                        
                        ${currentUser ? `
                            <div class="comment-form">
                                <textarea id="commentText" placeholder="Ù„ÛØ¯ÙˆØ§Ù†Û•Ú©Û•Øª Ø¨Ù†ÙˆÙˆØ³Û•..."></textarea>
                                <button class="btn btn-primary" onclick="postComment('${id}')" style="margin-top: 10px;">
                                    <i class="fas fa-paper-plane"></i> Ù†Ø§Ø±Ø¯Ù†
                                </button>
                            </div>
                        ` : `
                            <div style="text-align: center; padding: 20px; background: var(--bg-secondary); border-radius: 8px;">
                                <p style="margin-bottom: 15px;">ØªÚ©Ø§ÛŒÛ• Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Ú©Û• Ø¨Û† Ù†ÙˆÙˆØ³ÛŒÙ†ÛŒ Ù„ÛØ¯ÙˆØ§Ù†</p>
                                <button class="btn btn-primary" onclick="openAuthModal()">
                                    Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•
                                </button>
                            </div>
                        `}

                        <div id="commentsList" style="margin-top: 30px;"></div>
                    </div>
                </div>
            `;

            loadComments(id);
            window.scrollTo({ top: 0, behavior: 'smooth' });
        };

        window.closeDetail = () => {
            document.getElementById('detailPage').classList.remove('active');
            document.getElementById('homeSection').style.display = 'block';
        };

        window.switchSeason = (seasonIndex, btn) => {
            document.querySelectorAll('.season-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            btn.classList.add('active');
            
            document.querySelectorAll('.season-episodes').forEach(seasonDiv => {
                seasonDiv.style.display = 'none';
            });
            const targetSeason = document.querySelector(`.season-episodes[data-season="${seasonIndex}"]`);
            if (targetSeason) {
                targetSeason.style.display = 'grid';
                
                const firstEpisode = targetSeason.querySelector('.episode-card');
                if (firstEpisode) {
                    firstEpisode.click();
                }
            }
        };

        window.switchEpisode = (servers, subtitles, card) => {
            document.querySelectorAll('.episode-card').forEach(c => c.classList.remove('active'));
            card.classList.add('active');
            
            const player = document.getElementById('videoPlayer');
            if (player && servers.server1) {
                player.src = servers.server1;
            }
            
            const serverList = [];
            if (servers.server1) serverList.push({ name: 'Ø³ÛØ±Ú¤Û•Ø± 1', url: servers.server1 });
            if (servers.server2) serverList.push({ name: 'Ø³ÛØ±Ú¤Û•Ø± 2', url: servers.server2 });
            if (servers.server3) serverList.push({ name: 'Ø³ÛØ±Ú¤Û•Ø± 3', url: servers.server3 });
            if (servers.server4) serverList.push({ name: 'Ø³ÛØ±Ú¤Û•Ø± 4', url: servers.server4 });
            
            const serverTabsContainer = document.querySelector('.server-tabs');
            if (serverTabsContainer && serverList.length > 1) {
                serverTabsContainer.innerHTML = serverList.map((s, i) => `
                    <button class="server-tab ${i === 0 ? 'active' : ''}" onclick="switchServer('${s.url}', this)">
                        ${s.name}
                    </button>
                `).join('');
            }
        };

        window.switchServer = (url, btn) => {
            document.querySelectorAll('.server-tab').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            const player = document.getElementById('videoPlayer');
            if (player) {
                player.src = url;
            }
        };

        function loadComments(contentId) {
            onValue(ref(db, `comments/${contentId}`), (snapshot) => {
                const comments = [];
                snapshot.forEach((child) => {
                    comments.push({ id: child.key, ...child.val() });
                });
                
                comments.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                const list = document.getElementById('commentsList');
                if (!list) return;
                
                if (comments.length === 0) {
                    list.innerHTML = '<p style="text-align: center; color: var(--text-secondary); padding: 20px;">Ù‡ÛŒÚ† Ù„ÛØ¯ÙˆØ§Ù†ÛÚ© Ù†ÛŒÛŒÛ•</p>';
                    return;
                }

                list.innerHTML = comments.map(comment => `
                    <div class="comment">
                        <div class="comment-header">
                            <div class="comment-avatar">${comment.userName[0].toUpperCase()}</div>
                            <div>
                                <div class="comment-author">${comment.userName}</div>
                                <div class="comment-date">${formatDate(comment.date)}</div>
                            </div>
                            ${(currentUser && currentUser.uid === comment.userId) || isAdmin ? `
                                <button class="btn btn-danger" onclick="deleteComment('${contentId}', '${comment.id}')" style="margin-right: auto; padding: 6px 12px;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </div>
                        <div class="comment-text">${comment.text}</div>
                    </div>
                `).join('');
            });
        }

        window.postComment = async (contentId) => {
            if (!currentUser) {
                showToast('âš ï¸ ØªÚ©Ø§ÛŒÛ• Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Ú©Û•');
                return;
            }

            const textArea = document.getElementById('commentText');
            const text = textArea.value.trim();
            if (!text) {
                showToast('âš ï¸ Ù„ÛØ¯ÙˆØ§Ù†Û•Ú©Û•Øª Ø¨Ù†ÙˆÙˆØ³Û•');
                return;
            }

            try {
                await push(ref(db, `comments/${contentId}`), {
                    text: text,
                    userId: currentUser.uid,
                    userName: currentUser.displayName || currentUser.email.split('@')[0],
                    date: new Date().toISOString()
                });

                const item = allContent.find(c => c.id === contentId);
                await update(ref(db, `content/${contentId}`), {
                    commentsCount: (item.commentsCount || 0) + 1
                });

                textArea.value = '';
                showToast('âœ… Ù„ÛØ¯ÙˆØ§Ù†Û•Ú©Û•Øª Ù†ÛØ±Ø¯Ø±Ø§');
            } catch (error) {
                showToast('âŒ Ù‡Û•ÚµÛ• Ú•ÙˆÙˆÛŒØ¯Ø§');
            }
        };

        window.deleteComment = async (contentId, commentId) => {
            if (!confirm('Ø¯ÚµÙ†ÛŒØ§ÛŒØª Ù„Û• Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ØŸ')) return;
            
            try {
                await remove(ref(db, `comments/${contentId}/${commentId}`));
                
                const item = allContent.find(c => c.id === contentId);
                await update(ref(db, `content/${contentId}`), {
                    commentsCount: Math.max(0, (item.commentsCount || 0) - 1)
                });
                
                showToast('âœ… Ø³Ú•Ø§ÛŒÛ•ÙˆÛ•');
            } catch (error) {
                showToast('âŒ Ù‡Û•ÚµÛ•');
            }
        };

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const now = new Date();
            const diff = Math.floor((now - date) / 1000);

            if (diff < 60) return 'Ø¦ÛØ³ØªØ§';
            if (diff < 3600) return Math.floor(diff / 60) + ' Ø®ÙˆÙ„Û•Ú© Ù¾ÛØ´ Ø¦ÛØ³ØªØ§';
            if (diff < 86400) return Math.floor(diff / 3600) + ' Ú©Ø§ØªÚ˜Ù…ÛØ± Ù¾ÛØ´ Ø¦ÛØ³ØªØ§';
            return Math.floor(diff / 86400) + ' Ú•Û†Ú˜ Ù¾ÛØ´ Ø¦ÛØ³ØªØ§';
        }

        window.handleAuth = async (e, mode) => {
            e.preventDefault();
            
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;

            try {
                if (mode === 'login') {
                    await signInWithEmailAndPassword(auth, email, password);
                    showToast('âœ… Ø¨Û•Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ú†ÙˆÙˆÛŒØªÛ•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•');
                } else {
                    await createUserWithEmailAndPassword(auth, email, password);
                    showToast('âœ… Ù‡Û•Ú˜Ù…Ø§Ø± Ø¯Ø±ÙˆØ³Øª Ú©Ø±Ø§');
                }
                closeModal('authModal');
            } catch (error) {
                let errorMsg = 'âŒ Ù‡Û•ÚµÛ• Ú•ÙˆÙˆÛŒØ¯Ø§';
                if (error.code === 'auth/email-already-in-use') {
                    errorMsg = 'âŒ Ø¦Û•Ù… Ø¦ÛŒÙ…Û•ÛŒÚµÛ• Ù¾ÛØ´ØªØ± Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Ø±Ø§ÙˆÛ•';
                } else if (error.code === 'auth/wrong-password' || error.code === 'auth/user-not-found') {
                    errorMsg = 'âŒ Ø¦ÛŒÙ…Û•ÛŒÚµ ÛŒØ§Ù† Ù¾Ø§Ø³ÙˆÛ†Ø±Ø¯ Ù‡Û•ÚµÛ•ÛŒÛ•';
                } else if (error.code === 'auth/weak-password') {
                    errorMsg = 'âŒ Ù¾Ø§Ø³ÙˆÛ†Ø±Ø¯ Ù„Ø§ÛŒÛ•Ù†ÛŒ Ú©Û•Ù… 6 Ù¾ÛŒØª Ø¨ÛØª';
                } else if (error.code === 'auth/invalid-email') {
                    errorMsg = 'âŒ Ø¦ÛŒÙ…Û•ÛŒÚµ Ø¯Ø±ÙˆØ³Øª Ù†ÛŒÛŒÛ•';
                }
                showToast(errorMsg);
            }
        };

        window.socialLogin = async (provider) => {
            try {
                let authProvider;
                if (provider === 'google') {
                    authProvider = new GoogleAuthProvider();
                } else if (provider === 'facebook') {
                    authProvider = new FacebookAuthProvider();
                }

                await signInWithPopup(auth, authProvider);
                closeModal('authModal');
                showToast('âœ… Ø¨Û•Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ú†ÙˆÙˆÛŒØªÛ•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•');
            } catch (error) {
                showToast('âŒ Ù‡Û•ÚµÛ• Ú•ÙˆÙˆÛŒØ¯Ø§');
            }
        };

        window.logout = async () => {
            await signOut(auth);
            showToast('âœ… Ú†ÙˆÙˆÛŒØªÛ• Ø¯Û•Ø±Û•ÙˆÛ•');
            isAdmin = false;
            showSection('home');
        };

        window.toggleAuthMode = () => {
            authMode = authMode === 'login' ? 'signup' : 'login';
            const form = document.getElementById('loginForm');
            const title = document.querySelector('#authModal .modal-title');
            const btn = form.querySelector('button[type="submit"]');
            const link = document.querySelector('#authModal a');
            
            if (authMode === 'signup') {
                title.textContent = 'Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ø¯Ù†ÛŒ Ù‡Û•Ú˜Ù…Ø§Ø±';
                btn.innerHTML = '<i class="fas fa-user-plus"></i> Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ø¯Ù†';
                link.textContent = 'Ù‡Û•Ú˜Ù…Ø§Ø±Øª Ù‡Û•ÛŒÛ•ØŸ Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•';
                form.onsubmit = (e) => handleAuth(e, 'signup');
            } else {
                title.textContent = 'Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•';
                btn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•';
                link.textContent = 'Ù‡Û•Ú˜Ù…Ø§Ø±Øª Ù†ÛŒÛŒÛ•ØŸ Ø¯Ø±ÙˆØ³ØªÛŒ Ø¨Ú©Û•';
                form.onsubmit = (e) => handleAuth(e, 'login');
            }
        };

        window.openContentModal = (type) => {
            if (!currentUser) {
                showToast('âš ï¸ ØªÚ©Ø§ÛŒÛ• ÛŒÛ•Ú©Û•Ù… Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Ú©Û•');
                openAuthModal();
                return;
            }
            
            if (!isAdmin) {
                showToast('âš ï¸ ØªÛ•Ù†Ù‡Ø§ Ø¦Û•Ø¯Ù…ÛŒÙ† Ø¯Û•ØªÙˆØ§Ù†ÛØª Ù†Ø§ÙˆÛ•Ú•Û†Ú© Ø²ÛŒØ§Ø¯ Ø¨Ú©Ø§Øª');
                return;
            }
            
            document.getElementById('contentType').value = type;
            document.getElementById('contentEditId').value = '';
            document.getElementById('contentModalTitle').textContent = type === 'movie' ? 'Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ ÙÛŒÙ„Ù…' : 'Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø²Ù†Ø¬ÛŒØ±Û•';
            
            document.getElementById('movieSection').style.display = type === 'movie' ? 'block' : 'none';
            document.getElementById('seriesSection').style.display = type === 'series' ? 'block' : 'none';
            
            document.getElementById('contentModal').querySelectorAll('input, textarea').forEach(el => {
                if (el.type !== 'hidden') el.value = '';
            });
            
            document.getElementById('seasonsContainer').innerHTML = '';
            
            if (type === 'series') {
                addSeason();
            }
            
            openModal('contentModal');
        };

        window.addSeason = () => {
            const container = document.getElementById('seasonsContainer');
            const seasonNum = container.children.length + 1;
            
            const seasonDiv = document.createElement('div');
            seasonDiv.style.cssText = 'background: var(--bg-card); padding: 20px; border-radius: 12px; margin-bottom: 20px; border: 2px solid var(--accent-primary);';
            seasonDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px;">
                    <h4 style="color: var(--accent-primary); font-size: 18px;">
                        <i class="fas fa-layer-group"></i> ÙˆÛ•Ø±Ø²ÛŒ ${seasonNum}
                    </h4>
                    <button type="button" class="btn btn-danger" onclick="this.parentElement.parentElement.remove()">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <div class="form-group">
                    <label>Ú˜Ù…Ø§Ø±Û•ÛŒ ÙˆÛ•Ø±Ø² *</label>
                    <input type="number" class="season-number" value="${seasonNum}" required style="max-width: 150px;">
                </div>
                <div class="form-group">
                    <label>Ù†Ø§ÙˆÛŒ ÙˆÛ•Ø±Ø²</label>
                    <input type="text" class="season-title" placeholder="ÙˆÛ•Ø±Ø²ÛŒ ${seasonNum}">
                </div>
                <h5 style="margin: 15px 0; color: var(--text-secondary);">Ø¦Û•ÚµÙ‚Û•Ú©Ø§Ù†:</h5>
                <div class="episodes-container-season"></div>
                <button type="button" class="btn btn-secondary" onclick="addEpisodeToSeason(this)" style="margin-top: 10px;">
                    <i class="fas fa-plus"></i> Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø¦Û•ÚµÙ‚Û•
                </button>
            `;
            container.appendChild(seasonDiv);
            
            const addBtn = seasonDiv.querySelector('.btn-secondary');
            addEpisodeToSeason(addBtn);
        };

        window.addEpisodeToSeason = (button) => {
            const seasonDiv = button.closest('[style*="border: 2px solid"]');
            const episodesContainer = seasonDiv.querySelector('.episodes-container-season');
            const episodeNum = episodesContainer.children.length + 1;
            
            const episodeDiv = document.createElement('div');
            episodeDiv.style.cssText = 'background: var(--bg-secondary); padding: 15px; border-radius: 8px; margin-bottom: 10px; border-left: 3px solid var(--accent-primary);';
            episodeDiv.innerHTML = `
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h5 style="color: var(--text-primary); margin: 0;">Ø¦Û•ÚµÙ‚Û•ÛŒ ${episodeNum}</h5>
                    <button type="button" class="btn btn-danger" onclick="this.parentElement.parentElement.remove()" style="padding: 5px 10px; font-size: 12px;">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
                <div class="form-group">
                    <label>Ú˜Ù…Ø§Ø±Û•ÛŒ Ø¦Û•ÚµÙ‚Û• *</label>
                    <input type="number" class="ep-number" value="${episodeNum}" required style="max-width: 120px;">
                </div>
                <div class="form-group">
                    <label>Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù†ÛŒ Ø¦Û•ÚµÙ‚Û•</label>
                    <input type="text" class="ep-title">
                </div>
                <div class="form-group">
                    <label>ğŸ¥ Ø³ÛØ±Ú¤Û•Ø± 1 *</label>
                    <input type="url" class="ep-server1" required>
                </div>
                <div class="form-group">
                    <label>ğŸ¥ Ø³ÛØ±Ú¤Û•Ø± 2</label>
                    <input type="url" class="ep-server2">
                </div>
                <div class="form-group">
                    <label>ğŸ¥ Ø³ÛØ±Ú¤Û•Ø± 3</label>
                    <input type="url" class="ep-server3">
                </div>
                <div class="form-group">
                    <label>ğŸ¥ Ø³ÛØ±Ú¤Û•Ø± 4</label>
                    <input type="url" class="ep-server4">
                </div>
                <div class="form-group">
                    <label>ğŸ“„ Ú˜ÛØ±Ù†ÙˆÙˆØ³ 1</label>
                    <input type="url" class="ep-subtitle1">
                </div>
                <div class="form-group">
                    <label>ğŸ“„ Ú˜ÛØ±Ù†ÙˆÙˆØ³ 2</label>
                    <input type="url" class="ep-subtitle2">
                </div>
            `;
            episodesContainer.appendChild(episodeDiv);
        };

        window.saveContent = async (e) => {
            e.preventDefault();
            
            if (!isAdmin) {
                showToast('âš ï¸ ØªÛ•Ù†Ù‡Ø§ Ø¦Û•Ø¯Ù…ÛŒÙ† Ø¯Û•ØªÙˆØ§Ù†ÛØª');
                return;
            }
            
            const type = document.getElementById('contentType').value;
            const id = document.getElementById('contentEditId').value;

            const data = {
                type: type,
                title: document.getElementById('contentTitle').value.trim(),
                poster: document.getElementById('contentPoster').value.trim(),
                year: document.getElementById('contentYear').value.trim() || '2024',
                rating: parseFloat(document.getElementById('contentRating').value) || 0,
                description: document.getElementById('contentDescription').value.trim(),
                date: new Date().toISOString(),
                views: 0,
                commentsCount: 0
            };

            if (type === 'movie') {
                const servers = {};
                const server1 = document.getElementById('movieServer1').value.trim();
                if (!server1) {
                    showToast('âš ï¸ Ù„Ø§ÛŒÛ•Ù†ÛŒ Ú©Û•Ù… Ø³ÛØ±Ú¤Û•Ø± 1 Ù¾Ú• Ø¨Ú©Û•Ø±Û•ÙˆÛ•');
                    return;
                }
                servers.server1 = server1;
                if (document.getElementById('movieServer2').value.trim()) servers.server2 = document.getElementById('movieServer2').value.trim();
                if (document.getElementById('movieServer3').value.trim()) servers.server3 = document.getElementById('movieServer3').value.trim();
                if (document.getElementById('movieServer4').value.trim()) servers.server4 = document.getElementById('movieServer4').value.trim();
                
                data.servers = servers;
                
                const subtitles = {};
                if (document.getElementById('movieSubtitle1').value.trim()) subtitles.sub1 = document.getElementById('movieSubtitle1').value.trim();
                if (document.getElementById('movieSubtitle2').value.trim()) subtitles.sub2 = document.getElementById('movieSubtitle2').value.trim();
                if (Object.keys(subtitles).length > 0) data.subtitles = subtitles;
            } else {
                const seasons = [];
                document.querySelectorAll('#seasonsContainer > div').forEach(seasonDiv => {
                    const seasonNumber = parseInt(seasonDiv.querySelector('.season-number').value);
                    const seasonTitle = seasonDiv.querySelector('.season-title').value.trim() || `ÙˆÛ•Ø±Ø²ÛŒ ${seasonNumber}`;
                    
                    const episodes = [];
                    seasonDiv.querySelectorAll('.episodes-container-season > div').forEach(ep => {
                        const server1 = ep.querySelector('.ep-server1').value.trim();
                        if (server1) {
                            const epData = {
                                number: parseInt(ep.querySelector('.ep-number').value),
                                title: ep.querySelector('.ep-title').value.trim(),
                                servers: { server1: server1 }
                            };
                            
                            if (ep.querySelector('.ep-server2')?.value.trim()) epData.servers.server2 = ep.querySelector('.ep-server2').value.trim();
                            if (ep.querySelector('.ep-server3')?.value.trim()) epData.servers.server3 = ep.querySelector('.ep-server3').value.trim();
                            if (ep.querySelector('.ep-server4')?.value.trim()) epData.servers.server4 = ep.querySelector('.ep-server4').value.trim();
                            
                            const subs = {};
                            if (ep.querySelector('.ep-subtitle1')?.value.trim()) subs.sub1 = ep.querySelector('.ep-subtitle1').value.trim();
                            if (ep.querySelector('.ep-subtitle2')?.value.trim()) subs.sub2 = ep.querySelector('.ep-subtitle2').value.trim();
                            if (Object.keys(subs).length > 0) epData.subtitles = subs;
                            
                            episodes.push(epData);
                        }
                    });
                    
                    if (episodes.length > 0) {
                        seasons.push({
                            seasonNumber: seasonNumber,
                            seasonTitle: seasonTitle,
                            episodes: episodes.sort((a, b) => a.number - b.number)
                        });
                    }
                });
                
                if (seasons.length === 0) {
                    showToast('âš ï¸ Ù„Ø§ÛŒÛ•Ù†ÛŒ Ú©Û•Ù… ÛŒÛ•Ú© ÙˆÛ•Ø±Ø² Ùˆ Ø¦Û•ÚµÙ‚Û• Ø²ÛŒØ§Ø¯ Ø¨Ú©Û•');
                    return;
                }
                
                data.seasons = seasons.sort((a, b) => a.seasonNumber - b.seasonNumber);
                data.totalEpisodes = seasons.reduce((sum, s) => sum + s.episodes.length, 0);
            }

            try {
                if (id) {
                    const existing = allContent.find(c => c.id === id);
                    data.views = existing?.views || 0;
                    data.commentsCount = existing?.commentsCount || 0;
                    await update(ref(db, `content/${id}`), data);
                    showToast('âœ… Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ Ú©Ø±Ø§');
                } else {
                    await push(ref(db, 'content'), data);
                    showToast('âœ… Ø²ÛŒØ§Ø¯ Ú©Ø±Ø§');
                }
                closeModal('contentModal');
            } catch (error) {
                showToast('âŒ Ù‡Û•ÚµÛ•: ' + error.message);
            }
        };

        function displayContentManager() {
            const manager = document.getElementById('contentManager');
            if (allContent.length === 0) {
                manager.innerHTML = '<p style="padding: 20px; text-align: center; color: var(--text-secondary);">Ù‡ÛŒÚ† Ù†Ø§ÙˆÛ•Ú•Û†Ú©ÛÚ© Ù†ÛŒÛŒÛ•</p>';
                return;
            }

            manager.innerHTML = allContent.map(item => `
                <div class="list-item">
                    <div style="flex: 1;">
                        <div style="font-weight: 600; margin-bottom: 5px;">${item.title}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">
                            <span style="background: var(--bg-primary); padding: 3px 8px; border-radius: 4px; margin-left: 8px;">
                                ${item.type === 'series' ? 'ğŸ“º' : 'ğŸ¬'}
                            </span>
                            ${item.year || ''}
                            ${item.type === 'series' && item.seasons ? ` â€¢ ${item.seasons.length} ÙˆÛ•Ø±Ø² â€¢ ${item.totalEpisodes || 0} Ø¦Û•ÚµÙ‚Û•` : ''}
                            â€¢ ğŸ‘ï¸ ${item.views || 0}
                            â€¢ ğŸ’¬ ${item.commentsCount || 0}
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <button class="btn" style="background: #2196F3; color: white;" onclick="editContent('${item.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-danger" onclick="deleteContent('${item.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        window.editContent = (id) => {
            if (!currentUser) {
                showToast('âš ï¸ ØªÚ©Ø§ÛŒÛ• ÛŒÛ•Ú©Û•Ù… Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Ú©Û•');
                openAuthModal();
                return;
            }
            
            if (!isAdmin) {
                showToast('âš ï¸ ØªÛ•Ù†Ù‡Ø§ Ø¦Û•Ø¯Ù…ÛŒÙ† Ø¯Û•ØªÙˆØ§Ù†ÛØª Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ Ø¨Ú©Ø§Øª');
                return;
            }
            
            const item = allContent.find(c => c.id === id);
            if (!item) return;
            
            document.getElementById('contentType').value = item.type;
            document.getElementById('contentEditId').value = id;
            document.getElementById('contentModalTitle').textContent = item.type === 'movie' ? 'Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ ÙÛŒÙ„Ù…' : 'Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ Ø²Ù†Ø¬ÛŒØ±Û•';
            document.getElementById('contentTitle').value = item.title;
            document.getElementById('contentPoster').value = item.poster;
            document.getElementById('contentYear').value = item.year || '';
            document.getElementById('contentRating').value = item.rating || '';
            document.getElementById('contentDescription').value = item.description || '';
            
            document.getElementById('movieSection').style.display = item.type === 'movie' ? 'block' : 'none';
            document.getElementById('seriesSection').style.display = item.type === 'series' ? 'block' : 'none';
            
            if (item.type === 'movie') {
                document.getElementById('movieServer1').value = item.servers?.server1 || '';
                document.getElementById('movieServer2').value = item.servers?.server2 || '';
                document.getElementById('movieServer3').value = item.servers?.server3 || '';
                document.getElementById('movieServer4').value = item.servers?.server4 || '';
                document.getElementById('movieSubtitle1').value = item.subtitles?.sub1 || '';
                document.getElementById('movieSubtitle2').value = item.subtitles?.sub2 || '';
            } else if (item.seasons) {
                const container = document.getElementById('seasonsContainer');
                container.innerHTML = '';
                
                item.seasons.forEach(season => {
                    addSeason();
                    const seasonDiv = container.lastElementChild;
                    seasonDiv.querySelector('.season-number').value = season.seasonNumber;
                    seasonDiv.querySelector('.season-title').value = season.seasonTitle;
                    
                    const episodesContainer = seasonDiv.querySelector('.episodes-container-season');
                    episodesContainer.innerHTML = '';
                    
                    season.episodes.forEach(ep => {
                        addEpisodeToSeason(seasonDiv.querySelector('.btn-secondary'));
                        const epDiv = episodesContainer.lastElementChild;
                        epDiv.querySelector('.ep-number').value = ep.number;
                        epDiv.querySelector('.ep-title').value = ep.title || '';
                        epDiv.querySelector('.ep-server1').value = ep.servers?.server1 || '';
                        epDiv.querySelector('.ep-server2').value = ep.servers?.server2 || '';
                        epDiv.querySelector('.ep-server3').value = ep.servers?.server3 || '';
                        epDiv.querySelector('.ep-server4').value = ep.servers?.server4 || '';
                        epDiv.querySelector('.ep-subtitle1').value = ep.subtitles?.sub1 || '';
                        epDiv.querySelector('.ep-subtitle2').value = ep.subtitles?.sub2 || '';
                    });
                });
            }
            
            openModal('contentModal');
        };

        window.deleteContent = async (id) => {
            if (!currentUser) {
                showToast('âš ï¸ ØªÚ©Ø§ÛŒÛ• ÛŒÛ•Ú©Û•Ù… Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Ú©Û•');
                openAuthModal();
                return;
            }
            
            if (!isAdmin) {
                showToast('âš ï¸ ØªÛ•Ù†Ù‡Ø§ Ø¦Û•Ø¯Ù…ÛŒÙ† Ø¯Û•ØªÙˆØ§Ù†ÛØª Ø¨Ø³Ú•ÛØªÛ•ÙˆÛ•');
                return;
            }
            
            if (!confirm('Ø¯ÚµÙ†ÛŒØ§ÛŒØª Ø¯Û•ØªÛ•ÙˆÛØª Ø¨Ø³Ú•ÛŒØªÛ•ÙˆÛ•ØŸ')) return;
            
            try {
                await remove(ref(db, `content/${id}`));
                await remove(ref(db, `comments/${id}`));
                showToast('âœ… Ø³Ú•Ø§ÛŒÛ•ÙˆÛ•');
            } catch (error) {
                showToast('âŒ Ù‡Û•ÚµÛ•');
            }
        };

        window.setFilter = (filter) => {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event?.target?.classList.add('active');
            applyFilters();
        };

        window.performSearch = () => {
            const term = document.getElementById('searchInput').value.toLowerCase().trim();
            if (!term) {
                currentFilter = 'all';
                applyFilters();
                return;
            }

            const filtered = allContent.filter(c => 
                c.title?.toLowerCase().includes(term) ||
                c.description?.toLowerCase().includes(term)
            );

            filteredContent = filtered;
            currentPage = 1;
            displayContent();
        };

        loadData();
    </script>
</body>
</html>
