<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ú©ÙˆØ±Ø¯ Ú¤ÛŒÚ˜Ù† Pro</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Aref+Ruqaa:wght@400;700&family=IBM+Plex+Sans+Arabic:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --bg-primary: #0f0f1e;
            --bg-secondary: #1a1a2e;
            --bg-card: #16213e;
            --accent-primary: #e94560;
            --text-primary: #f1f1f1;
            --text-secondary: #a0a0a0;
            --success: #00ff88;
        }
        
        body {
            font-family: 'Aref Ruqaa', 'IBM Plex Sans Arabic', serif;
            background: var(--bg-primary);
            color: var(--text-primary);
            line-height: 1.8;
            overflow-x: hidden;
        }

        h1, h2, h3, h4, h5, h6 { font-family: 'Aref Ruqaa', serif; font-weight: 700; }

        header {
            background: rgba(26, 26, 46, 0.95);
            backdrop-filter: blur(20px);
            position: sticky;
            top: 0;
            z-index: 1000;
            border-bottom: 1px solid rgba(233, 69, 96, 0.1);
        }

        nav {
            max-width: 1400px;
            margin: 0 auto;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .logo {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent-primary);
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-search {
            flex: 1;
            max-width: 500px;
            position: relative;
        }

        .nav-search input {
            width: 100%;
            padding: 10px 40px 10px 15px;
            background: var(--bg-card);
            border: 1px solid transparent;
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
        }

        .nav-search button {
            position: absolute;
            left: 10px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: var(--text-secondary);
            cursor: pointer;
        }

        .nav-links {
            display: flex;
            gap: 5px;
            list-style: none;
            align-items: center;
        }

        .nav-links a {
            padding: 8px 15px;
            color: var(--text-secondary);
            text-decoration: none;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
        }

        .nav-links a:hover, .nav-links a.active {
            color: var(--accent-primary);
            background: rgba(233, 69, 96, 0.1);
        }

        .user-menu {
            position: relative;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid var(--accent-primary);
        }

        .user-dropdown {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            background: var(--bg-card);
            border-radius: 8px;
            min-width: 180px;
            margin-top: 10px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            z-index: 100;
        }

        .user-dropdown.show { display: block; }

        .user-dropdown a {
            display: block;
            padding: 12px 16px;
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.3s;
        }

        .user-dropdown a:hover {
            background: rgba(233, 69, 96, 0.1);
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            font-size: 13px;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            transition: all 0.3s;
        }

        .btn-primary {
            background: var(--accent-primary);
            color: white;
        }

        .btn-primary:hover { background: #d63850; }

        .btn-secondary {
            background: var(--success);
            color: #000;
        }

        .btn-danger { background: #ff4444; color: white; }

        .hero {
            position: relative;
            height: 85vh;
            min-height: 600px;
            overflow: hidden;
            margin-bottom: 40px;
        }

        .hero-slide {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 0.8s ease;
        }

        .hero-slide.active { opacity: 1; }

        .hero-bg {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(0.4);
        }

        .hero-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 80px 60px;
            background: linear-gradient(transparent, rgba(15, 15, 30, 0.98));
        }

        .hero-title {
            font-size: 56px;
            margin-bottom: 20px;
            text-shadow: 2px 2px 10px rgba(0, 0, 0, 0.8);
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 40px 0 25px;
        }

        .section-title { font-size: 24px; }

        .filters {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            overflow-x: auto;
        }

        .filter-btn {
            padding: 8px 20px;
            background: var(--bg-card);
            border: 1px solid transparent;
            border-radius: 20px;
            color: var(--text-secondary);
            font-size: 13px;
            cursor: pointer;
            white-space: nowrap;
            transition: all 0.3s;
        }

        .filter-btn:hover, .filter-btn.active {
            background: var(--accent-primary);
            color: white;
        }

        .movies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
            gap: 20px;
            margin-bottom: 60px;
        }

        .movie-card {
            background: var(--bg-card);
            border-radius: 12px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.4s;
            position: relative;
        }

        .movie-card:hover {
            transform: translateY(-8px);
            box-shadow: 0 20px 40px rgba(233, 69, 96, 0.2);
        }

        .movie-poster {
            position: relative;
            width: 100%;
            aspect-ratio: 2/3;
            overflow: hidden;
        }

        .movie-poster img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .play-icon {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 50px;
            height: 50px;
            background: rgba(233, 69, 96, 0.9);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: all 0.3s;
        }

        .movie-card:hover .play-icon { opacity: 1; }

        .movie-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            padding: 4px 10px;
            background: rgba(233, 69, 96, 0.95);
            border-radius: 4px;
            font-size: 11px;
        }

        .movie-info {
            padding: 12px;
        }

        .movie-title {
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 8px;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .movie-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: var(--text-secondary);
        }

        .modal {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.95);
            z-index: 2000;
            overflow-y: auto;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-content {
            background: var(--bg-secondary);
            border-radius: 16px;
            max-width: 900px;
            width: 100%;
            position: relative;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-close {
            position: absolute;
            top: 15px;
            left: 15px;
            width: 40px;
            height: 40px;
            background: rgba(0, 0, 0, 0.8);
            border: none;
            border-radius: 50%;
            color: white;
            font-size: 24px;
            cursor: pointer;
            z-index: 10;
        }

        .modal-header {
            padding: 25px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .modal-title {
            font-size: 24px;
            color: var(--accent-primary);
        }

        .modal-body { padding: 25px; }

        .form-group { margin-bottom: 20px; }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
            color: var(--text-secondary);
        }

        .form-group input,
        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 12px;
            background: var(--bg-card);
            border: 1px solid transparent;
            border-radius: 8px;
            color: var(--text-primary);
            font-size: 14px;
            font-family: inherit;
        }

        .form-group input:focus,
        .form-group select:focus,
        .form-group textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .social-login {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .social-btn {
            flex: 1;
            padding: 12px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .social-btn.google {
            background: #fff;
            color: #333;
        }

        .social-btn.facebook {
            background: #1877f2;
            color: white;
        }

        .detail-page {
            display: none;
            padding: 40px 0;
        }

        .detail-page.active { display: block; }

        .detail-header {
            position: relative;
            height: 60vh;
            min-height: 500px;
            margin-bottom: 40px;
            border-radius: 16px;
            overflow: hidden;
        }

        .detail-bg {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(0.3);
        }

        .detail-content {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            padding: 40px;
            background: linear-gradient(transparent, var(--bg-primary));
        }

        .detail-title {
            font-size: 42px;
            margin-bottom: 15px;
        }

        .detail-meta {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            font-size: 16px;
            color: var(--text-secondary);
            margin-bottom: 20px;
        }

        .detail-actions {
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
        }

        .video-container {
            position: relative;
            width: 100%;
            padding-top: 56.25%;
            background: #000;
            border-radius: 12px;
            overflow: hidden;
            margin-bottom: 30px;
        }

        .video-player {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .episodes-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin: 30px 0;
        }

        .episode-card {
            background: var(--bg-card);
            border-radius: 8px;
            padding: 15px;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .episode-card:hover {
            border-color: var(--accent-primary);
            transform: translateY(-4px);
        }

        .episode-card.active {
            border-color: var(--accent-primary);
            background: rgba(233, 69, 96, 0.1);
        }

        .comments-section {
            margin-top: 50px;
            padding: 30px;
            background: var(--bg-card);
            border-radius: 12px;
        }

        .comment-form {
            margin-bottom: 30px;
        }

        .comment-form textarea {
            width: 100%;
            padding: 15px;
            background: var(--bg-secondary);
            border: 1px solid transparent;
            border-radius: 8px;
            color: var(--text-primary);
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .comment-form textarea:focus {
            outline: none;
            border-color: var(--accent-primary);
        }

        .comment {
            padding: 20px;
            background: var(--bg-secondary);
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .comment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--accent-primary);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
        }

        .comment-author {
            font-weight: 600;
            color: var(--accent-primary);
        }

        .comment-date {
            font-size: 12px;
            color: var(--text-secondary);
            margin-right: auto;
        }

        .comment-text {
            line-height: 1.6;
            color: var(--text-secondary);
        }

        .admin-controls {
            display: none;
            gap: 8px;
        }

        .admin-controls.show { display: flex; }

        .admin-panel {
            display: none;
            max-width: 1200px;
            margin: 40px auto;
            padding: 0 20px;
        }

        .admin-panel.show { display: block; }

        .admin-section {
            background: var(--bg-card);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 25px;
        }

        .list-item {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            gap: 15px;
        }

        .toast {
            position: fixed;
            bottom: 30px;
            right: 30px;
            background: var(--bg-card);
            padding: 15px 20px;
            border-radius: 8px;
            border-left: 4px solid var(--accent-primary);
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
            z-index: 3000;
            animation: slideIn 0.3s ease;
        }

        @keyframes slideIn {
            from { transform: translateX(400px); }
            to { transform: translateX(0); }
        }

        @media (max-width: 768px) {
            .hero { height: 65vh; min-height: 450px; }
            .movies-grid { grid-template-columns: repeat(auto-fill, minmax(130px, 1fr)); }
            .nav-search { display: none; }
        }
    </style>
</head>
<body>
    <header>
        <nav>
            <div class="logo">
                <i class="fas fa-film"></i>
                <span>Ú©ÙˆØ±Ø¯ Ú¤ÛŒÚ˜Ù†</span>
            </div>
            
            <div class="nav-search">
                <input type="text" placeholder="Ú¯Û•Ú•Ø§Ù†..." id="searchInput">
                <button onclick="performSearch()"><i class="fas fa-search"></i></button>
            </div>

            <ul class="nav-links">
                <li><a href="#" onclick="showSection('home'); return false;" class="active">Ø³Û•Ø±Û•Ú©ÛŒ</a></li>
                <li><a href="#" onclick="setFilter('movies'); return false;">ÙÛŒÙ„Ù…Û•Ú©Ø§Ù†</a></li>
                <li><a href="#" onclick="setFilter('series'); return false;">Ø²Ù†Ø¬ÛŒØ±Û•Ú©Ø§Ù†</a></li>
            </ul>

            <div id="authButtons">
                <button class="btn btn-primary" onclick="openAuthModal()">
                    <i class="fas fa-user"></i> Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•
                </button>
            </div>

            <div class="user-menu" id="userMenu" style="display: none;">
                <img src="" alt="User" class="user-avatar" id="userAvatar" onclick="toggleUserDropdown()">
                <div class="user-dropdown" id="userDropdown">
                    <a href="#" onclick="showSection('admin'); return false;">
                        <i class="fas fa-cog"></i> Ù¾Ø§Ù†ÛÚµÛŒ Ø¦Û•Ø¯Ù…ÛŒÙ†
                    </a>
                    <a href="#" onclick="logout(); return false;">
                        <i class="fas fa-sign-out-alt"></i> Ú†ÙˆÙˆÙ†Û•Ø¯Û•Ø±Û•ÙˆÛ•
                    </a>
                </div>
            </div>
        </nav>
    </header>

    <!-- HOME SECTION -->
    <div id="homeSection">
        <section class="hero" id="heroSection"></section>

        <div class="container">
            <div class="filters" id="filterTabs">
                <button class="filter-btn active" onclick="setFilter('all')">Ù‡Û•Ù…ÙˆÙˆ</button>
                <button class="filter-btn" onclick="setFilter('movies')">ÙÛŒÙ„Ù…Û•Ú©Ø§Ù†</button>
                <button class="filter-btn" onclick="setFilter('series')">Ø²Ù†Ø¬ÛŒØ±Û•Ú©Ø§Ù†</button>
                <button class="filter-btn" onclick="setFilter('latest')">Ù†ÙˆÛØªØ±ÛŒÙ†</button>
            </div>

            <div class="section-header">
                <h2 class="section-title">Ù¾ÛØ´Ù†ÛŒØ§Ø±Ú©Ø±Ø§Ùˆ</h2>
            </div>
            <div class="movies-grid" id="moviesGrid">
                <div style="padding: 60px; text-align: center; color: var(--text-secondary);">
                    Ú†Ø§ÙˆÛ•Ú•Û Ø¨Ú©Û•...
                </div>
            </div>
        </div>
    </div>

    <!-- DETAIL PAGE -->
    <div id="detailPage" class="detail-page"></div>

    <!-- ADMIN PANEL -->
    <div class="admin-panel" id="adminPanel">
        <div class="container">
            <h2 style="margin-bottom: 30px; font-size: 28px;">
                <i class="fas fa-cog"></i> Ù¾Ø§Ù†ÛÚµÛŒ Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†
            </h2>

            <!-- Ø¨Û•Ø´ÛŒ Ù†Ø§ÙˆÛ•Ú•Û†Ú© -->
            <div class="admin-section">
                <h3><i class="fas fa-video"></i> Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Ù†Ø§ÙˆÛ•Ú•Û†Ú© (ÙÛŒÙ„Ù… Ùˆ Ø²Ù†Ø¬ÛŒØ±Û•)</h3>
                <div style="display: flex; gap: 10px; flex-wrap: wrap; margin: 20px 0;">
                    <button class="btn btn-primary" onclick="openContentModal('movie')">
                        <i class="fas fa-plus"></i> Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ ÙÛŒÙ„Ù…
                    </button>
                    <button class="btn btn-primary" onclick="openContentModal('series')">
                        <i class="fas fa-plus"></i> Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø²Ù†Ø¬ÛŒØ±Û•
                    </button>
                </div>
                <div id="contentManager"></div>
            </div>

            <!-- Ø¨Û•Ø´ÛŒ Slides -->
            <div class="admin-section" style="margin-top: 30px;">
                <h3><i class="fas fa-images"></i> Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Hero Slider</h3>
                <button class="btn btn-primary" onclick="openSlideModal()" style="margin: 15px 0;">
                    <i class="fas fa-plus"></i> Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Slide Ù†ÙˆÛ
                </button>
                <div id="slidesManager"></div>
            </div>

            <!-- Ø¨Û•Ø´ÛŒ Ú©Û†Ù…ÛÙ†ØªÛ•Ú©Ø§Ù† -->
            <div class="admin-section" style="margin-top: 30px;">
                <h3><i class="fas fa-comments"></i> Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Ú©Û†Ù…ÛÙ†ØªÛ•Ú©Ø§Ù†</h3>
                <div id="allCommentsManager"></div>
            </div>

            <!-- Ø¦Ø§Ù…Ø§Ø±ÛŒ Ú¯Ø´ØªÛŒ -->
            <div class="admin-section" style="margin-top: 30px;">
                <h3><i class="fas fa-chart-bar"></i> Ø¦Ø§Ù…Ø§Ø±</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-top: 20px;">
                    <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700; color: var(--accent-primary);" id="totalContent">0</div>
                        <div style="color: var(--text-secondary); margin-top: 8px;">Ú©Û†ÛŒ Ù†Ø§ÙˆÛ•Ú•Û†Ú©</div>
                    </div>
                    <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700; color: var(--success);" id="totalMovies">0</div>
                        <div style="color: var(--text-secondary); margin-top: 8px;">ÙÛŒÙ„Ù…Û•Ú©Ø§Ù†</div>
                    </div>
                    <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700; color: #2196F3;" id="totalSeries">0</div>
                        <div style="color: var(--text-secondary); margin-top: 8px;">Ø²Ù†Ø¬ÛŒØ±Û•Ú©Ø§Ù†</div>
                    </div>
                    <div style="background: var(--bg-secondary); padding: 20px; border-radius: 8px; text-align: center;">
                        <div style="font-size: 32px; font-weight: 700; color: #ff9800;" id="totalComments">0</div>
                        <div style="color: var(--text-secondary); margin-top: 8px;">Ú©Û†Ù…ÛÙ†ØªÛ•Ú©Ø§Ù†</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- AUTH MODAL -->
    <div class="modal" id="authModal">
        <div class="modal-content" style="max-width: 420px;">
            <button class="modal-close" onclick="closeModal('authModal')">Ã—</button>
            <div class="modal-header">
                <h2 class="modal-title">Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•</h2>
            </div>
            <div class="modal-body">
                <form onsubmit="handleAuth(event, 'login')" id="loginForm">
                    <div class="form-group">
                        <label>Ø¦ÛŒÙ…Û•ÛŒÚµ</label>
                        <input type="email" id="authEmail" required>
                    </div>
                    <div class="form-group">
                        <label>Ù¾Ø§Ø³ÙˆÛ†Ø±Ø¯</label>
                        <input type="password" id="authPassword" required>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%; justify-content: center;">
                        Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•
                    </button>
                </form>

                <div style="text-align: center; margin: 20px 0; color: var(--text-secondary);">
                    ÛŒØ§Ù†
                </div>

                <div class="social-login">
                    <button class="social-btn google" onclick="socialLogin('google')">
                        <i class="fab fa-google"></i> Google
                    </button>
                    <button class="social-btn facebook" onclick="socialLogin('facebook')">
                        <i class="fab fa-facebook-f"></i> Facebook
                    </button>
                </div>

                <div style="margin-top: 20px; text-align: center;">
                    <a href="#" onclick="toggleAuthMode()" style="color: var(--accent-primary); text-decoration: none;">
                        Ù‡Û•Ú˜Ù…Ø§Ø±Øª Ù†ÛŒÛŒÛ•ØŸ Ø¯Ø±ÙˆØ³ØªÛŒ Ø¨Ú©Û•
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- CONTENT MODAL (Movie/Series) -->
    <div class="modal" id="contentModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('contentModal')">Ã—</button>
            <div class="modal-header">
                <h2 class="modal-title" id="contentModalTitle">Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ù†Ø§ÙˆÛ•Ú•Û†Ú©</h2>
            </div>
            <div class="modal-body">
                <form onsubmit="saveContent(event)">
                    <input type="hidden" id="contentType">
                    <input type="hidden" id="contentEditId">
                    
                    <div class="form-group">
                        <label>Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù† *</label>
                        <input type="text" id="contentTitle" required>
                    </div>

                    <div class="form-group">
                        <label>Ù„ÛŒÙ†Ú©ÛŒ Ù¾Û†Ø³ØªÛ•Ø± *</label>
                        <input type="url" id="contentPoster" required>
                    </div>

                    <div class="form-group">
                        <label>Ø³Ø§Úµ</label>
                        <input type="text" id="contentYear">
                    </div>

                    <div class="form-group">
                        <label>Ú•Û•ÛŒØªÛŒÙ†Ú¯ (Ù„Û• 10)</label>
                        <input type="number" id="contentRating" min="0" max="10" step="0.1">
                    </div>

                    <div class="form-group">
                        <label>ÙˆÛ•Ø³Ù</label>
                        <textarea id="contentDescription"></textarea>
                    </div>

                    <!-- Ø¨Û•Ø´ÛŒ Ø²Ù†Ø¬ÛŒØ±Û• - ØªÛ•Ù†Ù‡Ø§ Ø¨Û† Ø²Ù†Ø¬ÛŒØ±Û•Ú©Ø§Ù† -->
                    <div id="seriesSection" style="display: none;">
                        <h3 style="margin: 20px 0; color: var(--accent-primary);">Ø¦Û•ÚµÙ‚Û•Ú©Ø§Ù†</h3>
                        <div id="episodesContainer"></div>
                        <button type="button" class="btn btn-secondary" onclick="addEpisode()">
                            <i class="fas fa-plus"></i> Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø¦Û•ÚµÙ‚Û•
                        </button>
                    </div>

                    <!-- Ø¨Û•Ø´ÛŒ ÙÛŒÙ„Ù… - ØªÛ•Ù†Ù‡Ø§ Ø¨Û† ÙÛŒÙ„Ù…Û•Ú©Ø§Ù† -->
                    <div id="movieSection" style="display: none;">
                        <div class="form-group">
                            <label>Ù„ÛŒÙ†Ú©ÛŒ Ø³ÛØ±Ú¤Û•Ø±</label>
                            <input type="url" id="movieServer">
                        </div>
                    </div>

                    <div style="margin-top: 30px; display: flex; gap: 10px;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('contentModal')">
                            Ù‡Û•ÚµÙˆÛ•Ø´Ø§Ù†Ø¯Ù†Û•ÙˆÛ•
                        </button>
                        <button type="submit" class="btn btn-primary">
                            Ù¾Ø§Ø´Û•Ú©Û•ÙˆØªÚ©Ø±Ø¯Ù†
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- SLIDE MODAL -->
    <div class="modal" id="slideModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('slideModal')">Ã—</button>
            <div class="modal-header">
                <h2 class="modal-title">Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Slide</h2>
            </div>
            <div class="modal-body">
                <form onsubmit="saveSlide(event)">
                    <input type="hidden" id="slideEditId">
                    
                    <div class="form-group">
                        <label>Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù† *</label>
                        <input type="text" id="slideTitle" required>
                    </div>

                    <div class="form-group">
                        <label>Ù„ÛŒÙ†Ú©ÛŒ ÙˆÛÙ†Û• *</label>
                        <input type="url" id="slideImage" required>
                    </div>

                    <div class="form-group">
                        <label>ÙˆÛ•Ø³Ù</label>
                        <textarea id="slideDescription"></textarea>
                    </div>

                    <div class="form-group">
                        <label>ID ÛŒ Ù†Ø§ÙˆÛ•Ú•Û†Ú© (Ø¨Û† Ø¯ÙˆÚ¯Ù…Û•ÛŒ Ø¨ÛŒÙ†ÛŒÙ†)</label>
                        <input type="text" id="slideContentId">
                    </div>

                    <div style="margin-top: 20px; display: flex; gap: 10px;">
                        <button type="button" class="btn btn-secondary" onclick="closeModal('slideModal')">
                            Ù‡Û•ÚµÙˆÛ•Ø´Ø§Ù†Ø¯Ù†Û•ÙˆÛ•
                        </button>
                        <button type="submit" class="btn btn-primary">
                            Ù¾Ø§Ø´Û•Ú©Û•ÙˆØªÚ©Ø±Ø¯Ù†
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, push, set, onValue, remove, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, signOut, onAuthStateChanged, GoogleAuthProvider, FacebookAuthProvider, signInWithPopup } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAaE1v9PcHGsSgF1IlnDrygX5TT2-zii8o",
            authDomain: "kurdvision-f9d3e.firebaseapp.com",
            databaseURL: "https://kurdvision-f9d3e-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "kurdvision-f9d3e"
        };

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);
        const auth = getAuth(app);

        let allContent = [];
        let allSlides = [];
        let currentUser = null;
        let isAdmin = false;
        let currentFilter = 'all';
        let authMode = 'login';

        // âœ… Global Functions - Ø¯Û•Ø¨Û Ù¾ÛØ´ Ù‡Û•Ù…ÙˆÙˆ Ø´ØªÛÚ© Ø¨Ù†
        window.openAuthModal = function() {
            console.log('Opening auth modal...');
            openModal('authModal');
        };

        window.openModal = function(id) {
            console.log('Opening modal:', id);
            const modal = document.getElementById(id);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            } else {
                console.error('Modal not found:', id);
            }
        };

        window.closeModal = function(id) {
            const modal = document.getElementById(id);
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        };

        window.toggleUserDropdown = function() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('show');
        };

        window.showSection = function(section) {
            console.log('Showing section:', section);
            
            if (section === 'admin') {
                if (!isAdmin) {
                    showToast('âš ï¸ ØªÛ•Ù†Ù‡Ø§ Ø¦Û•Ø¯Ù…ÛŒÙ† Ø¯Û•ØªÙˆØ§Ù†ÛØª Ø¨Ú†ÛØªÛ• Ù¾Ø§Ù†ÛÚµ');
                    return;
                }
                document.getElementById('homeSection').style.display = 'none';
                document.getElementById('detailPage').classList.remove('active');
                document.getElementById('adminPanel').classList.add('show');
            } else {
                document.getElementById('homeSection').style.display = 'block';
                document.getElementById('detailPage').classList.remove('active');
                document.getElementById('adminPanel').classList.remove('show');
            }
        };

        window.showToast = function(message) {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        };

        // âœ… Ù¾Ø´Ú©Ù†ÛŒÙ†ÛŒ URL Ø¨Û† admin=true
        const urlParams = new URLSearchParams(window.location.search);
        const showAdminPanel = urlParams.get('admin') === 'true';

        console.log('Admin mode:', showAdminPanel);

        // Check Auth
        onAuthStateChanged(auth, (user) => {
            console.log('Auth state changed:', user);
            currentUser = user;
            updateUIForAuth(user);
            
            if (user && showAdminPanel) {
                // âœ… Ø¦Û•Ú¯Û•Ø± admin=true Ù‡Û•Ø¨ÛØªØŒ Ø¦Û†ØªÛ†Ù…Ø§ØªÛŒÚ© ÙˆÛ•Ú© Ø¦Û•Ø¯Ù…ÛŒÙ† Ø¯Ø§Ø¨Ù†Û
                isAdmin = true;
                console.log('User is now admin');
            } else if (user) {
                checkAdminStatus(user.uid);
            }
        });

        function updateUIForAuth(user) {
            console.log('Updating UI for user:', user);
            
            if (user) {
                document.getElementById('authButtons').style.display = 'none';
                document.getElementById('userMenu').style.display = 'block';
                
                const avatar = document.getElementById('userAvatar');
                if (user.photoURL) {
                    avatar.src = user.photoURL;
                    avatar.innerHTML = '';
                } else {
                    avatar.src = '';
                    avatar.style.background = 'var(--accent-primary)';
                    avatar.style.display = 'flex';
                    avatar.style.alignItems = 'center';
                    avatar.style.justifyContent = 'center';
                    avatar.style.color = 'white';
                    avatar.style.fontSize = '16px';
                    avatar.innerHTML = user.email[0].toUpperCase();
                }
            } else {
                document.getElementById('authButtons').style.display = 'block';
                document.getElementById('userMenu').style.display = 'none';
                isAdmin = false;
            }
        }

        function checkAdminStatus(uid) {
            onValue(ref(db, `admins/${uid}`), (snapshot) => {
                isAdmin = snapshot.exists();
                console.log('Admin status from DB:', isAdmin);
            });
        }

        // Load Data
        function loadData() {
            onValue(ref(db, 'content'), (snapshot) => {
                allContent = [];
                snapshot.forEach((child) => {
                    allContent.push({ id: child.key, ...child.val() });
                });
                displayContent();
                displayContentManager();
                updateStats();
            });

            onValue(ref(db, 'slides'), (snapshot) => {
                allSlides = [];
                snapshot.forEach((child) => {
                    allSlides.push({ id: child.key, ...child.val() });
                });
                loadHero();
                displaySlidesManager();
            });

            // Load all comments for admin
            onValue(ref(db, 'comments'), (snapshot) => {
                displayAllComments(snapshot);
            });
        }

        function updateStats() {
            const totalMovies = allContent.filter(c => c.type === 'movie').length;
            const totalSeries = allContent.filter(c => c.type === 'series').length;
            const totalComments = allContent.reduce((sum, c) => sum + (c.commentsCount || 0), 0);

            document.getElementById('totalContent').textContent = allContent.length;
            document.getElementById('totalMovies').textContent = totalMovies;
            document.getElementById('totalSeries').textContent = totalSeries;
            document.getElementById('totalComments').textContent = totalComments;
        }

        function displaySlidesManager() {
            const manager = document.getElementById('slidesManager');
            if (allSlides.length === 0) {
                manager.innerHTML = '<p style="padding: 20px; text-align: center; color: var(--text-secondary);">Ù‡ÛŒÚ† Slide ÛÚ© Ù†ÛŒÛŒÛ•</p>';
                return;
            }

            manager.innerHTML = allSlides.map(slide => `
                <div class="list-item">
                    <div style="flex: 1;">
                        <div style="font-weight: 600; margin-bottom: 5px;">${slide.title}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">
                            ${slide.description || 'Ø¨Û ÙˆÛ•Ø³Ù'}
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px;">
                        <button class="btn" style="background: #2196F3; color: white;" onclick="editSlide('${slide.id}')">
                            <i class="fas fa-edit"></i> Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ
                        </button>
                        <button class="btn btn-danger" onclick="deleteSlide('${slide.id}')">
                            <i class="fas fa-trash"></i> Ø³Ú•ÛŒÙ†Û•ÙˆÛ•
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function displayAllComments(snapshot) {
            const manager = document.getElementById('allCommentsManager');
            const allComments = [];
            
            snapshot.forEach((contentNode) => {
                const contentId = contentNode.key;
                const content = allContent.find(c => c.id === contentId);
                
                contentNode.forEach((commentNode) => {
                    allComments.push({
                        id: commentNode.key,
                        contentId: contentId,
                        contentTitle: content?.title || 'Ù†Û•Ù†Ø§Ø³Ø±Ø§Ùˆ',
                        ...commentNode.val()
                    });
                });
            });

            allComments.sort((a, b) => new Date(b.date) - new Date(a.date));

            if (allComments.length === 0) {
                manager.innerHTML = '<p style="padding: 20px; text-align: center; color: var(--text-secondary);">Ù‡ÛŒÚ† Ú©Û†Ù…ÛÙ†ØªÛÚ© Ù†ÛŒÛŒÛ•</p>';
                return;
            }

            manager.innerHTML = allComments.slice(0, 20).map(comment => `
                <div class="list-item">
                    <div style="flex: 1;">
                        <div style="font-weight: 600; margin-bottom: 5px;">
                            ${comment.userName}
                            <span style="color: var(--accent-primary); font-size: 12px; margin-right: 10px;">
                                Ù„Û•Ø³Û•Ø±: ${comment.contentTitle}
                            </span>
                        </div>
                        <div style="font-size: 13px; color: var(--text-secondary); margin: 5px 0;">
                            ${comment.text}
                        </div>
                        <div style="font-size: 11px; color: var(--text-secondary);">
                            ${formatDate(comment.date)}
                        </div>
                    </div>
                    <button class="btn btn-danger" onclick="deleteCommentFromAdmin('${comment.contentId}', '${comment.id}')">
                        <i class="fas fa-trash"></i> Ø³Ú•ÛŒÙ†Û•ÙˆÛ•
                    </button>
                </div>
            `).join('');
        }

        window.deleteCommentFromAdmin = async (contentId, commentId) => {
            if (!confirm('Ø¯ÚµÙ†ÛŒØ§ÛŒØªØŸ')) return;
            
            try {
                await remove(ref(db, `comments/${contentId}/${commentId}`));
                const item = allContent.find(c => c.id === contentId);
                await update(ref(db, `content/${contentId}`), {
                    commentsCount: Math.max(0, (item?.commentsCount || 0) - 1)
                });
                showToast('âœ… Ú©Û†Ù…ÛÙ†Øª Ø³Ú•Ø§ÛŒÛ•ÙˆÛ•');
            } catch (error) {
                showToast('âŒ Ù‡Û•ÚµÛ•');
            }
        };

        window.editSlide = (id) => {
            const slide = allSlides.find(s => s.id === id);
            if (!slide) return;
            
            document.getElementById('slideEditId').value = id;
            document.getElementById('slideTitle').value = slide.title;
            document.getElementById('slideImage').value = slide.image;
            document.getElementById('slideDescription').value = slide.description || '';
            document.getElementById('slideContentId').value = slide.contentId || '';
            
            openModal('slideModal');
        };

        window.deleteSlide = async (id) => {
            if (!confirm('Ø¯ÚµÙ†ÛŒØ§ÛŒØª Ø¯Û•ØªÛ•ÙˆÛØª Ø¦Û•Ù… Slide ÛŒÛ• Ø¨Ø³Ú•ÛŒØªÛ•ÙˆÛ•ØŸ')) return;
            
            try {
                await remove(ref(db, `slides/${id}`));
                showToast('âœ… Slide Ø³Ú•Ø§ÛŒÛ•ÙˆÛ•');
            } catch (error) {
                showToast('âŒ Ù‡Û•ÚµÛ•');
            }
        };

        function displayContent() {
            const grid = document.getElementById('moviesGrid');
            let filtered = [...allContent];

            if (currentFilter === 'movies') {
                filtered = filtered.filter(c => c.type === 'movie');
            } else if (currentFilter === 'series') {
                filtered = filtered.filter(c => c.type === 'series');
            } else if (currentFilter === 'latest') {
                filtered = filtered.sort((a, b) => new Date(b.date) - new Date(a.date)).slice(0, 20);
            }

            if (filtered.length === 0) {
                grid.innerHTML = '<div style="padding: 60px; text-align: center; color: var(--text-secondary);">Ù‡ÛŒÚ† Ù†Ø§ÙˆÛ•Ú•Û†Ú©ÛÚ© Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•</div>';
                return;
            }

            grid.innerHTML = filtered.map(item => `
                <div class="movie-card" onclick="openDetail('${item.id}')">
                    <div class="movie-poster">
                        <img src="${item.poster}" alt="${item.title}">
                        <div class="play-icon"><i class="fas fa-play"></i></div>
                        ${item.rating ? `<div class="movie-badge">â­ ${item.rating}</div>` : ''}
                    </div>
                    <div class="movie-info">
                        <div class="movie-title">${item.title}</div>
                        <div class="movie-meta">
                            <span>${item.year || '2024'}</span>
                            <span>${item.type === 'series' ? 'Ø²Ù†Ø¬ÛŒØ±Û•' : 'ÙÛŒÙ„Ù…'}</span>
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function loadHero() {
            const hero = document.getElementById('heroSection');
            if (allSlides.length === 0) {
                hero.style.display = 'none';
                return;
            }

            hero.style.display = 'block';
            let currentSlide = 0;
            
            hero.innerHTML = allSlides.slice(0, 5).map((slide, index) => `
                <div class="hero-slide ${index === 0 ? 'active' : ''}">
                    <img src="${slide.image}" class="hero-bg">
                    <div class="hero-content">
                        <h1 class="hero-title">${slide.title}</h1>
                        ${slide.description ? `<p style="margin-bottom: 20px; max-width: 600px;">${slide.description}</p>` : ''}
                        ${slide.contentId ? `<button class="btn btn-primary" onclick="openDetail('${slide.contentId}')"><i class="fas fa-play"></i> Ø¨ÛŒÙ†ÛŒÙ†</button>` : ''}
                    </div>
                </div>
            `).join('');

            setInterval(() => {
                const slides = document.querySelectorAll('.hero-slide');
                slides[currentSlide].classList.remove('active');
                currentSlide = (currentSlide + 1) % slides.length;
                slides[currentSlide].classList.add('active');
            }, 5000);
        }

        // Open Detail Page
        window.openDetail = (id) => {
            const item = allContent.find(c => c.id === id);
            if (!item) return;

            update(ref(db, `content/${id}`), { views: (item.views || 0) + 1 });

            const detailPage = document.getElementById('detailPage');
            document.getElementById('homeSection').style.display = 'none';
            document.getElementById('adminPanel').classList.remove('show');
            detailPage.classList.add('active');

            let episodesHTML = '';
            if (item.type === 'series' && item.episodes) {
                episodesHTML = `
                    <div class="episodes-grid" id="episodesList">
                        ${item.episodes.map((ep, i) => `
                            <div class="episode-card ${i === 0 ? 'active' : ''}" onclick="switchEpisode('${ep.server}', this)">
                                <h4>Ø¦Û•ÚµÙ‚Û•ÛŒ ${ep.number}</h4>
                                <p style="font-size: 13px; color: var(--text-secondary); margin-top: 8px;">${ep.title || ''}</p>
                            </div>
                        `).join('')}
                    </div>
                `;
            }

            const firstServer = item.type === 'series' ? item.episodes[0].server : item.server;

            detailPage.innerHTML = `
                <div class="container">
                    <button class="btn btn-secondary" onclick="closeDetail()" style="margin-bottom: 20px;">
                        <i class="fas fa-arrow-right"></i> Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ•
                    </button>

                    <div class="detail-header">
                        <img src="${item.poster}" class="detail-bg">
                        <div class="detail-content">
                            <h1 class="detail-title">${item.title}</h1>
                            <div class="detail-meta">
                                <span>ğŸ“… ${item.year || '2024'}</span>
                                ${item.rating ? `<span>â­ ${item.rating}/10</span>` : ''}
                                <span>ğŸ‘ï¸ ${(item.views || 0).toLocaleString()}</span>
                                <span>${item.type === 'series' ? 'Ø²Ù†Ø¬ÛŒØ±Û•' : 'ÙÛŒÙ„Ù…'}</span>
                            </div>
                            ${item.description ? `<p style="max-width: 700px; margin-top: 15px; line-height: 1.8;">${item.description}</p>` : ''}
                        </div>
                    </div>

                    ${firstServer ? `
                        <div class="video-container">
                            <iframe id="videoPlayer" class="video-player" src="${firstServer}" allowfullscreen allow="autoplay"></iframe>
                        </div>
                    ` : ''}

                    ${episodesHTML}

                    <div class="comments-section">
                        <h3 style="margin-bottom: 20px; font-size: 22px;">ğŸ’¬ Ù„ÛØ¯ÙˆØ§Ù†Û•Ú©Ø§Ù† (${item.commentsCount || 0})</h3>
                        
                        ${currentUser ? `
                            <div class="comment-form">
                                <textarea id="commentText" placeholder="Ù„ÛØ¯ÙˆØ§Ù†Û•Ú©Û•Øª Ø¨Ù†ÙˆÙˆØ³Û•..."></textarea>
                                <button class="btn btn-primary" onclick="postComment('${id}')" style="margin-top: 10px;">
                                    <i class="fas fa-paper-plane"></i> Ù†Ø§Ø±Ø¯Ù†
                                </button>
                            </div>
                        ` : `
                            <div style="text-align: center; padding: 20px; background: var(--bg-secondary); border-radius: 8px;">
                                <p style="margin-bottom: 15px;">ØªÚ©Ø§ÛŒÛ• Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Ú©Û• Ø¨Û† Ù†ÙˆÙˆØ³ÛŒÙ†ÛŒ Ù„ÛØ¯ÙˆØ§Ù†</p>
                                <button class="btn btn-primary" onclick="openModal('authModal')">
                                    Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•
                                </button>
                            </div>
                        `}

                        <div id="commentsList" style="margin-top: 30px;"></div>
                    </div>
                </div>
            `;

            loadComments(id);
        };

        window.closeDetail = () => {
            document.getElementById('detailPage').classList.remove('active');
            document.getElementById('homeSection').style.display = 'block';
        };

        window.switchEpisode = (url, card) => {
            document.querySelectorAll('.episode-card').forEach(c => c.classList.remove('active'));
            card.classList.add('active');
            document.getElementById('videoPlayer').src = url;
        };

        // Comments
        function loadComments(contentId) {
            onValue(ref(db, `comments/${contentId}`), (snapshot) => {
                const comments = [];
                snapshot.forEach((child) => {
                    comments.push({ id: child.key, ...child.val() });
                });
                
                comments.sort((a, b) => new Date(b.date) - new Date(a.date));
                
                const list = document.getElementById('commentsList');
                if (comments.length === 0) {
                    list.innerHTML = '<p style="text-align: center; color: var(--text-secondary);">Ù‡ÛŒÚ† Ù„ÛØ¯ÙˆØ§Ù†ÛÚ© Ù†ÛŒÛŒÛ•</p>';
                    return;
                }

                list.innerHTML = comments.map(comment => `
                    <div class="comment">
                        <div class="comment-header">
                            <div class="comment-avatar">${comment.userName[0].toUpperCase()}</div>
                            <div>
                                <div class="comment-author">${comment.userName}</div>
                                <div class="comment-date">${formatDate(comment.date)}</div>
                            </div>
                            ${(currentUser && currentUser.uid === comment.userId) || isAdmin ? `
                                <button class="btn btn-danger" onclick="deleteComment('${contentId}', '${comment.id}')" style="margin-right: auto; padding: 6px 12px;">
                                    <i class="fas fa-trash"></i>
                                </button>
                            ` : ''}
                        </div>
                        <div class="comment-text">${comment.text}</div>
                    </div>
                `).join('');
            });
        }

        window.postComment = async (contentId) => {
            if (!currentUser) {
                showToast('âš ï¸ ØªÚ©Ø§ÛŒÛ• Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ• Ø¨Ú©Û•');
                return;
            }

            const text = document.getElementById('commentText').value.trim();
            if (!text) {
                showToast('âš ï¸ Ù„ÛØ¯ÙˆØ§Ù†Û•Ú©Û•Øª Ø¨Ù†ÙˆÙˆØ³Û•');
                return;
            }

            try {
                await push(ref(db, `comments/${contentId}`), {
                    text: text,
                    userId: currentUser.uid,
                    userName: currentUser.displayName || currentUser.email.split('@')[0],
                    date: new Date().toISOString()
                });

                const item = allContent.find(c => c.id === contentId);
                await update(ref(db, `content/${contentId}`), {
                    commentsCount: (item.commentsCount || 0) + 1
                });

                document.getElementById('commentText').value = '';
                showToast('âœ… Ù„ÛØ¯ÙˆØ§Ù†Û•Ú©Û•Øª Ù†ÛØ±Ø¯Ø±Ø§');
            } catch (error) {
                showToast('âŒ Ù‡Û•ÚµÛ• Ú•ÙˆÙˆÛŒØ¯Ø§');
            }
        };

        window.deleteComment = async (contentId, commentId) => {
            if (!confirm('Ø¯ÚµÙ†ÛŒØ§ÛŒØªØŸ')) return;
            
            try {
                await remove(ref(db, `comments/${contentId}/${commentId}`));
                
                const item = allContent.find(c => c.id === contentId);
                await update(ref(db, `content/${contentId}`), {
                    commentsCount: Math.max(0, (item.commentsCount || 0) - 1)
                });
                
                showToast('âœ… Ø³Ú•Ø§ÛŒÛ•ÙˆÛ•');
            } catch (error) {
                showToast('âŒ Ù‡Û•ÚµÛ•');
            }
        };

        function formatDate(dateStr) {
            const date = new Date(dateStr);
            const now = new Date();
            const diff = Math.floor((now - date) / 1000);

            if (diff < 60) return 'Ø¦ÛØ³ØªØ§';
            if (diff < 3600) return Math.floor(diff / 60) + ' Ø®ÙˆÙ„Û•Ú© Ù¾ÛØ´ Ø¦ÛØ³ØªØ§';
            if (diff < 86400) return Math.floor(diff / 3600) + ' Ú©Ø§ØªÚ˜Ù…ÛØ± Ù¾ÛØ´ Ø¦ÛØ³ØªØ§';
            return Math.floor(diff / 86400) + ' Ú•Û†Ú˜ Ù¾ÛØ´ Ø¦ÛØ³ØªØ§';
        }

        // Auth Functions
        window.handleAuth = async (e, mode) => {
            e.preventDefault();
            console.log('Handling auth:', mode);
            
            const email = document.getElementById('authEmail').value;
            const password = document.getElementById('authPassword').value;

            try {
                if (mode === 'login') {
                    await signInWithEmailAndPassword(auth, email, password);
                    showToast('âœ… Ø¨Û•Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ú†ÙˆÙˆÛŒØªÛ•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•');
                } else {
                    await createUserWithEmailAndPassword(auth, email, password);
                    showToast('âœ… Ù‡Û•Ú˜Ù…Ø§Ø± Ø¯Ø±ÙˆØ³Øª Ú©Ø±Ø§');
                }
                closeModal('authModal');
            } catch (error) {
                console.error('Auth error:', error);
                let errorMsg = 'âŒ Ù‡Û•ÚµÛ• Ú•ÙˆÙˆÛŒØ¯Ø§';
                if (error.code === 'auth/email-already-in-use') {
                    errorMsg = 'âŒ Ø¦Û•Ù… Ø¦ÛŒÙ…Û•ÛŒÚµÛ• Ù¾ÛØ´ØªØ± Ø¨Û•Ú©Ø§Ø±Ù‡ÛÙ†Ø±Ø§ÙˆÛ•';
                } else if (error.code === 'auth/wrong-password' || error.code === 'auth/user-not-found') {
                    errorMsg = 'âŒ Ø¦ÛŒÙ…Û•ÛŒÚµ ÛŒØ§Ù† Ù¾Ø§Ø³ÙˆÛ†Ø±Ø¯ Ù‡Û•ÚµÛ•ÛŒÛ•';
                } else if (error.code === 'auth/weak-password') {
                    errorMsg = 'âŒ Ù¾Ø§Ø³ÙˆÛ†Ø±Ø¯ Ù„Ø§ÛŒÛ•Ù†ÛŒ Ú©Û•Ù… 6 Ù¾ÛŒØª Ø¨ÛØª';
                }
                showToast(errorMsg);
            }
        };

        window.socialLogin = async (provider) => {
            console.log('Social login:', provider);
            
            try {
                let authProvider;
                if (provider === 'google') {
                    authProvider = new GoogleAuthProvider();
                } else if (provider === 'facebook') {
                    authProvider = new FacebookAuthProvider();
                }

                await signInWithPopup(auth, authProvider);
                closeModal('authModal');
                showToast('âœ… Ø¨Û•Ø³Û•Ø±Ú©Û•ÙˆØªÙˆÙˆÛŒÛŒ Ú†ÙˆÙˆÛŒØªÛ•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•');
            } catch (error) {
                console.error('Social login error:', error);
                showToast('âŒ Ù‡Û•ÚµÛ•: ' + error.message);
            }
        };

        window.logout = async () => {
            console.log('Logging out...');
            await signOut(auth);
            showToast('âœ… Ú†ÙˆÙˆÛŒØªÛ• Ø¯Û•Ø±Û•ÙˆÛ•');
            isAdmin = false;
            showSection('home');
        };

        window.toggleAuthMode = () => {
            authMode = authMode === 'login' ? 'signup' : 'login';
            const form = document.getElementById('loginForm');
            const title = document.querySelector('#authModal .modal-title');
            const btn = form.querySelector('button[type="submit"]');
            const link = document.querySelector('#authModal a');
            
            if (authMode === 'signup') {
                title.textContent = 'Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ø¯Ù†ÛŒ Ù‡Û•Ú˜Ù…Ø§Ø±';
                btn.innerHTML = '<i class="fas fa-user-plus"></i> Ø¯Ø±ÙˆØ³ØªÚ©Ø±Ø¯Ù†';
                link.textContent = 'Ù‡Û•Ú˜Ù…Ø§Ø±Øª Ù‡Û•ÛŒÛ•ØŸ Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•';
                form.onsubmit = (e) => handleAuth(e, 'signup');
            } else {
                title.textContent = 'Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•';
                btn.innerHTML = '<i class="fas fa-sign-in-alt"></i> Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û•ÙˆÛ•';
                link.textContent = 'Ù‡Û•Ú˜Ù…Ø§Ø±Øª Ù†ÛŒÛŒÛ•ØŸ Ø¯Ø±ÙˆØ³ØªÛŒ Ø¨Ú©Û•';
                form.onsubmit = (e) => handleAuth(e, 'login');
            }
        };

        window.toggleUserDropdown = () => {
            document.getElementById('userDropdown').classList.toggle('show');
        };

        // Admin Functions
        window.openContentModal = (type) => {
            if (!isAdmin) {
                showToast('âš ï¸ ØªÛ•Ù†Ù‡Ø§ Ø¦Û•Ø¯Ù…ÛŒÙ† Ø¯Û•ØªÙˆØ§Ù†ÛØª');
                return;
            }
            
            document.getElementById('contentType').value = type;
            document.getElementById('contentEditId').value = '';
            document.getElementById('contentModalTitle').textContent = type === 'movie' ? 'Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ ÙÛŒÙ„Ù…' : 'Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø²Ù†Ø¬ÛŒØ±Û•';
            
            document.getElementById('movieSection').style.display = type === 'movie' ? 'block' : 'none';
            document.getElementById('seriesSection').style.display = type === 'series' ? 'block' : 'none';
            
            document.getElementById('contentModal').querySelectorAll('input, textarea').forEach(el => {
                if (el.type !== 'hidden') el.value = '';
            });
            
            document.getElementById('episodesContainer').innerHTML = '';
            
            // âœ… Ø¨Û† Ø²Ù†Ø¬ÛŒØ±Û•ØŒ ÛŒÛ•Ú© Ø¦Û•ÚµÙ‚Û•ÛŒ Ø³Û•Ø±Û•ØªØ§ÛŒÛŒ Ø²ÛŒØ§Ø¯ Ø¨Ú©Û•
            if (type === 'series') {
                addEpisode();
            }
            
            openModal('contentModal');
        };

        window.addEpisode = () => {
            const container = document.getElementById('episodesContainer');
            const num = container.children.length + 1;
            
            const episodeDiv = document.createElement('div');
            episodeDiv.style.cssText = 'background: var(--bg-secondary); padding: 15px; border-radius: 8px; margin-bottom: 15px;';
            episodeDiv.innerHTML = `
                <h4 style="margin-bottom: 10px; color: var(--accent-primary);">Ø¦Û•ÚµÙ‚Û•ÛŒ ${num}</h4>
                <div class="form-group">
                    <label>Ú˜Ù…Ø§Ø±Û•ÛŒ Ø¦Û•ÚµÙ‚Û• *</label>
                    <input type="number" class="ep-number" value="${num}" required>
                </div>
                <div class="form-group">
                    <label>Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù†ÛŒ Ø¦Û•ÚµÙ‚Û•</label>
                    <input type="text" class="ep-title" placeholder="Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù† (Ø¦ÛŒØ®ØªÛŒØ§Ø±ÛŒ)">
                </div>
                <div class="form-group">
                    <label>Ù„ÛŒÙ†Ú©ÛŒ Ø³ÛØ±Ú¤Û•Ø± (Upstream/Filemoon/...) *</label>
                    <input type="url" class="ep-server" placeholder="https://..." required>
                </div>
                <button type="button" class="btn btn-danger" onclick="this.parentElement.remove()" style="width: 100%; justify-content: center;">
                    <i class="fas fa-trash"></i> Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ø¦Û•Ù… Ø¦Û•ÚµÙ‚Û•ÛŒÛ•
                </button>
            `;
            container.appendChild(episodeDiv);
        };

        window.saveContent = async (e) => {
            e.preventDefault();
            
            if (!isAdmin) {
                showToast('âš ï¸ ØªÛ•Ù†Ù‡Ø§ Ø¦Û•Ø¯Ù…ÛŒÙ† Ø¯Û•ØªÙˆØ§Ù†ÛØª');
                return;
            }
            
            const type = document.getElementById('contentType').value;
            const id = document.getElementById('contentEditId').value;

            const data = {
                type: type,
                title: document.getElementById('contentTitle').value.trim(),
                poster: document.getElementById('contentPoster').value.trim(),
                year: document.getElementById('contentYear').value.trim() || '2024',
                rating: parseFloat(document.getElementById('contentRating').value) || 0,
                description: document.getElementById('contentDescription').value.trim(),
                date: new Date().toISOString(),
                views: 0,
                commentsCount: 0
            };

            if (type === 'movie') {
                const server = document.getElementById('movieServer').value.trim();
                if (!server) {
                    showToast('âš ï¸ Ù„ÛŒÙ†Ú©ÛŒ Ø³ÛØ±Ú¤Û•Ø± Ù¾Ú• Ø¨Ú©Û•Ø±Û•ÙˆÛ•');
                    return;
                }
                data.server = server;
            } else {
                const episodes = [];
                document.querySelectorAll('#episodesContainer > div').forEach(ep => {
                    const server = ep.querySelector('.ep-server').value.trim();
                    if (server) {
                        episodes.push({
                            number: parseInt(ep.querySelector('.ep-number').value),
                            title: ep.querySelector('.ep-title').value.trim(),
                            server: server
                        });
                    }
                });
                
                if (episodes.length === 0) {
                    showToast('âš ï¸ Ù„Ø§ÛŒÛ•Ù†ÛŒ Ú©Û•Ù… ÛŒÛ•Ú© Ø¦Û•ÚµÙ‚Û• Ø²ÛŒØ§Ø¯ Ø¨Ú©Û•');
                    return;
                }
                
                data.episodes = episodes.sort((a, b) => a.number - b.number);
            }

            try {
                if (id) {
                    const existing = allContent.find(c => c.id === id);
                    data.views = existing?.views || 0;
                    data.commentsCount = existing?.commentsCount || 0;
                    await update(ref(db, `content/${id}`), data);
                    showToast('âœ… Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ Ú©Ø±Ø§');
                } else {
                    await push(ref(db, 'content'), data);
                    showToast('âœ… Ø²ÛŒØ§Ø¯ Ú©Ø±Ø§');
                }
                closeModal('contentModal');
            } catch (error) {
                console.error(error);
                showToast('âŒ Ù‡Û•ÚµÛ•: ' + error.message);
            }
        };

        window.saveSlide = async (e) => {
            e.preventDefault();
            const id = document.getElementById('slideEditId').value;
            
            const data = {
                title: document.getElementById('slideTitle').value,
                image: document.getElementById('slideImage').value,
                description: document.getElementById('slideDescription').value,
                contentId: document.getElementById('slideContentId').value,
                date: new Date().toISOString()
            };

            try {
                if (id) {
                    await update(ref(db, `slides/${id}`), data);
                } else {
                    await push(ref(db, 'slides'), data);
                }
                closeModal('slideModal');
                showToast('âœ… Ù¾Ø§Ø´Û•Ú©Û•ÙˆØª Ú©Ø±Ø§');
            } catch (error) {
                showToast('âŒ Ù‡Û•ÚµÛ•');
            }
        };

        function displayContentManager() {
            const manager = document.getElementById('contentManager');
            if (allContent.length === 0) {
                manager.innerHTML = '<p style="padding: 20px; text-align: center; color: var(--text-secondary);">Ù‡ÛŒÚ† Ù†Ø§ÙˆÛ•Ú•Û†Ú©ÛÚ© Ù†ÛŒÛŒÛ•</p>';
                return;
            }

            manager.innerHTML = allContent.map(item => `
                <div class="list-item">
                    <div style="flex: 1;">
                        <div style="font-weight: 600; margin-bottom: 5px;">${item.title}</div>
                        <div style="font-size: 12px; color: var(--text-secondary);">
                            <span style="background: var(--bg-primary); padding: 3px 8px; border-radius: 4px; margin-left: 8px;">
                                ${item.type === 'series' ? 'ğŸ“º Ø²Ù†Ø¬ÛŒØ±Û•' : 'ğŸ¬ ÙÛŒÙ„Ù…'}
                            </span>
                            <span>${item.year || ''}</span>
                            ${item.type === 'series' ? ` â€¢ ${item.episodes?.length || 0} Ø¦Û•ÚµÙ‚Û•` : ''}
                            â€¢ ğŸ‘ï¸ ${item.views || 0}
                            â€¢ ğŸ’¬ ${item.commentsCount || 0}
                        </div>
                        <div style="font-size: 11px; color: var(--text-secondary); margin-top: 5px; font-family: monospace;">
                            ID: ${item.id}
                        </div>
                    </div>
                    <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                        <button class="btn" style="background: #2196F3; color: white;" onclick="editContent('${item.id}')">
                            <i class="fas fa-edit"></i> Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒ
                        </button>
                        <button class="btn btn-danger" onclick="deleteContent('${item.id}')">
                            <i class="fas fa-trash"></i> Ø³Ú•ÛŒÙ†Û•ÙˆÛ•
                        </button>
                    </div>
                </div>
            `).join('');
        }

        window.editContent = (id) => {
            const item = allContent.find(c => c.id === id);
            if (!item) return;
            
            document.getElementById('contentType').value = item.type;
            document.getElementById('contentEditId').value = id;
            document.getElementById('contentModalTitle').textContent = item.type === 'movie' ? 'Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒÚ©Ø±Ø¯Ù†ÛŒ ÙÛŒÙ„Ù…' : 'Ø¯Û•Ø³ØªÚ©Ø§Ø±ÛŒÚ©Ø±Ø¯Ù†ÛŒ Ø²Ù†Ø¬ÛŒØ±Û•';
            document.getElementById('contentTitle').value = item.title;
            document.getElementById('contentPoster').value = item.poster;
            document.getElementById('contentYear').value = item.year || '';
            document.getElementById('contentRating').value = item.rating || '';
            document.getElementById('contentDescription').value = item.description || '';
            
            document.getElementById('movieSection').style.display = item.type === 'movie' ? 'block' : 'none';
            document.getElementById('seriesSection').style.display = item.type === 'series' ? 'block' : 'none';
            
            if (item.type === 'movie') {
                document.getElementById('movieServer').value = item.server || '';
            } else {
                const container = document.getElementById('episodesContainer');
                container.innerHTML = '';
                item.episodes?.forEach(ep => {
                    const episodeDiv = document.createElement('div');
                    episodeDiv.style.cssText = 'background: var(--bg-secondary); padding: 15px; border-radius: 8px; margin-bottom: 15px;';
                    episodeDiv.innerHTML = `
                        <h4 style="margin-bottom: 10px; color: var(--accent-primary);">Ø¦Û•ÚµÙ‚Û•ÛŒ ${ep.number}</h4>
                        <div class="form-group">
                            <label>Ú˜Ù…Ø§Ø±Û•ÛŒ Ø¦Û•ÚµÙ‚Û• *</label>
                            <input type="number" class="ep-number" value="${ep.number}" required>
                        </div>
                        <div class="form-group">
                            <label>Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù†ÛŒ Ø¦Û•ÚµÙ‚Û•</label>
                            <input type="text" class="ep-title" value="${ep.title || ''}" placeholder="Ù†Ø§ÙˆÙ†ÛŒØ´Ø§Ù† (Ø¦ÛŒØ®ØªÛŒØ§Ø±ÛŒ)">
                        </div>
                        <div class="form-group">
                            <label>Ù„ÛŒÙ†Ú©ÛŒ Ø³ÛØ±Ú¤Û•Ø± *</label>
                            <input type="url" class="ep-server" value="${ep.server}" required>
                        </div>
                        <button type="button" class="btn btn-danger" onclick="this.parentElement.remove()" style="width: 100%; justify-content: center;">
                            <i class="fas fa-trash"></i> Ø³Ú•ÛŒÙ†Û•ÙˆÛ•ÛŒ Ø¦Û•Ù… Ø¦Û•ÚµÙ‚Û•ÛŒÛ•
                        </button>
                    `;
                    container.appendChild(episodeDiv);
                });
            }
            
            openModal('contentModal');
        };

        window.deleteContent = async (id) => {
            if (!isAdmin) {
                showToast('âš ï¸ ØªÛ•Ù†Ù‡Ø§ Ø¦Û•Ø¯Ù…ÛŒÙ† Ø¯Û•ØªÙˆØ§Ù†ÛØª');
                return;
            }
            
            if (!confirm('Ø¯ÚµÙ†ÛŒØ§ÛŒØª Ø¯Û•ØªÛ•ÙˆÛØª Ø¨Ø³Ú•ÛŒØªÛ•ÙˆÛ•ØŸ')) return;
            
            try {
                await remove(ref(db, `content/${id}`));
                await remove(ref(db, `comments/${id}`));
                showToast('âœ… Ø³Ú•Ø§ÛŒÛ•ÙˆÛ•');
            } catch (error) {
                console.error(error);
                showToast('âŒ Ù‡Û•ÚµÛ•: ' + error.message);
            }
        };

        window.openSlideModal = () => {
            if (!isAdmin) {
                showToast('âš ï¸ ØªÛ•Ù†Ù‡Ø§ Ø¦Û•Ø¯Ù…ÛŒÙ† Ø¯Û•ØªÙˆØ§Ù†ÛØª');
                return;
            }
            
            document.getElementById('slideEditId').value = '';
            document.querySelectorAll('#slideModal input, #slideModal textarea').forEach(el => {
                if (el.type !== 'hidden') el.value = '';
            });
            openModal('slideModal');
        };

        // Modal & UI Functions
        function openModal(id) {
            document.getElementById(id).classList.add('active');
            document.body.style.overflow = 'hidden';
        }

        window.closeModal = (id) => {
            document.getElementById(id).classList.remove('active');
            document.body.style.overflow = 'auto';
        };

        window.showSection = (section) => {
            if (section === 'admin') {
                document.getElementById('homeSection').style.display = 'none';
                document.getElementById('detailPage').classList.remove('active');
                document.getElementById('adminPanel').classList.add('show');
            } else {
                document.getElementById('homeSection').style.display = 'block';
                document.getElementById('detailPage').classList.remove('active');
                document.getElementById('adminPanel').classList.remove('show');
            }
        };

        window.setFilter = (filter) => {
            currentFilter = filter;
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            if (event?.target) event.target.classList.add('active');
            displayContent();
        };

        window.performSearch = () => {
            const term = document.getElementById('searchInput').value.toLowerCase().trim();
            if (!term) {
                currentFilter = 'all';
                displayContent();
                return;
            }

            const grid = document.getElementById('moviesGrid');
            const filtered = allContent.filter(c => 
                c.title?.toLowerCase().includes(term) ||
                c.description?.toLowerCase().includes(term)
            );

            if (filtered.length === 0) {
                grid.innerHTML = '<div style="padding: 60px; text-align: center;">Ù‡ÛŒÚ† Ø¦Û•Ù†Ø¬Ø§Ù…ÛÚ© Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•</div>';
                return;
            }

            grid.innerHTML = filtered.map(item => `
                <div class="movie-card" onclick="openDetail('${item.id}')">
                    <div class="movie-poster">
                        <img src="${item.poster}" alt="${item.title}">
                        <div class="play-icon"><i class="fas fa-play"></i></div>
                    </div>
                    <div class="movie-info">
                        <div class="movie-title">${item.title}</div>
                        <div class="movie-meta"><span>${item.year || ''}</span></div>
                    </div>
                </div>
            `).join('');
        };

        window.showToast = (message) => {
            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        };

        // Initialize
        loadData();
    </script>
</body>
</html>
