<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ú©ÙˆØ±Ø¯ Ú¤ÛŒÚ˜Ù†</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        :root {
            --primary-color: #667eea;
            --secondary-color: #764ba2;
            --accent-color: #ffd700;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            color: #fff;
            min-height: 100vh;
        }
        
        header {
            background: rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            padding: 20px 0;
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 0 20px; }
        
        nav { display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 15px; }
        
        .logo {
            font-size: 32px;
            font-weight: bold;
            background: linear-gradient(45deg, var(--accent-color), #ffed4e);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        
        .nav-links {
            display: flex;
            gap: 20px;
            list-style: none;
            flex-wrap: wrap;
        }
        
        .nav-links a {
            color: #fff;
            text-decoration: none;
            padding: 8px 15px;
            border-radius: 20px;
            transition: all 0.3s;
        }
        
        .nav-links a:hover {
            background: rgba(255, 255, 255, 0.1);
            color: var(--accent-color);
        }
        
        .admin-controls {
            display: none;
            gap: 10px;
        }
        .admin-controls.show { display: flex; }
        
        .admin-btn, .logout-btn, .settings-btn {
            background: var(--accent-color);
            color: #333;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
        }
        .settings-btn { background: #4CAF50; color: white; }
        .logout-btn { background: #ff4444; color: white; }
        
        /* Hero Slider */
        .hero-slider {
            position: relative;
            height: 550px;
            overflow: hidden;
            margin-bottom: 40px;
        }
        
        .slide {
            position: absolute;
            width: 100%;
            height: 100%;
            opacity: 0;
            transition: opacity 1s;
        }
        .slide.active { opacity: 1; }
        
        .slide-bg {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: brightness(0.5);
        }
        
        .slide-content {
            position: absolute;
            bottom: 60px;
            right: 50px;
            max-width: 700px;
            z-index: 2;
        }
        
        .slide-content h1 {
            font-size: 52px;
            margin-bottom: 15px;
        }
        
        .slide-meta {
            display: flex;
            gap: 15px;
            margin-bottom: 15px;
        }
        
        .slide-badge {
            background: var(--accent-color);
            color: #333;
            padding: 5px 15px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .slide-btn {
            background: var(--accent-color);
            color: #333;
            padding: 15px 50px;
            border: none;
            border-radius: 30px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            margin-top: 20px;
        }
        
        .slider-controls {
            position: absolute;
            bottom: 30px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 10;
        }
        
        .slider-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: rgba(255,255,255,0.4);
            cursor: pointer;
        }
        .slider-dot.active {
            background: var(--accent-color);
            width: 35px;
            border-radius: 6px;
        }
        
        .slider-arrows {
            position: absolute;
            top: 50%;
            width: 100%;
            transform: translateY(-50%);
            display: flex;
            justify-content: space-between;
            padding: 0 20px;
            z-index: 10;
        }
        
        .slider-arrow {
            background: rgba(0,0,0,0.5);
            color: white;
            width: 50px;
            height: 50px;
            border-radius: 50%;
            border: none;
            font-size: 24px;
            cursor: pointer;
        }
        
        .search-box {
            max-width: 600px;
            margin: 0 auto 40px;
            position: relative;
            padding: 0 20px;
        }
        
        .search-box input {
            width: 100%;
            padding: 15px 50px 15px 20px;
            border: none;
            border-radius: 50px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }
        
        .search-box button {
            position: absolute;
            left: 30px;
            top: 50%;
            transform: translateY(-50%);
            background: var(--primary-color);
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            color: #fff;
            cursor: pointer;
        }
        
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: 50px 0 30px;
        }
        
        .section-title {
            font-size: 32px;
        }
        
        .movies-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 30px;
            padding: 20px 0;
        }
        
        .movie-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
        }
        .movie-card:hover { transform: scale(1.05); }
        
        .movie-poster {
            width: 100%;
            height: 350px;
            position: relative;
        }
        .movie-poster img { width: 100%; height: 100%; object-fit: cover; }
        
        .play-icon {
            position: absolute;
            font-size: 70px;
            background: rgba(0, 0, 0, 0.6);
            width: 90px;
            height: 90px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }
        
        .rating-badge {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(255, 215, 0, 0.95);
            color: #333;
            padding: 8px 12px;
            border-radius: 10px;
            font-weight: bold;
        }
        
        .view-count {
            position: absolute;
            top: 10px;
            left: 10px;
            background: rgba(0, 0, 0, 0.8);
            padding: 5px 12px;
            border-radius: 20px;
            font-size: 14px;
        }
        .admin-only { display: none; }
        .admin-mode .admin-only { display: flex; }
        
        .movie-info { padding: 20px; }
        .movie-title { font-size: 18px; font-weight: bold; margin-bottom: 10px; }
        .movie-meta { font-size: 14px; opacity: 0.8; margin-bottom: 5px; }
        
        .badge {
            display: inline-block;
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 12px;
            font-weight: bold;
            margin: 5px 5px 0 0;
        }
        .badge.subtitle { background: var(--accent-color); color: #333; }
        .badge.dubbed { background: #ff6b6b; color: white; }
        
        .delete-btn, .edit-btn {
            position: absolute;
            top: 10px;
            background: #ff4444;
            color: white;
            border: none;
            width: 35px;
            height: 35px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 20px;
            display: none;
            z-index: 10;
        }
        .delete-btn { left: 10px; }
        .edit-btn { left: 55px; background: #4CAF50; }
        .admin-mode .movie-card:hover .delete-btn,
        .admin-mode .movie-card:hover .edit-btn { display: block; }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .modal-content {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
            margin: 50px auto;
            padding: 40px;
            max-width: 500px;
            border-radius: 20px;
            position: relative;
        }
        .modal-content.large { max-width: 800px; }
        
        .close-modal {
            position: absolute;
            top: 15px;
            left: 15px;
            font-size: 30px;
            cursor: pointer;
            color: #fff;
            background: rgba(255, 255, 255, 0.2);
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .modal h2 { text-align: center; margin-bottom: 30px; }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; margin-bottom: 8px; font-weight: bold; }
        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 16px;
            background: rgba(255, 255, 255, 0.9);
            color: #333;
        }
        .form-group textarea { resize: vertical; min-height: 100px; }
        
        .checkbox-group {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 10px;
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            max-height: 200px;
            overflow-y: auto;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .checkbox-item input[type="checkbox"] {
            width: auto;
            cursor: pointer;
        }
        
        .submit-btn {
            width: 100%;
            padding: 15px;
            background: var(--accent-color);
            color: #333;
            border: none;
            border-radius: 10px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
        }
        
        .video-player {
            width: 100%;
            height: 500px;
            background: #000;
            border-radius: 10px;
            margin-bottom: 20px;
        }
        
        .server-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .server-btn {
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.3);
            color: #fff;
            border-radius: 10px;
            cursor: pointer;
        }
        .server-btn.active { background: var(--accent-color); color: #333; }
        
        .settings-panel {
            max-width: 900px;
            margin: 40px auto;
            padding: 40px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 20px;
        }
        
        .settings-section {
            margin-bottom: 30px;
            padding: 20px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
        }
        
        .settings-section h3 {
            margin-bottom: 20px;
            font-size: 22px;
            color: var(--accent-color);
        }
        
        .list-manager {
            display: grid;
            gap: 15px;
        }
        
        .list-item {
            background: rgba(255, 255, 255, 0.1);
            padding: 15px;
            border-radius: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .list-item-actions button {
            padding: 8px 15px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-weight: bold;
            margin-left: 10px;
        }
        
        .color-picker-group {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .color-picker-item input[type="color"] {
            width: 100%;
            height: 50px;
            border: none;
            border-radius: 10px;
            cursor: pointer;
        }
        
        footer {
            background: rgba(0, 0, 0, 0.3);
            padding: 30px 20px;
            text-align: center;
            margin-top: 80px;
        }
        footer p { opacity: 0.8; margin: 5px 0; }
        
        @media (max-width: 768px) {
            .hero-slider { height: 400px; }
            .slide-content { padding: 30px 20px; bottom: 40px; right: 20px; }
            .slide-content h1 { font-size: 32px; }
        }
    </style>
</head>
<body>
    <header>
        <div class="container">
            <nav>
                <div class="logo">ğŸ¬ <span id="siteNameDisplay">Ú©ÙˆØ±Ø¯ Ú¤ÛŒÚ˜Ù†</span></div>
                <ul class="nav-links" id="dynamicMenu">
                    <li><a href="#" onclick="showTab('all')">Ø³Û•Ø±Û•Ú©ÛŒ</a></li>
                    <li><a href="#" onclick="showTab('latest')">Ù†ÙˆÛØªØ±ÛŒÙ†</a></li>
                    <li><a href="#" onclick="showTab('subtitle')">Ú˜ÛØ±Ù†ÙˆÙˆØ³Ú©Ø±Ø§Ùˆ</a></li>
                    <li><a href="#" onclick="showTab('dubbed')">Ø¯Û†Ø¨Ù„Ø§Ú˜Ú©Ø±Ø§Ùˆ</a></li>
                    <li><a href="#staffSection">Ø³ØªØ§Ù</a></li>
                    <li id="adminLoginBtn" style="display: none;"><a href="#" onclick="openLogin()" style="background: rgba(255,215,0,0.2);">ğŸ” Ø¦Û•Ø¯Ù…ÛŒÙ†</a></li>
                </ul>
                <div class="admin-controls" id="adminControls">
                    <button class="settings-btn" onclick="showSettings()">âš™ï¸ Ú•ÛÚ©Ø®Ø³ØªÙ†</button>
                    <button class="admin-btn" onclick="openAddModal()">â• ÙÛŒÙ„Ù…ÛŒ Ù†ÙˆÛ</button>
                    <button class="logout-btn" onclick="logout()">Ú†ÙˆÙˆÙ†Û• Ø¯Û•Ø±Û•ÙˆÛ•</button>
                </div>
            </nav>
        </div>
    </header>

    <!-- Hero Slider -->
    <section class="hero-slider" id="heroSlider"></section>

    <!-- Search -->
    <div class="search-box">
        <input type="text" id="searchInput" placeholder="Ú¯Û•Ú•Ø§Ù† Ø¨Û• ÙÛŒÙ„Ù… ÛŒØ§Ù† Ø²Ù†Ø¬ÛŒØ±Û•..." onkeyup="searchMovies()">
        <button onclick="searchMovies()">ğŸ” Ú¯Û•Ú•Ø§Ù†</button>
    </div>

    <!-- Movies -->
    <section class="container" id="moviesSection">
        <div class="section-header">
            <h2 class="section-title">ğŸ”¥ Ù¾ÛØ´Ù†ÛŒØ§Ø±Ú©Ø±Ø§Ùˆ</h2>
        </div>
        <div class="movies-grid" id="featuredGrid"></div>

        <div class="section-header">
            <h2 class="section-title" id="sectionTitle">â­ Ù†ÙˆÛØªØ±ÛŒÙ† ÙÛŒÙ„Ù…Û•Ú©Ø§Ù†</h2>
        </div>
        <div class="movies-grid" id="moviesGrid">
            <div style="text-align: center; grid-column: 1/-1; padding: 40px;">Ú†Ø§ÙˆÛ•Ú•Û Ø¨Ú©Û•...</div>
        </div>
    </section>

    <!-- Settings -->
    <section class="container" id="settingsSection" style="display: none;">
        <div class="settings-panel">
            <h2 style="text-align: center; margin-bottom: 40px;">âš™ï¸ Ú•ÛÚ©Ø®Ø³ØªÙ†Û•Ú©Ø§Ù†</h2>
            
            <div class="settings-section">
                <h3>ğŸ¬ Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Slider</h3>
                <button class="submit-btn" style="margin-bottom: 20px;" onclick="openSliderModal()">â• Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Slide Ù†ÙˆÛ</button>
                <div class="list-manager" id="sliderManager"></div>
            </div>

            <div class="settings-section">
                <h3>ğŸ“‹ Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Menu</h3>
                <button class="submit-btn" style="margin-bottom: 20px;" onclick="openMenuModal()">â• Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø¨Û•Ø´ÛŒ Ù†ÙˆÛ</button>
                <div class="list-manager" id="menuManager"></div>
            </div>

            <div class="settings-section">
                <h3>ğŸŒ Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ ÙˆÚµØ§ØªÛ•Ú©Ø§Ù†</h3>
                <button class="submit-btn" style="margin-bottom: 20px;" onclick="openCountryModal()">â• Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ ÙˆÚµØ§Øª</button>
                <div class="list-manager" id="countryManager"></div>
            </div>

            <div class="settings-section">
                <h3>ğŸ‘¥ Ø¨Û•Ú•ÛÙˆÛ•Ø¨Ø±Ø¯Ù†ÛŒ Ø³ØªØ§Ù</h3>
                <button class="submit-btn" style="margin-bottom: 20px;" onclick="openStaffModal()">â• Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø¦Û•Ù†Ø¯Ø§Ù…</button>
                <div class="list-manager" id="staffManager"></div>
            </div>

            <div class="settings-section">
                <h3>ğŸ“ Ø²Ø§Ù†ÛŒØ§Ø±ÛŒ ÙˆÛØ¨Ø³Ø§ÛŒØª</h3>
                <div class="form-group">
                    <label>Ù†Ø§ÙˆÛŒ ÙˆÛØ¨Ø³Ø§ÛŒØª</label>
                    <input type="text" id="settingSiteName" placeholder="Ú©ÙˆØ±Ø¯ Ú¤ÛŒÚ˜Ù†">
                </div>
                <div class="form-group">
                    <label>Ø³Û•Ø±Ø¯ÛÚ•ÛŒ Ù„ÛŒØ³ØªÛŒ ÙÛŒÙ„Ù…Û•Ú©Ø§Ù†</label>
                    <input type="text" id="settingSectionTitle" placeholder="Ù†ÙˆÛØªØ±ÛŒÙ† ÙÛŒÙ„Ù…Û•Ú©Ø§Ù†">
                </div>
            </div>

            <div class="settings-section">
                <h3>ğŸ¨ Ú•Û•Ù†Ú¯Û•Ú©Ø§Ù†</h3>
                <div class="color-picker-group">
                    <div>
                        <label>Ú•Û•Ù†Ú¯ÛŒ Ø³Û•Ø±Û•Ú©ÛŒ</label>
                        <input type="color" id="settingPrimaryColor" value="#667eea">
                    </div>
                    <div>
                        <label>Ú•Û•Ù†Ú¯ÛŒ Ù„Ø§ÙˆÛ•Ú©ÛŒ</label>
                        <input type="color" id="settingSecondaryColor" value="#764ba2">
                    </div>
                    <div>
                        <label>Ú•Û•Ù†Ú¯ÛŒ Ø¯ÙˆÚ¯Ù…Û•Ú©Ø§Ù†</label>
                        <input type="color" id="settingAccentColor" value="#ffd700">
                    </div>
                </div>
            </div>

            <div class="settings-section">
                <h3>ğŸ“„ ØªÛÚ©Ø³ØªÛŒ Footer</h3>
                <div class="form-group">
                    <textarea id="settingFooterText" placeholder="Ø¨ÚµØ§ÙˆÚ©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ ÙÛŒÙ„Ù…..."></textarea>
                </div>
            </div>

            <div style="display: flex; gap: 10px;">
                <button class="submit-btn" onclick="saveSettings()">ğŸ’¾ Ù¾Ø§Ø´Û•Ú©Û•ÙˆØªÚ©Ø±Ø¯Ù†</button>
                <button class="submit-btn" style="background: #666;" onclick="hideSettings()">Ú¯Û•Ú•Ø§Ù†Û•ÙˆÛ•</button>
            </div>
        </div>
    </section>

    <!-- Footer / Staff Section -->
    <footer id="staffSection">
        <div class="container">
            <h3 style="margin-bottom: 20px;">ğŸ‘¥ Ø³ØªØ§ÙÛŒ <span id="footerSiteName">Ú©ÙˆØ±Ø¯ Ú¤ÛŒÚ˜Ù†</span></h3>
            <div id="staffList" style="max-width: 600px; margin: 0 auto 20px;"></div>
            <p>Â© 2024 <span id="footerSiteName2">Ú©ÙˆØ±Ø¯ Ú¤ÛŒÚ˜Ù†</span> - Ù‡Û•Ù…ÙˆÙˆ Ù…Ø§ÙÛÚ© Ù¾Ø§Ø±ÛØ²Ø±Ø§ÙˆÛ•</p>
            <p id="footerText">Ø¨ÚµØ§ÙˆÚ©Ø±Ø¯Ù†Û•ÙˆÛ•ÛŒ ÙÛŒÙ„Ù… Ùˆ Ø²Ù†Ø¬ÛŒØ±Û• Ø¨Û• Ú˜ÛØ±Ù†ÙˆÙˆØ³ÛŒ Ùˆ Ø¯Û†Ø¨Ù„Ø§Ú˜ÛŒ Ú©ÙˆØ±Ø¯ÛŒ</p>
        </div>
    </footer>

    <!-- Modals will be added via JavaScript -->

    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getDatabase, ref, push, set, onValue, remove, update } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js';
        import { getAuth, signInWithEmailAndPassword, signOut, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';

        const firebaseConfig = {
            apiKey: "AIzaSyAaE1v9PcHGsSgF1IlnDrygX5TT2-zii8o",
            authDomain: "kurdvision-f9d3e.firebaseapp.com",
            databaseURL: "https://kurdvision-f9d3e-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "kurdvision-f9d3e",
            storageBucket: "kurdvision-f9d3e.firebasestorage.app",
            messagingSenderId: "704463916853",
            appId: "1:704463916853:web:237616584ecaf85309467c"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        const auth = getAuth(app);

        let movies = [], slides = [], menuItems = [], countries = [], staffMembers = [];
        let isAdmin = false, currentFilter = 'all', currentSlide = 0, sliderInterval;

        window.onload = function() {
            loadAll();
            const urlParams = new URLSearchParams(window.location.search);
            if (urlParams.get('admin') === 'true') {
                document.getElementById('adminLoginBtn').style.display = 'block';
            }
        };

        function loadAll() {
            onAuthStateChanged(auth, (user) => {
                isAdmin = !!user;
                document.getElementById('adminControls').classList.toggle('show', isAdmin);
                document.body.classList.toggle('admin-mode', isAdmin);
            });
            
            onValue(ref(database, 'movies'), (s) => {
                movies = [];
                s.forEach((c) => movies.push({id: c.key, ...c.val()}));
                displayMovies();
            });
            
            onValue(ref(database, 'slides'), (s) => {
                slides = [];
                s.forEach((c) => slides.push({id: c.key, ...c.val()}));
                displaySlider();
            });
            
            onValue(ref(database, 'staff'), (s) => {
                staffMembers = [];
                s.forEach((c) => staffMembers.push({id: c.key, ...c.val()}));
                displayStaff();
            });
            
            onValue(ref(database, 'menuItems'), (s) => {
                menuItems = [];
                s.forEach((c) => menuItems.push({id: c.key, ...c.val()}));
                updateMenu();
            });
            
            onValue(ref(database, 'countries'), (s) => {
                countries = [];
                s.forEach((c) => countries.push({id: c.key, ...c.val()}));
            });
            
            onValue(ref(database, 'settings'), (s) => {
                const settings = s.val() || {};
                if (settings.siteName) {
                    document.getElementById('siteNameDisplay').textContent = settings.siteName;
                    document.getElementById('footerSiteName').textContent = settings.siteName;
                    document.getElementById('footerSiteName2').textContent = settings.siteName;
                    document.title = settings.siteName;
                }
                if (settings.sectionTitle) document.getElementById('sectionTitle').textContent = settings.sectionTitle;
                if (settings.footerText) document.getElementById('footerText').textContent = settings.footerText;
                if (settings.primaryColor) document.documentElement.style.setProperty('--primary-color', settings.primaryColor);
                if (settings.secondaryColor) document.documentElement.style.setProperty('--secondary-color', settings.secondaryColor);
                if (settings.accentColor) document.documentElement.style.setProperty('--accent-color', settings.accentColor);
            });
        }

        function displayStaff() {
            const list = document.getElementById('staffList');
            if (staffMembers.length === 0) {
                list.innerHTML = '<p>ğŸ’» Ø¨Û•Ø±Ù†Ø§Ù…Û•Ù†ÙˆÙˆØ³: Raz Tofiq</p><p>ğŸ¬ ÙˆÛ•Ø±Ú¯ÛÚ•: ØªÛŒÙ…ÛŒ Ú©ÙˆØ±Ø¯ Ú¤ÛŒÚ˜Ù†</p>';
            } else {
                list.innerHTML = staffMembers.map(m => `<p>${m.icon||'ğŸ‘¤'} ${m.role}: ${m.name}</p>`).join('');
            }
        }

        function updateMenu() {
            const menu = document.getElementById('dynamicMenu');
            const custom = menuItems.map(i => `<li><a href="#" onclick="showTab('${i.value}')">${i.name}</a></li>`).join('');
            menu.innerHTML = `
                <li><a href="#" onclick="showTab('all')">Ø³Û•Ø±Û•Ú©ÛŒ</a></li>
                <li><a href="#" onclick="showTab('latest')">Ù†ÙˆÛØªØ±ÛŒÙ†</a></li>
                <li><a href="#" onclick="showTab('subtitle')">Ú˜ÛØ±Ù†ÙˆÙˆØ³Ú©Ø±Ø§Ùˆ</a></li>
                <li><a href="#" onclick="showTab('dubbed')">Ø¯Û†Ø¨Ù„Ø§Ú˜Ú©Ø±Ø§Ùˆ</a></li>
                ${custom}
                <li><a href="#staffSection">Ø³ØªØ§Ù</a></li>
                <li id="adminLoginBtn" style="display: ${new URLSearchParams(window.location.search).get('admin') === 'true' ? 'block' : 'none'};"><a href="#" onclick="openLogin()" style="background: rgba(255,215,0,0.2);">ğŸ” Ø¦Û•Ø¯Ù…ÛŒÙ†</a></li>
            `;
        }

        function displaySlider() {
            const el = document.getElementById('heroSlider');
            if (slides.length === 0) { el.style.display = 'none'; return; }
            el.style.display = 'block';
            
            el.innerHTML = slides.map((s, i) => `
                <div class="slide ${i === 0 ? 'active' : ''}">
                    <img src="${s.image}" class="slide-bg" alt="${s.title}">
                    <div class="slide-content">
                        <h1>${s.title}</h1>
                        ${s.year ? `<div class="slide-meta"><span class="slide-badge">${s.year}</span></div>` : ''}
                        ${s.description ? `<p>${s.description}</p>` : ''}
                        ${s.link ? `<button class="slide-btn" onclick="openMovieById('${s.link}')">â–¶ Ø¨ÛŒÙ†ÛŒÙ†</button>` : ''}
                    </div>
                </div>
            `).join('');

            if (slides.length > 1) {
                el.innerHTML += `
                    <div class="slider-controls">
                        ${slides.map((_, i) => `<div class="slider-dot ${i === 0 ? 'active' : ''}" onclick="goToSlide(${i})"></div>`).join('')}
                    </div>
                    <div class="slider-arrows">
                        <button class="slider-arrow" onclick="prevSlide()">â€¹</button>
                        <button class="slider-arrow" onclick="nextSlide()">â€º</button>
                    </div>
                `;
                startSlider();
            }
        }

        function startSlider() {
            if (sliderInterval) clearInterval(sliderInterval);
            sliderInterval = setInterval(() => {
                currentSlide = (currentSlide + 1) % slides.length;
                updateSlider();
            }, 5000);
        }

        window.goToSlide = (i) => { currentSlide = i; updateSlider(); startSlider(); };
        window.nextSlide = () => { currentSlide = (currentSlide + 1) % slides.length; updateSlider(); startSlider(); };
        window.prevSlide = () => { currentSlide = (currentSlide - 1 + slides.length) % slides.length; updateSlider(); startSlider(); };

        function updateSlider() {
            document.querySelectorAll('.slide').forEach((s, i) => s.classList.toggle('active', i === currentSlide));
            document.querySelectorAll('.slider-dot').forEach((d, i) => d.classList.toggle('active', i === currentSlide));
        }

        function displayMovies() {
            const featured = movies.filter(m => m.featured).slice(0, 6);
            const grid1 = document.getElementById('featuredGrid');
            const grid2 = document.getElementById('moviesGrid');
            
            grid1.innerHTML = featured.length ? featured.map(createCard).join('') : '';
            
            let filtered = movies;
            if (currentFilter === 'latest') filtered = movies.slice(0, 12);
            else if (currentFilter !== 'all') filtered = movies.filter(m => m.type === currentFilter || m.country === currentFilter || m.genres.includes(currentFilter));
            
            const sorted = [...filtered].sort((a, b) => new Date(b.date) - new Date(a.date));
            grid2.innerHTML = sorted.length ? sorted.map(createCard).join('') : '<p style="text-align: center; grid-column: 1/-1; padding: 40px;">Ù‡ÛŒÚ† ÙÛŒÙ„Ù…ÛÚ© Ù†Û•Ø¯Û†Ø²Ø±Ø§ÛŒÛ•ÙˆÛ•</p>';
        }

        function createCard(m) {
            const views = m.views || Math.floor(Math.random() * 10000);
            return `
                <div class="movie-card" onclick="openWatchModal('${m.id}')">
                    ${isAdmin ? `
                        <button class="delete-btn" onclick="event.stopPropagation(); deleteItem('movies', '${m.id}')">Ã—</button>
                        <button class="edit-btn" onclick="event.stopPropagation(); editMovie('${m.id}')">âœï¸</button>
                    ` : ''}
                    <div class="movie-poster">
                        <img src="${m.poster}" alt="${m.title}">
                        <div class="play-icon">â–¶</div>
                        ${m.rating ? `<div class="rating-badge">â­ ${m.rating}</div>` : ''}
                        <div class="view-count admin-only">ğŸ‘ï¸ ${views.toLocaleString()}</div>
                    </div>
                    <div class="movie-info">
                        <div class="movie-title">${m.title}</div>
                        <div class="movie-meta">Ú˜Ø§Ù†Ø±: ${m.genres}</div>
                        <div class="movie-meta">ÙˆÚµØ§Øª: ${m.country || 'Ù†Û•Ù†Ø§Ø³Ø±Ø§Ùˆ'}</div>
                        <div class="movie-meta">Ø³Ø§Úµ: ${m.year}</div>
                        <span class="badge ${m.type}">${m.type === 'subtitle' ? 'Ú˜ÛØ±Ù†ÙˆÙˆØ³ÛŒ Ú©ÙˆØ±Ø¯ÛŒ' : 'Ø¯Û†Ø¨Ù„Ø§Ú˜ÛŒ Ú©ÙˆØ±Ø¯ÛŒ'}</span>
                        ${m.featured ? '<span class="badge" style="background: #ff6b6b;">â­ Ù¾ÛØ´Ù†ÛŒØ§Ø±Ú©Ø±Ø§Ùˆ</span>' : ''}
                    </div>
                </div>
            `;
        }

        window.openLogin = () => alert('ØªÚ©Ø§ÛŒÛ• Ù„Û†Ú¯ÛŒÙ† ÙÛ†Ú•Ù… Ø¯Ø±ÙˆØ³Øª Ø¨Ú©Û•');
        window.logout = () => signOut(auth);
        window.showSettings = () => {
            document.getElementById('moviesSection').style.display = 'none';
            document.getElementById('settingsSection').style.display = 'block';
        };
        window.hideSettings = () => {
            document.getElementById('moviesSection').style.display = 'block';
            document.getElementById('settingsSection').style.display = 'none';
        };
        window.saveSettings = () => {
            set(ref(database, 'settings'), {
                siteName: document.getElementById('settingSiteName').value,
                sectionTitle: document.getElementById('settingSectionTitle').value,
                footerText: document.getElementById('settingFooterText').value,
                primaryColor: document.getElementById('settingPrimaryColor').value,
                secondaryColor: document.getElementById('settingSecondaryColor').value,
                accentColor: document.getElementById('settingAccentColor').value
            }).then(() => { alert('âœ… Ù¾Ø§Ø´Û•Ú©Û•ÙˆØª Ú©Ø±Ø§!'); hideSettings(); });
        };
        
        window.showTab = (type) => { currentFilter = type; displayMovies(); };
        window.searchMovies = () => {
            const term = document.getElementById('searchInput').value.toLowerCase();
            const filtered = movies.filter(m => 
                m.title.toLowerCase().includes(term) || 
                m.genres.toLowerCase().includes(term) ||
                (m.country && m.country.toLowerCase().includes(term))
            );
            document.getElementById('moviesGrid').innerHTML = filtered.map(createCard).join('');
        };

        window.openMovieById = (id) => {
            const m = movies.find(x => x.id === id);
            if (m) openWatchModal(id);
        };

        window.openWatchModal = (id) => {
            const m = movies.find(x => x.id === id);
            if (!m) return;
            
            if (!isAdmin) update(ref(database, 'movies/' + id), { views: (m.views || 0) + 1 });
            
            let servers = '';
            if (m.servers.server1) servers += `<button class="server-btn active" onclick="switchServer('${m.servers.server1}', this)">Ø³ÛØ±Ú¤Û•Ø± Ù¡ (Upstream)</button>`;
            if (m.servers.server2) servers += `<button class="server-btn" onclick="switchServer('${m.servers.server2}', this)">Ø³ÛØ±Ú¤Û•Ø± Ù¢ (Vidmoly)</button>`;
            if (m.servers.server3) servers += `<button class="server-btn" onclick="switchServer('${m.servers.server3}', this)">Ø³ÛØ±Ú¤Û•Ø± Ù£ (Filemoon)</button>`;
            if (m.servers.server4) servers += `<button class="server-btn" onclick="switchServer('${m.servers.server4}', this)">Ø³ÛØ±Ú¤Û•Ø± Ù¤ (MixDrop)</button>`;
            
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content large">
                    <span class="close-modal" onclick="this.parentElement.parentElement.remove()">Ã—</span>
                    <h2>${m.title} ${m.rating ? `<span style="color: #ffd700;">â­ ${m.rating}</span>` : ''}</h2>
                    <div style="margin: 15px 0;">
                        <span class="badge ${m.type}">${m.type === 'subtitle' ? 'Ú˜ÛØ±Ù†ÙˆÙˆØ³ÛŒ Ú©ÙˆØ±Ø¯ÛŒ' : 'Ø¯Û†Ø¨Ù„Ø§Ú˜ÛŒ Ú©ÙˆØ±Ø¯ÛŒ'}</span>
                        ${isAdmin ? `<span class="badge" style="background: #4CAF50;">ğŸ‘ï¸ ${(m.views || 0).toLocaleString()}</span>` : ''}
                    </div>
                    ${servers ? `<div class="server-tabs">${servers}</div>` : ''}
                    <iframe id="videoFrame" class="video-player" src="${m.servers.server1}" frameborder="0" allowfullscreen allow="autoplay"></iframe>
                    <div class="movie-meta">Ú˜Ø§Ù†Ø±: ${m.genres} | ÙˆÚµØ§Øª: ${m.country || 'Ù†Û•Ù†Ø§Ø³Ø±Ø§Ùˆ'} | Ø³Ø§Úµ: ${m.year}</div>
                    ${m.description ? `<p style="margin-top: 15px;">${m.description}</p>` : ''}
                </div>
            `;
            document.body.appendChild(modal);
            modal.onclick = (e) => { if (e.target === modal) modal.remove(); };
        };

        window.switchServer = (url, btn) => {
            document.querySelectorAll('.server-btn').forEach(b => b.classList.remove('active'));
            btn.classList.add('active');
            document.getElementById('videoFrame').src = url;
        };

        window.openSliderModal = () => alert('Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Slider - ØªÚ©Ø§ÛŒÛ• Ù…Û†Ø¯Ø§ÚµÛ•Ú©Û• Ø¯Ø±ÙˆØ³Øª Ø¨Ú©Û•');
        window.openMenuModal = () => alert('Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Menu - ØªÚ©Ø§ÛŒÛ• Ù…Û†Ø¯Ø§ÚµÛ•Ú©Û• Ø¯Ø±ÙˆØ³Øª Ø¨Ú©Û•');
        window.openCountryModal = () => alert('Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ ÙˆÚµØ§Øª - ØªÚ©Ø§ÛŒÛ• Ù…Û†Ø¯Ø§ÚµÛ•Ú©Û• Ø¯Ø±ÙˆØ³Øª Ø¨Ú©Û•');
        window.openStaffModal = () => alert('Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ Ø³ØªØ§Ù - ØªÚ©Ø§ÛŒÛ• Ù…Û†Ø¯Ø§ÚµÛ•Ú©Û• Ø¯Ø±ÙˆØ³Øª Ø¨Ú©Û•');
        window.openAddModal = () => alert('Ø²ÛŒØ§Ø¯Ú©Ø±Ø¯Ù†ÛŒ ÙÛŒÙ„Ù… - ØªÚ©Ø§ÛŒÛ• Ù…Û†Ø¯Ø§ÚµÛ•Ú©Û• Ø¯Ø±ÙˆØ³Øª Ø¨Ú©Û•');
        
        window.deleteItem = (table, id) => {
            if (confirm('Ø¯ÚµÙ†ÛŒØ§ÛŒØªØŸ')) {
                remove(ref(database, table + '/' + id)).then(() => alert('âœ… Ø³Ú•Ø§ÛŒÛ•ÙˆÛ•!'));
            }
        };
    </script>
</body>
</html>
